┌───────────────────────┐                                                                                                                                                                                                        
│         TOP_N         │                                                                                                                                                                                                        
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                                                                                                                                                        
│        Top 100        │                                                                                                                                                                                                        
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                                                                                                                                                        
│   unnamed_subquery7   │                                                                                                                                                                                                        
│      .channel ASC     │                                                                                                                                                                                                        
│   unnamed_subquery7   │                                                                                                                                                                                                        
│    .return_rank ASC   │                                                                                                                                                                                                        
│   unnamed_subquery7   │                                                                                                                                                                                                        
│   .currency_rank ASC  │                                                                                                                                                                                                        
│ unnamed_subquery7.item│                                                                                                                                                                                                        
│           ASC         │                                                                                                                                                                                                        
└───────────┬───────────┘                                                                                                                                                                                                                                 
┌───────────┴───────────┐                                                                                                                                                                                                        
│     HASH_GROUP_BY     │                                                                                                                                                                                                        
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                                                                                                                                                        
│           #0          │                                                                                                                                                                                                        
│           #1          │                                                                                                                                                                                                        
│           #2          │                                                                                                                                                                                                        
│           #3          │                                                                                                                                                                                                        
│           #4          │                                                                                                                                                                                                        
└───────────┬───────────┘                                                                                                                                                                                                                                 
┌───────────┴───────────┐                                                                                                                                                                                                        
│       PROJECTION      │                                                                                                                                                                                                        
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                                                                                                                                                        
│           #0          │                                                                                                                                                                                                        
│           #1          │                                                                                                                                                                                                        
│           #2          │                                                                                                                                                                                                        
│           #3          │                                                                                                                                                                                                        
│           #4          │                                                                                                                                                                                                        
└───────────┬───────────┘                                                                                                                                                                                                                                 
┌───────────┴───────────┐                                                                                                                                                                                                        
│         UNION         ├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐                                                              
└───────────┬───────────┘                                                                                                                                         │                                                                                       
┌───────────┴───────────┐                                                                                                                             ┌───────────┴───────────┐                                                  
│     HASH_GROUP_BY     │                                                                                                                             │       PROJECTION      │                                                  
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                                                                             │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  
│           #0          │                                                                                                                             │        channel        │                                                  
│           #1          │                                                                                                                             │          item         │                                                  
│           #2          │                                                                                                                             │      return_ratio     │                                                  
│           #3          │                                                                                                                             │      return_rank      │                                                  
│           #4          │                                                                                                                             │     currency_rank     │                                                  
└───────────┬───────────┘                                                                                                                             └───────────┬───────────┘                                                                           
┌───────────┴───────────┐                                                                                                                             ┌───────────┴───────────┐                                                  
│       PROJECTION      │                                                                                                                             │       PROJECTION      │                                                  
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                                                                             │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  
│           #0          │                                                                                                                             │           #0          │                                                  
│           #1          │                                                                                                                             │           #1          │                                                  
│           #2          │                                                                                                                             │           #3          │                                                  
│           #3          │                                                                                                                             │           #4          │                                                  
│           #4          │                                                                                                                             │                       │                                                  
└───────────┬───────────┘                                                                                                                             └───────────┬───────────┘                                                                           
┌───────────┴───────────┐                                                                                                                             ┌───────────┴───────────┐                                                  
│         UNION         │                                                                                                                             │         FILTER        │                                                  
│                       │                                                                                                                             │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  
│                       ├──────────────────────────────────────────────────────────────┐                                                              │((return_rank <= 10) OR│                                                  
│                       │                                                              │                                                              │ (currency_rank <= 10))│                                                  
└───────────┬───────────┘                                                              │                                                              └───────────┬───────────┘                                                                           
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  
│       PROJECTION      │                                                  │       PROJECTION      │                                                  │       PROJECTION      │                                                  
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  
│        channel        │                                                  │        channel        │                                                  │           #0          │                                                  
│          item         │                                                  │          item         │                                                  │           #1          │                                                  
│      return_ratio     │                                                  │      return_ratio     │                                                  │           #2          │                                                  
│      return_rank      │                                                  │      return_rank      │                                                  │           #3          │                                                  
│     currency_rank     │                                                  │     currency_rank     │                                                  │           #4          │                                                  
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘                                                                           
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  
│       PROJECTION      │                                                  │       PROJECTION      │                                                  │         WINDOW        │                                                  
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  
│           #0          │                                                  │           #0          │                                                  │ RANK() OVER (ORDER BY │                                                  
│           #1          │                                                  │           #1          │                                                  │ currency_ratio AS...  │                                                  
│           #3          │                                                  │           #3          │                                                  │         FIRST)        │                                                  
│           #4          │                                                  │           #4          │                                                  │                       │                                                  
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘                                                                           
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  
│         FILTER        │                                                  │         FILTER        │                                                  │         WINDOW        │                                                  
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  
│((return_rank <= 10) OR│                                                  │((return_rank <= 10) OR│                                                  │ RANK() OVER (ORDER BY │                                                  
│ (currency_rank <= 10))│                                                  │ (currency_rank <= 10))│                                                  │ return_ratio ASC NULLS│                                                  
│                       │                                                  │                       │                                                  │         FIRST)        │                                                  
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘                                                                           
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  
│       PROJECTION      │                                                  │       PROJECTION      │                                                  │       PROJECTION      │                                                  
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  
│           #0          │                                                  │           #0          │                                                  │          item         │                                                  
│           #1          │                                                  │           #1          │                                                  │      return_ratio     │                                                  
│           #2          │                                                  │           #2          │                                                  │     currency_ratio    │                                                  
│           #3          │                                                  │           #3          │                                                  │                       │                                                  
│           #4          │                                                  │           #4          │                                                  │                       │                                                  
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘                                                                           
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  
│         WINDOW        │                                                  │         WINDOW        │                                                  │     HASH_GROUP_BY     │                                                  
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  
│ RANK() OVER (ORDER BY │                                                  │ RANK() OVER (ORDER BY │                                                  │           #0          │                                                  
│ currency_ratio AS...  │                                                  │ currency_ratio AS...  │                                                  │        sum(#1)        │                                                  
│         FIRST)        │                                                  │         FIRST)        │                                                  │        sum(#2)        │                                                  
│                       │                                                  │                       │                                                  │        sum(#3)        │                                                  
│                       │                                                  │                       │                                                  │        sum(#4)        │                                                  
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘                                                                           
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  
│         WINDOW        │                                                  │         WINDOW        │                                                  │       PROJECTION      │                                                  
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  
│ RANK() OVER (ORDER BY │                                                  │ RANK() OVER (ORDER BY │                                                  │       ss_item_sk      │                                                  
│ return_ratio ASC NULLS│                                                  │ return_ratio ASC NULLS│                                                  │COALESCE(sr_return_quan│                                                  
│         FIRST)        │                                                  │         FIRST)        │                                                  │        tity, 0)       │                                                  
│                       │                                                  │                       │                                                  │COALESCE(ss_quantity, 0│                                                  
│                       │                                                  │                       │                                                  │           )           │                                                  
│                       │                                                  │                       │                                                  │     COALESCE(CAST     │                                                  
│                       │                                                  │                       │                                                  │(sr_return_amt AS ...  │                                                  
│                       │                                                  │                       │                                                  │          0.00)        │                                                  
│                       │                                                  │                       │                                                  │     COALESCE(CAST     │                                                  
│                       │                                                  │                       │                                                  │(ss_net_paid AS DE...  │                                                  
│                       │                                                  │                       │                                                  │          .00)         │                                                  
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘                                                                           
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  
│       PROJECTION      │                                                  │       PROJECTION      │                                                  │       HASH_JOIN       │                                                  
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  
│          item         │                                                  │          item         │                                                  │         INNER         │                                                  
│      return_ratio     │                                                  │      return_ratio     │                                                  │   ss_sold_date_sk =   ├─────────────────────────────────────┐            
│     currency_ratio    │                                                  │     currency_ratio    │                                                  │        d_date_sk      │                                     │            
│                       │                                                  │                       │                                                  │  EC = 2303976.799634  │                                     │            
│                       │                                                  │                       │                                                  │ COST = 13823860.797802│                                     │            
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘                                     │                                     
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                         ┌───────────┴───────────┐
│     HASH_GROUP_BY     │                                                  │     HASH_GROUP_BY     │                                                  │       HASH_JOIN       │                         │      PARQUET_SCAN     │
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                         │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │
│           #0          │                                                  │           #0          │                                                  │         INNER         │                         │       d_date_sk       │
│        sum(#1)        │                                                  │        sum(#1)        │                                                  │   ss_ticket_number =  │                         │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │
│        sum(#2)        │                                                  │        sum(#2)        │                                                  │    sr_ticket_number   ├────────────┐            │ Filters: d_moy=11 AND │
│        sum(#3)        │                                                  │        sum(#3)        │                                                  │ss_item_sk = sr_item_sk│            │            │    d_moy IS NOT NULL  │
│        sum(#4)        │                                                  │        sum(#4)        │                                                  │  EC = 11519883.998168 │            │            │ d_year=2000 AND d_year│
│                       │                                                  │                       │                                                  │ COST = 11519883.998168│            │            │       IS NOT NULL     │
│                       │                                                  │                       │                                                  │                       │            │            │        EC=8118        │
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────┬───────────┘            │            └───────────────────────┘                         
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                  ┌───────────┴───────────┐┌───────────┴───────────┐                         
│       PROJECTION      │                                                  │       PROJECTION      │                                                  │      PARQUET_SCAN     ││      PARQUET_SCAN     │                         
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                         
│       ws_item_sk      │                                                  │       cs_item_sk      │                                                  │    ss_sold_date_sk    ││       sr_item_sk      │                         
│COALESCE(wr_return_quan│                                                  │COALESCE(cr_return_quan│                                                  │       ss_item_sk      ││    sr_ticket_number   │                         
│        tity, 0)       │                                                  │        tity, 0)       │                                                  │    ss_ticket_number   ││   sr_return_quantity  │                         
│COALESCE(ws_quantity, 0│                                                  │COALESCE(cs_quantity, 0│                                                  │      ss_quantity      ││     sr_return_amt     │                         
│           )           │                                                  │           )           │                                                  │      ss_net_paid      ││   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                         
│     COALESCE(CAST     │                                                  │     COALESCE(CAST     │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   ││ Filters: sr_return_amt│                         
│(wr_return_amt AS ...  │                                                  │(cr_return_amount ...  │                                                  │ Filters: ss_net_paid>0││     >10000.00 AND     │                         
│          0.00)        │                                                  │       )), 0.00)       │                                                  │ .00 AND ss_net_paid IS││ sr_return_amt IS ...  │                         
│     COALESCE(CAST     │                                                  │     COALESCE(CAST     │                                                  │        NOT NULL       ││       EC=5753356      │                         
│(ws_net_paid AS DE...  │                                                  │(cs_net_paid AS DE...  │                                                  │ ss_net_profit>1.00 AND││                       │                         
│          .00)         │                                                  │          .00)         │                                                  │  ss_net_profit IS NOT ││                       │                         
│                       │                                                  │                       │                                                  │          NULL         ││                       │                         
│                       │                                                  │                       │                                                  │   ss_quantity>0 AND   ││                       │                         
│                       │                                                  │                       │                                                  │ ss_quantity IS NO...  ││                       │                         
│                       │                                                  │                       │                                                  │      EC=57599428      ││                       │                         
└───────────┬───────────┘                                                  └───────────┬───────────┘                                                  └───────────────────────┘└───────────────────────┘                                                  
┌───────────┴───────────┐                                                  ┌───────────┴───────────┐                                                                                                                             
│       HASH_JOIN       │                                                  │       HASH_JOIN       │                                                                                                                             
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                  │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                                                                             
│         INNER         │                                                  │         INNER         │                                                                                                                             
│   ws_sold_date_sk =   ├─────────────────────────────────────┐            │   cs_sold_date_sk =   ├─────────────────────────────────────┐                                                                                       
│        d_date_sk      │                                     │            │        d_date_sk      │                                     │                                                                                       
│   EC = 576012.119867  │                                     │            │  EC = 1151983.239743  │                                     │                                                                                       
│ COST = 3456072.719204 │                                     │            │ COST = 6911899.438456 │                                     │                                                                                       
└───────────┬───────────┘                                     │            └───────────┬───────────┘                                     │                                                                                                                
┌───────────┴───────────┐                         ┌───────────┴───────────┐┌───────────┴───────────┐                         ┌───────────┴───────────┐                                                                           
│       HASH_JOIN       │                         │      PARQUET_SCAN     ││       HASH_JOIN       │                         │      PARQUET_SCAN     │                                                                           
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                         │   ─ ─ ─ ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                         │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                           
│         INNER         │                         │       d_date_sk       ││         INNER         │                         │       d_date_sk       │                                                                           
│   ws_order_number =   │                         │   ─ ─ ─ ─ ─ ─ ─ ─ ─   ││   cs_order_number =   │                         │   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                           
│     wr_order_number   ├────────────┐            │ Filters: d_moy=11 AND ││     cr_order_number   ├────────────┐            │ Filters: d_moy=11 AND │                                                                           
│ws_item_sk = wr_item_sk│            │            │    d_moy IS NOT NULL  ││cs_item_sk = cr_item_sk│            │            │    d_moy IS NOT NULL  │                                                                           
│  EC = 2880060.599337  │            │            │ d_year=2000 AND d_year││  EC = 5759916.198713  │            │            │ d_year=2000 AND d_year│                                                                           
│ COST = 2880060.599337 │            │            │       IS NOT NULL     ││ COST = 5759916.198713 │            │            │       IS NOT NULL     │                                                                           
│                       │            │            │        EC=8118        ││                       │            │            │        EC=8118        │                                                                           
└───────────┬───────────┘            │            └───────────────────────┘└───────────┬───────────┘            │            └───────────────────────┘                                                                                                    
┌───────────┴───────────┐┌───────────┴───────────┐                         ┌───────────┴───────────┐┌───────────┴───────────┐                                                                                                    
│      PARQUET_SCAN     ││      PARQUET_SCAN     │                         │      PARQUET_SCAN     ││      PARQUET_SCAN     │                                                                                                    
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                         │   ─ ─ ─ ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                                                    
│    ws_sold_date_sk    ││       wr_item_sk      │                         │    cs_sold_date_sk    ││       cr_item_sk      │                                                                                                    
│       ws_item_sk      ││    wr_order_number    │                         │       cs_item_sk      ││    cr_order_number    │                                                                                                    
│    ws_order_number    ││   wr_return_quantity  │                         │    cs_order_number    ││   cr_return_quantity  │                                                                                                    
│      ws_quantity      ││     wr_return_amt     │                         │      cs_quantity      ││    cr_return_amount   │                                                                                                    
│      ws_net_paid      ││   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                         │      cs_net_paid      ││   ─ ─ ─ ─ ─ ─ ─ ─ ─   │                                                                                                    
│   ─ ─ ─ ─ ─ ─ ─ ─ ─   ││ Filters: wr_return_amt│                         │   ─ ─ ─ ─ ─ ─ ─ ─ ─   ││Filters: cr_return_amou│                                                                                                    
│ Filters: ws_net_paid>0││     >10000.00 AND     │                         │ Filters: cs_net_paid>0││    nt>10000.00 AND    │                                                                                                    
│ .00 AND ws_net_paid IS││ wr_return_amt IS ...  │                         │ .00 AND cs_net_paid IS││ cr_return_amount ...  │                                                                                                    
│        NOT NULL       ││       EC=1438838      │                         │        NOT NULL       ││       EC=2875334      │                                                                                                    
│ ws_net_profit>1.00 AND││                       │                         │ cs_net_profit>1.00 AND││                       │                                                                                                    
│  ws_net_profit IS NOT ││                       │                         │  cs_net_profit IS NOT ││                       │                                                                                                    
│          NULL         ││                       │                         │          NULL         ││                       │                                                                                                    
│   ws_quantity>0 AND   ││                       │                         │   cs_quantity>0 AND   ││                       │                                                                                                    
│ ws_quantity IS NO...  ││                       │                         │ cs_quantity IS NO...  ││                       │                                                                                                    
│      EC=14400307      ││                       │                         │      EC=28799585      ││                       │                                                                                                    
└───────────────────────┘└───────────────────────┘                         └───────────────────────┘└───────────────────────┘                                                                                                                             

