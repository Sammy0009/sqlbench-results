┌─────────────────┐                                                                                                                                                                                                                 
│      TOP_N      │                                                                                                                                                                                                                 
│   ─ ─ ─ ─ ─ ─   │                                                                                                                                                                                                                 
│     Top 100     │                                                                                                                                                                                                                 
│   ─ ─ ─ ─ ─ ─   │                                                                                                                                                                                                                 
│   t_s_secyear   │                                                                                                                                                                                                                 
│ .customer_id ASC│                                                                                                                                                                                                                 
│   t_s_secyear   │                                                                                                                                                                                                                 
│.customer_fi...  │                                                                                                                                                                                                                 
│        ASC      │                                                                                                                                                                                                                 
│   t_s_secyear   │                                                                                                                                                                                                                 
│.customer_la...  │                                                                                                                                                                                                                 
│   t_s_secyear   │                                                                                                                                                                                                                 
│.customer_bi...  │                                                                                                                                                                                                                 
│        ASC      │                                                                                                                                                                                                                 
└────────┬────────┘                                                                                                                                                                                                                                    
┌────────┴────────┐                                                                                                                                                                                                                 
│    PROJECTION   │                                                                                                                                                                                                                 
│   ─ ─ ─ ─ ─ ─   │                                                                                                                                                                                                                 
│        #0       │                                                                                                                                                                                                                 
│        #2       │                                                                                                                                                                                                                 
│        #3       │                                                                                                                                                                                                                 
│        #4       │                                                                                                                                                                                                                 
└────────┬────────┘                                                                                                                                                                                                                                    
┌────────┴────────┐                                                                                                                                                                                                                 
│      FILTER     │                                                                                                                                                                                                                 
│   ─ ─ ─ ─ ─ ─   │                                                                                                                                                                                                                 
│  (CASE  WHEN (  │                                                                                                                                                                                                                 
│(year_total ...  │                                                                                                                                                                                                                 
│    THEN ((CAST  │                                                                                                                                                                                                                 
│(year_total ...  │                                                                                                                                                                                                                 
│/ CAST(year_total│                                                                                                                                                                                                                 
│   AS DOUBLE)))  │                                                                                                                                                                                                                 
│ ELSE 0.0 EN...  │                                                                                                                                                                                                                 
│ WHEN ((year_tota│                                                                                                                                                                                                                 
│l > 0.00)) THEN (│                                                                                                                                                                                                                 
│ (CAST(year_total│                                                                                                                                                                                                                 
│ AS DOUBLE) ...  │                                                                                                                                                                                                                 
│  (year_total AS │                                                                                                                                                                                                                 
│ DOUBLE))) E...  │                                                                                                                                                                                                                 
│       END)      │                                                                                                                                                                                                                 
└────────┬────────┘                                                                                                                                                                                                                                    
┌────────┴────────┐                                                                                                                                                                                                                 
│    HASH_JOIN    │                                                                                                                                                                                                                 
│   ─ ─ ─ ─ ─ ─   │                                                                                                                                                                                                                 
│      INNER      │                                                                                                                                                                                                                 
│  customer_id =  │                                                                                                                                                                                                                 
│    customer_id  │                                                                                                                                                                                                                 
│  customer_id =  │                                                                                                                                                                                                                 
│    customer_id  ├───────────────────────────────────────────────┐                                                                                                                                                                 
│  customer_id =  │                                               │                                                                                                                                                                 
│    customer_id  │                                               │                                                                                                                                                                 
│  EC = 230390512 │                                               │                                                                                                                                                                 
│     .224995     │                                               │                                                                                                                                                                 
│ COST = 302390247│                                               │                                                                                                                                                                 
│     .224995     │                                               │                                                                                                                                                                 
└────────┬────────┘                                               │                                                                                                                                                                                    
┌────────┴────────┐                                      ┌────────┴────────┐                                                                                                                                                        
│    PROJECTION   │                                      │    HASH_JOIN    │                                                                                                                                                        
│   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                                                                                                                                        
│        #0       │                                      │      INNER      │                                                                                                                                                        
│        #8       │                                      │  customer_id =  │                                                                                                                                                        
│                 │                                      │    customer_id  │                                                                                                                                                        
│                 │                                      │  customer_id =  ├───────────────────────────────────────────────┐                                                                                                        
│                 │                                      │    customer_id  │                                               │                                                                                                        
│                 │                                      │  EC = 57599428  │                                               │                                                                                                        
│                 │                                      │     .000000     │                                               │                                                                                                        
│                 │                                      │ COST = 71999735 │                                               │                                                                                                        
│                 │                                      │     .000000     │                                               │                                                                                                        
└────────┬────────┘                                      └────────┬────────┘                                               │                                                                                                                           
┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐                                                                                               
│      FILTER     │                                      │    PROJECTION   │                                      │    HASH_JOIN    │                                                                                               
│   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                                                                               
│ (year_total > 0 │                                      │   customer_id   │                                      │      INNER      │                                                                                               
│       .00)      │                                      │customer_first_na│                                      │  customer_id =  │                                                                                               
│                 │                                      │        me       │                                      │    customer_id  │                                                                                               
│                 │                                      │customer_last_nam│                                      │  EC = 14400307  ├───────────────────────────────────────────────┐                                               
│                 │                                      │        e        │                                      │     .000000     │                                               │                                               
│                 │                                      │customer_birth_co│                                      │ COST = 14400307 │                                               │                                               
│                 │                                      │      untry      │                                      │     .000000     │                                               │                                               
│                 │                                      │    year_total   │                                      │                 │                                               │                                               
└────────┬────────┘                                      └────────┬────────┘                                      └────────┬────────┘                                               │                                                                  
┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐                                      
│  HASH_GROUP_BY  │                                      │  HASH_GROUP_BY  │                                      │    PROJECTION   │                                      │    PROJECTION   │                                      
│   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      
│        #0       │                                      │        #0       │                                      │        #0       │                                      │   customer_id   │                                      
│        #1       │                                      │        #1       │                                      │        #8       │                                      │    year_total   │                                      
│        #2       │                                      │        #2       │                                      │                 │                                      │                 │                                      
│        #3       │                                      │        #3       │                                      │                 │                                      │                 │                                      
│        #4       │                                      │        #4       │                                      │                 │                                      │                 │                                      
│        #5       │                                      │        #5       │                                      │                 │                                      │                 │                                      
│        #6       │                                      │        #6       │                                      │                 │                                      │                 │                                      
│        #7       │                                      │        #7       │                                      │                 │                                      │                 │                                      
│     sum(#8)     │                                      │     sum(#8)     │                                      │                 │                                      │                 │                                      
└────────┬────────┘                                      └────────┬────────┘                                      └────────┬────────┘                                      └────────┬────────┘                                                         
┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐                                      
│    PROJECTION   │                                      │    PROJECTION   │                                      │      FILTER     │                                      │  HASH_GROUP_BY  │                                      
│   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      
│  c_customer_id  │                                      │  c_customer_id  │                                      │ (year_total > 0 │                                      │        #0       │                                      
│   c_first_name  │                                      │   c_first_name  │                                      │       .00)      │                                      │        #1       │                                      
│   c_last_name   │                                      │   c_last_name   │                                      │                 │                                      │        #2       │                                      
│c_preferred_cust_│                                      │c_preferred_cust_│                                      │                 │                                      │        #3       │                                      
│       flag      │                                      │       flag      │                                      │                 │                                      │        #4       │                                      
│ c_birth_country │                                      │ c_birth_country │                                      │                 │                                      │        #5       │                                      
│     c_login     │                                      │     c_login     │                                      │                 │                                      │        #6       │                                      
│ c_email_address │                                      │ c_email_address │                                      │                 │                                      │        #7       │                                      
│      d_year     │                                      │      d_year     │                                      │                 │                                      │     sum(#8)     │                                      
│(ss_ext_list_pric│                                      │(ss_ext_list_pric│                                      │                 │                                      │                 │                                      
│e - ss_ext_discou│                                      │e - ss_ext_discou│                                      │                 │                                      │                 │                                      
│     nt_amt)     │                                      │     nt_amt)     │                                      │                 │                                      │                 │                                      
└────────┬────────┘                                      └────────┬────────┘                                      └────────┬────────┘                                      └────────┬────────┘                                                         
┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐                                      ┌────────┴────────┐                                      
│    HASH_JOIN    │                                      │    HASH_JOIN    │                                      │  HASH_GROUP_BY  │                                      │    PROJECTION   │                                      
│   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      
│      INNER      │                                      │      INNER      │                                      │        #0       │                                      │  c_customer_id  │                                      
│ ss_customer_sk =│                                      │ ss_customer_sk =│                                      │        #1       │                                      │   c_first_name  │                                      
│   c_customer_sk │                                      │   c_customer_sk │                                      │        #2       │                                      │   c_last_name   │                                      
│  EC = 57599428  │                                      │  EC = 57599428  │                                      │        #3       │                                      │c_preferred_cust_│                                      
│     .800000     │                                      │     .800000     │                                      │        #4       │                                      │       flag      │                                      
│ COST = 115198857├────────────────────────────┐         │ COST = 115198857├────────────────────────────┐         │        #5       │                                      │ c_birth_country │                                      
│     .600000     │                            │         │     .600000     │                            │         │        #6       │                                      │     c_login     │                                      
│                 │                            │         │                 │                            │         │        #7       │                                      │ c_email_address │                                      
│                 │                            │         │                 │                            │         │     sum(#8)     │                                      │      d_year     │                                      
│                 │                            │         │                 │                            │         │                 │                                      │(ws_ext_list_pric│                                      
│                 │                            │         │                 │                            │         │                 │                                      │e - ws_ext_discou│                                      
│                 │                            │         │                 │                            │         │                 │                                      │     nt_amt)     │                                      
└────────┬────────┘                            │         └────────┬────────┘                            │         └────────┬────────┘                                      └────────┬────────┘                                                         
┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐                                      ┌────────┴────────┐                                      
│    HASH_JOIN    │                   │   PARQUET_SCAN  ││    HASH_JOIN    │                   │   PARQUET_SCAN  ││    PROJECTION   │                                      │    HASH_JOIN    │                                      
│   ─ ─ ─ ─ ─ ─   │                   │   ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─   │                   │   ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                                      
│      INNER      │                   │  c_customer_sk  ││      INNER      │                   │  c_customer_sk  ││  c_customer_id  │                                      │      INNER      │                                      
│ss_sold_date_sk =│                   │  c_customer_id  ││ss_sold_date_sk =│                   │  c_customer_id  ││   c_first_name  │                                      │ws_bill_customer_│                                      
│     d_date_sk   │                   │   c_first_name  ││     d_date_sk   │                   │   c_first_name  ││   c_last_name   │                                      │sk = c_customer_s│                                      
│  EC = 57599428  │                   │   c_last_name   ││  EC = 57599428  │                   │   c_last_name   ││c_preferred_cust_│                                      │        k        │                                      
│     .800000     │                   │c_preferred_cust_││     .800000     │                   │c_preferred_cust_││       flag      │                                      │  EC = 14400307  │                                      
│ COST = 57599428 ├─────────┐         │       flag      ││ COST = 57599428 ├─────────┐         │       flag      ││ c_birth_country │                                      │     .200000     ├────────────────────────────┐         
│     .800000     │         │         │ c_birth_country ││     .800000     │         │         │ c_birth_country ││     c_login     │                                      │ COST = 28800614 │                            │         
│                 │         │         │     c_login     ││                 │         │         │     c_login     ││ c_email_address │                                      │     .400000     │                            │         
│                 │         │         │ c_email_address ││                 │         │         │ c_email_address ││      d_year     │                                      │                 │                            │         
│                 │         │         │    EC=1999968   ││                 │         │         │    EC=1999968   ││(ws_ext_list_pric│                                      │                 │                            │         
│                 │         │         │                 ││                 │         │         │                 ││e - ws_ext_discou│                                      │                 │                            │         
│                 │         │         │                 ││                 │         │         │                 ││     nt_amt)     │                                      │                 │                            │         
└────────┬────────┘         │         └─────────────────┘└────────┬────────┘         │         └─────────────────┘└────────┬────────┘                                      └────────┬────────┘                            │                            
┌────────┴────────┐┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐                   ┌────────┴────────┐                                      ┌────────┴────────┐                   ┌────────┴────────┐
│   PARQUET_SCAN  ││   PARQUET_SCAN  │                   │   PARQUET_SCAN  ││   PARQUET_SCAN  │                   │    HASH_JOIN    │                                      │    HASH_JOIN    │                   │   PARQUET_SCAN  │
│   ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─   │                   │   ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─   │                   │   ─ ─ ─ ─ ─ ─   │                                      │   ─ ─ ─ ─ ─ ─   │                   │   ─ ─ ─ ─ ─ ─   │
│ ss_sold_date_sk ││    d_date_sk    │                   │ ss_sold_date_sk ││    d_date_sk    │                   │      INNER      │                                      │      INNER      │                   │  c_customer_sk  │
│  ss_customer_sk ││      d_year     │                   │  ss_customer_sk ││      d_year     │                   │ws_bill_customer_│                                      │ws_sold_date_sk =│                   │  c_customer_id  │
│ss_ext_discount_a││   ─ ─ ─ ─ ─ ─   │                   │ss_ext_discount_a││   ─ ─ ─ ─ ─ ─   │                   │sk = c_customer_s│                                      │     d_date_sk   │                   │   c_first_name  │
│        mt       ││ Filters: d_year │                   │        mt       ││ Filters: d_year │                   │        k        │                                      │  EC = 14400307  │                   │   c_last_name   │
│ss_ext_list_price││=1998 AND d_...  │                   │ss_ext_list_price││=1999 AND d_...  │                   │  EC = 14400307  ├────────────────────────────┐         │     .200000     ├─────────┐         │c_preferred_cust_│
│   EC=287997144  ││     NOT NULL    │                   │   EC=287997144  ││     NOT NULL    │                   │     .200000     │                            │         │ COST = 14400307 │         │         │       flag      │
│                 ││     EC=8118     │                   │                 ││     EC=8118     │                   │ COST = 28800614 │                            │         │     .200000     │         │         │ c_birth_country │
│                 ││                 │                   │                 ││                 │                   │     .400000     │                            │         │                 │         │         │     c_login     │
│                 ││                 │                   │                 ││                 │                   │                 │                            │         │                 │         │         │ c_email_address │
│                 ││                 │                   │                 ││                 │                   │                 │                            │         │                 │         │         │    EC=1999968   │
└─────────────────┘└─────────────────┘                   └─────────────────┘└─────────────────┘                   └────────┬────────┘                            │         └────────┬────────┘         │         └─────────────────┘                   
                                                                                                                  ┌────────┴────────┐                   ┌────────┴────────┐┌────────┴────────┐┌────────┴────────┐                   
                                                                                                                  │    HASH_JOIN    │                   │   PARQUET_SCAN  ││   PARQUET_SCAN  ││   PARQUET_SCAN  │                   
                                                                                                                  │   ─ ─ ─ ─ ─ ─   │                   │   ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─   │                   
                                                                                                                  │      INNER      │                   │  c_customer_sk  ││ ws_sold_date_sk ││    d_date_sk    │                   
                                                                                                                  │ws_sold_date_sk =│                   │  c_customer_id  ││ws_bill_customer_││      d_year     │                   
                                                                                                                  │     d_date_sk   │                   │   c_first_name  ││        sk       ││   ─ ─ ─ ─ ─ ─   │                   
                                                                                                                  │  EC = 14400307  │                   │   c_last_name   ││ws_ext_discount_a││ Filters: d_year │                   
                                                                                                                  │     .200000     ├─────────┐         │c_preferred_cust_││        mt       ││=1999 AND d_...  │                   
                                                                                                                  │ COST = 14400307 │         │         │       flag      ││ws_ext_list_price││     NOT NULL    │                   
                                                                                                                  │     .200000     │         │         │ c_birth_country ││   EC=72001536   ││     EC=8118     │                   
                                                                                                                  │                 │         │         │     c_login     ││                 ││                 │                   
                                                                                                                  │                 │         │         │ c_email_address ││                 ││                 │                   
                                                                                                                  │                 │         │         │    EC=1999968   ││                 ││                 │                   
                                                                                                                  └────────┬────────┘         │         └─────────────────┘└─────────────────┘└─────────────────┘                                      
                                                                                                                  ┌────────┴────────┐┌────────┴────────┐                                                                            
                                                                                                                  │   PARQUET_SCAN  ││   PARQUET_SCAN  │                                                                            
                                                                                                                  │   ─ ─ ─ ─ ─ ─   ││   ─ ─ ─ ─ ─ ─   │                                                                            
                                                                                                                  │ ws_sold_date_sk ││    d_date_sk    │                                                                            
                                                                                                                  │ws_bill_customer_││      d_year     │                                                                            
                                                                                                                  │        sk       ││   ─ ─ ─ ─ ─ ─   │                                                                            
                                                                                                                  │ws_ext_discount_a││ Filters: d_year │                                                                            
                                                                                                                  │        mt       ││=1998 AND d_...  │                                                                            
                                                                                                                  │ws_ext_list_price││     NOT NULL    │                                                                            
                                                                                                                  │   EC=72001536   ││     EC=8118     │                                                                            
                                                                                                                  └─────────────────┘└─────────────────┘                                                                                               

