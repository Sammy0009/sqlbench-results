AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[lochierarchy#18434 DESC NULLS LAST,CASE WHEN (lochierarchy#18434 = 0) THEN i_category#18443 END ASC NULLS FIRST,rank_within_parent#18435 ASC NULLS FIRST], output=[total_sum#18433,i_category#18443,i_class#18444,lochierarchy#18434,rank_within_parent#18435])
   +- *(6) Project [total_sum#18433, i_category#18443, i_class#18444, lochierarchy#18434, rank_within_parent#18435]
      +- Window [rank(_w3#18459) windowspecdefinition(_w1#18457, _w2#18458, _w3#18459 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#18435], [_w1#18457, _w2#18458], [_w3#18459 DESC NULLS LAST]
         +- *(5) Sort [_w1#18457 ASC NULLS FIRST, _w2#18458 ASC NULLS FIRST, _w3#18459 DESC NULLS LAST], false, 0
            +- AQEShuffleRead coalesced
               +- ShuffleQueryStage 3
                  +- Exchange hashpartitioning(_w1#18457, _w2#18458, 200), ENSURE_REQUIREMENTS, [id=#144095]
                     +- *(4) HashAggregate(keys=[i_category#18443, i_class#18444, spark_grouping_id#18442L], functions=[sum(UnscaledValue(ws_net_paid#413))], output=[total_sum#18433, i_category#18443, i_class#18444, lochierarchy#18434, _w1#18457, _w2#18458, _w3#18459])
                        +- AQEShuffleRead coalesced
                           +- ShuffleQueryStage 2
                              +- Exchange hashpartitioning(i_category#18443, i_class#18444, spark_grouping_id#18442L, 200), ENSURE_REQUIREMENTS, [id=#144042]
                                 +- *(3) HashAggregate(keys=[i_category#18443, i_class#18444, spark_grouping_id#18442L], functions=[partial_sum(UnscaledValue(ws_net_paid#413))], output=[i_category#18443, i_class#18444, spark_grouping_id#18442L, sum#18472L])
                                    +- *(3) Expand [[ws_net_paid#413, i_category#512, i_class#510, 0], [ws_net_paid#413, i_category#512, null, 1], [ws_net_paid#413, null, null, 3]], [ws_net_paid#413, i_category#18443, i_class#18444, spark_grouping_id#18442L]
                                       +- *(3) Project [ws_net_paid#413, i_category#512, i_class#510]
                                          +- *(3) BroadcastHashJoin [ws_item_sk#387], [i_item_sk#500], Inner, BuildRight, false
                                             :- *(3) Project [ws_item_sk#387, ws_net_paid#413]
                                             :  +- *(3) BroadcastHashJoin [ws_sold_date_sk#384], [d_date_sk#598], Inner, BuildRight, false
                                             :     :- *(3) Filter (isnotnull(ws_sold_date_sk#384) AND isnotnull(ws_item_sk#387))
                                             :     :  +- *(3) ColumnarToRow
                                             :     :     +- FileScan parquet [ws_sold_date_sk#384,ws_item_sk#387,ws_net_paid#413] Batched: true, DataFilters: [isnotnull(ws_sold_date_sk#384), isnotnull(ws_item_sk#387)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_sold_date_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_net_paid:decimal(7,2)>
                                             :     +- BroadcastQueryStage 0
                                             :        +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#143857]
                                             :           +- *(1) Project [d_date_sk#598]
                                             :              +- *(1) Filter (((isnotnull(d_month_seq#601) AND (d_month_seq#601 >= 1205)) AND (d_month_seq#601 <= 1216)) AND isnotnull(d_date_sk#598))
                                             :                 +- *(1) ColumnarToRow
                                             :                    +- FileScan parquet [d_date_sk#598,d_month_seq#601] Batched: true, DataFilters: [isnotnull(d_month_seq#601), (d_month_seq#601 >= 1205), (d_month_seq#601 <= 1216), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1205), LessThanOrEqual(d_month_seq,1216),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
                                             +- BroadcastQueryStage 1
                                                +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#143876]
                                                   +- *(2) Filter isnotnull(i_item_sk#500)
                                                      +- *(2) ColumnarToRow
                                                         +- FileScan parquet [i_item_sk#500,i_class#510,i_category#512] Batched: true, DataFilters: [isnotnull(i_item_sk#500)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_class:string,i_category:string>
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[lochierarchy#18434 DESC NULLS LAST,CASE WHEN (lochierarchy#18434 = 0) THEN i_category#18443 END ASC NULLS FIRST,rank_within_parent#18435 ASC NULLS FIRST], output=[total_sum#18433,i_category#18443,i_class#18444,lochierarchy#18434,rank_within_parent#18435])
   +- Project [total_sum#18433, i_category#18443, i_class#18444, lochierarchy#18434, rank_within_parent#18435]
      +- Window [rank(_w3#18459) windowspecdefinition(_w1#18457, _w2#18458, _w3#18459 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#18435], [_w1#18457, _w2#18458], [_w3#18459 DESC NULLS LAST]
         +- Sort [_w1#18457 ASC NULLS FIRST, _w2#18458 ASC NULLS FIRST, _w3#18459 DESC NULLS LAST], false, 0
            +- Exchange hashpartitioning(_w1#18457, _w2#18458, 200), ENSURE_REQUIREMENTS, [id=#143812]
               +- HashAggregate(keys=[i_category#18443, i_class#18444, spark_grouping_id#18442L], functions=[sum(UnscaledValue(ws_net_paid#413))], output=[total_sum#18433, i_category#18443, i_class#18444, lochierarchy#18434, _w1#18457, _w2#18458, _w3#18459])
                  +- Exchange hashpartitioning(i_category#18443, i_class#18444, spark_grouping_id#18442L, 200), ENSURE_REQUIREMENTS, [id=#143809]
                     +- HashAggregate(keys=[i_category#18443, i_class#18444, spark_grouping_id#18442L], functions=[partial_sum(UnscaledValue(ws_net_paid#413))], output=[i_category#18443, i_class#18444, spark_grouping_id#18442L, sum#18472L])
                        +- Expand [[ws_net_paid#413, i_category#512, i_class#510, 0], [ws_net_paid#413, i_category#512, null, 1], [ws_net_paid#413, null, null, 3]], [ws_net_paid#413, i_category#18443, i_class#18444, spark_grouping_id#18442L]
                           +- Project [ws_net_paid#413, i_category#512, i_class#510]
                              +- BroadcastHashJoin [ws_item_sk#387], [i_item_sk#500], Inner, BuildRight, false
                                 :- Project [ws_item_sk#387, ws_net_paid#413]
                                 :  +- BroadcastHashJoin [ws_sold_date_sk#384], [d_date_sk#598], Inner, BuildRight, false
                                 :     :- Filter (isnotnull(ws_sold_date_sk#384) AND isnotnull(ws_item_sk#387))
                                 :     :  +- FileScan parquet [ws_sold_date_sk#384,ws_item_sk#387,ws_net_paid#413] Batched: true, DataFilters: [isnotnull(ws_sold_date_sk#384), isnotnull(ws_item_sk#387)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_sold_date_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_net_paid:decimal(7,2)>
                                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#143799]
                                 :        +- Project [d_date_sk#598]
                                 :           +- Filter (((isnotnull(d_month_seq#601) AND (d_month_seq#601 >= 1205)) AND (d_month_seq#601 <= 1216)) AND isnotnull(d_date_sk#598))
                                 :              +- FileScan parquet [d_date_sk#598,d_month_seq#601] Batched: true, DataFilters: [isnotnull(d_month_seq#601), (d_month_seq#601 >= 1205), (d_month_seq#601 <= 1216), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1205), LessThanOrEqual(d_month_seq,1216),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
                                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#143803]
                                    +- Filter isnotnull(i_item_sk#500)
                                       +- FileScan parquet [i_item_sk#500,i_class#510,i_category#512] Batched: true, DataFilters: [isnotnull(i_item_sk#500)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_class:string,i_category:string>
