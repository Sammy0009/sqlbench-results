AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   GpuColumnarToRow false
   +- GpuTopN(limit=100, orderBy=[lochierarchy#31190 DESC NULLS LAST,CASE WHEN (lochierarchy#31190 = 0) THEN i_category#31199 END ASC NULLS FIRST,rank_within_parent#31191 ASC NULLS FIRST], output=[total_sum#31189,i_category#31199,i_class#31200,lochierarchy#31190,rank_within_parent#31191])
      +- GpuProject [total_sum#31189, i_category#31199, i_class#31200, lochierarchy#31190, rank_within_parent#31191], true
         +- GpuRunningWindow [total_sum#31189, i_category#31199, i_class#31200, lochierarchy#31190, _w1#31213, _w2#31214, _w3#31215, gpurank(_w3#31215) gpuwindowspecdefinition(_w1#31213, _w2#31214, _w3#31215 DESC NULLS LAST, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(currentrow$()))) AS rank_within_parent#31191], [_w1#31213, _w2#31214], [_w3#31215 DESC NULLS LAST]
            +- GpuSort [_w1#31213 ASC NULLS FIRST, _w2#31214 ASC NULLS FIRST, _w3#31215 DESC NULLS LAST], false, com.nvidia.spark.rapids.OutOfCoreSort$@59d99269
               +- GpuRowToColumnar targetsize(2147483647)
                  +- AQEShuffleRead coalesced
                     +- ShuffleQueryStage 5
                        +- Exchange hashpartitioning(_w1#31213, _w2#31214, 200), ENSURE_REQUIREMENTS, [id=#524069]
                           +- *(1) HashAggregate(keys=[i_category#31199, i_class#31200, spark_grouping_id#31198L], functions=[sum(UnscaledValue(ws_net_paid#505))], output=[total_sum#31189, i_category#31199, i_class#31200, lochierarchy#31190, _w1#31213, _w2#31214, _w3#31215])
                              +- GpuColumnarToRow false
                                 +- GpuShuffleCoalesce 2147483647
                                    +- GpuCustomShuffleReader coalesced
                                       +- ShuffleQueryStage 4
                                          +- GpuColumnarExchange gpuhashpartitioning(i_category#31199, i_class#31200, spark_grouping_id#31198L, 200), ENSURE_REQUIREMENTS, [id=#523980]
                                             +- GpuHashAggregate(keys=[i_category#31199, i_class#31200, spark_grouping_id#31198L], functions=[partial_gpubasicsum(UnscaledValue(ws_net_paid#505), LongType, false)], output=[i_category#31199, i_class#31200, spark_grouping_id#31198L, sum#31228L])
                                                +- GpuExpand [[ws_net_paid#505, i_category#680, i_class#678, 0], [ws_net_paid#505, i_category#680, null, 1], [ws_net_paid#505, null, null, 3]], [ws_net_paid#505, i_category#31199, i_class#31200, spark_grouping_id#31198L]
                                                   +- GpuProject [ws_net_paid#505, i_category#680, i_class#678], true
                                                      +- GpuShuffledHashJoin [ws_item_sk#479], [i_item_sk#668], Inner, GpuBuildRight, false
                                                         :- GpuShuffleCoalesce 2147483647
                                                         :  +- GpuCustomShuffleReader coalesced
                                                         :     +- ShuffleQueryStage 3
                                                         :        +- GpuColumnarExchange gpuhashpartitioning(ws_item_sk#479, 200), ENSURE_REQUIREMENTS, [id=#523792]
                                                         :           +- GpuProject [ws_item_sk#479, ws_net_paid#505], true
                                                         :              +- GpuShuffledHashJoin [ws_sold_date_sk#476], [d_date_sk#612], Inner, GpuBuildRight, false
                                                         :                 :- GpuShuffleCoalesce 2147483647
                                                         :                 :  +- GpuCustomShuffleReader coalesced
                                                         :                 :     +- ShuffleQueryStage 0
                                                         :                 :        +- GpuColumnarExchange gpuhashpartitioning(ws_sold_date_sk#476, 200), ENSURE_REQUIREMENTS, [id=#523275]
                                                         :                 :           +- GpuCoalesceBatches targetsize(2147483647)
                                                         :                 :              +- GpuFilter (gpuisnotnull(ws_sold_date_sk#476) AND gpuisnotnull(ws_item_sk#479)), true
                                                         :                 :                 +- GpuFileGpuScan parquet [ws_sold_date_sk#476,ws_item_sk#479,ws_net_paid#505] Batched: true, DataFilters: [isnotnull(ws_sold_date_sk#476), isnotnull(ws_item_sk#479)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_sold_date_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_net_paid:decimal(7,2)>
                                                         :                 +- GpuCustomShuffleReader coalesced
                                                         :                    +- ShuffleQueryStage 1
                                                         :                       +- GpuColumnarExchange gpuhashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#523312]
                                                         :                          +- GpuProject [d_date_sk#612], true
                                                         :                             +- GpuCoalesceBatches targetsize(2147483647)
                                                         :                                +- GpuFilter (((gpuisnotnull(d_month_seq#615) AND (d_month_seq#615 >= 1205)) AND (d_month_seq#615 <= 1216)) AND gpuisnotnull(d_date_sk#612)), true
                                                         :                                   +- GpuFileGpuScan parquet [d_date_sk#612,d_month_seq#615] Batched: true, DataFilters: [isnotnull(d_month_seq#615), (d_month_seq#615 >= 1205), (d_month_seq#615 <= 1216), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1205), LessThanOrEqual(d_month_seq,1216),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
                                                         +- GpuCustomShuffleReader coalesced
                                                            +- ShuffleQueryStage 2
                                                               +- GpuColumnarExchange gpuhashpartitioning(i_item_sk#668, 200), ENSURE_REQUIREMENTS, [id=#523346]
                                                                  +- GpuCoalesceBatches targetsize(2147483647)
                                                                     +- GpuFilter gpuisnotnull(i_item_sk#668), true
                                                                        +- GpuFileGpuScan parquet [i_item_sk#668,i_class#678,i_category#680] Batched: true, DataFilters: [isnotnull(i_item_sk#668)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_class:string,i_category:string>
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[lochierarchy#31190 DESC NULLS LAST,CASE WHEN (lochierarchy#31190 = 0) THEN i_category#31199 END ASC NULLS FIRST,rank_within_parent#31191 ASC NULLS FIRST], output=[total_sum#31189,i_category#31199,i_class#31200,lochierarchy#31190,rank_within_parent#31191])
   +- Project [total_sum#31189, i_category#31199, i_class#31200, lochierarchy#31190, rank_within_parent#31191]
      +- Window [rank(_w3#31215) windowspecdefinition(_w1#31213, _w2#31214, _w3#31215 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rank_within_parent#31191], [_w1#31213, _w2#31214], [_w3#31215 DESC NULLS LAST]
         +- Sort [_w1#31213 ASC NULLS FIRST, _w2#31214 ASC NULLS FIRST, _w3#31215 DESC NULLS LAST], false, 0
            +- Exchange hashpartitioning(_w1#31213, _w2#31214, 200), ENSURE_REQUIREMENTS, [id=#522891]
               +- HashAggregate(keys=[i_category#31199, i_class#31200, spark_grouping_id#31198L], functions=[sum(UnscaledValue(ws_net_paid#505))], output=[total_sum#31189, i_category#31199, i_class#31200, lochierarchy#31190, _w1#31213, _w2#31214, _w3#31215])
                  +- Exchange hashpartitioning(i_category#31199, i_class#31200, spark_grouping_id#31198L, 200), ENSURE_REQUIREMENTS, [id=#522888]
                     +- HashAggregate(keys=[i_category#31199, i_class#31200, spark_grouping_id#31198L], functions=[partial_sum(UnscaledValue(ws_net_paid#505))], output=[i_category#31199, i_class#31200, spark_grouping_id#31198L, sum#31228L])
                        +- Expand [[ws_net_paid#505, i_category#680, i_class#678, 0], [ws_net_paid#505, i_category#680, null, 1], [ws_net_paid#505, null, null, 3]], [ws_net_paid#505, i_category#31199, i_class#31200, spark_grouping_id#31198L]
                           +- Project [ws_net_paid#505, i_category#680, i_class#678]
                              +- SortMergeJoin [ws_item_sk#479], [i_item_sk#668], Inner
                                 :- Sort [ws_item_sk#479 ASC NULLS FIRST], false, 0
                                 :  +- Exchange hashpartitioning(ws_item_sk#479, 200), ENSURE_REQUIREMENTS, [id=#522879]
                                 :     +- Project [ws_item_sk#479, ws_net_paid#505]
                                 :        +- SortMergeJoin [ws_sold_date_sk#476], [d_date_sk#612], Inner
                                 :           :- Sort [ws_sold_date_sk#476 ASC NULLS FIRST], false, 0
                                 :           :  +- Exchange hashpartitioning(ws_sold_date_sk#476, 200), ENSURE_REQUIREMENTS, [id=#522871]
                                 :           :     +- Filter (isnotnull(ws_sold_date_sk#476) AND isnotnull(ws_item_sk#479))
                                 :           :        +- FileScan parquet [ws_sold_date_sk#476,ws_item_sk#479,ws_net_paid#505] Batched: true, DataFilters: [isnotnull(ws_sold_date_sk#476), isnotnull(ws_item_sk#479)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_sold_date_sk), IsNotNull(ws_item_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_net_paid:decimal(7,2)>
                                 :           +- Sort [d_date_sk#612 ASC NULLS FIRST], false, 0
                                 :              +- Exchange hashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#522872]
                                 :                 +- Project [d_date_sk#612]
                                 :                    +- Filter (((isnotnull(d_month_seq#615) AND (d_month_seq#615 >= 1205)) AND (d_month_seq#615 <= 1216)) AND isnotnull(d_date_sk#612))
                                 :                       +- FileScan parquet [d_date_sk#612,d_month_seq#615] Batched: true, DataFilters: [isnotnull(d_month_seq#615), (d_month_seq#615 >= 1205), (d_month_seq#615 <= 1216), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1205), LessThanOrEqual(d_month_seq,1216),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
                                 +- Sort [i_item_sk#668 ASC NULLS FIRST], false, 0
                                    +- Exchange hashpartitioning(i_item_sk#668, 200), ENSURE_REQUIREMENTS, [id=#522880]
                                       +- Filter isnotnull(i_item_sk#668)
                                          +- FileScan parquet [i_item_sk#668,i_class#678,i_category#680] Batched: true, DataFilters: [isnotnull(i_item_sk#668)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_class:string,i_category:string>
