AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   GpuColumnarToRow false
   +- GpuTopN(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#33548 ASC NULLS FIRST,sm_type#446 ASC NULLS FIRST,cc_name#6 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#33548,sm_type#446,cc_name#6,30 days#33538L,31-60 days#33539L,61-90 days#33540L,91-120 days#33541L,>120 days#33542L])
      +- GpuShuffleCoalesce 2147483647
         +- GpuColumnarExchange gpusinglepartitioning$(), ENSURE_REQUIREMENTS, [id=#570604]
            +- GpuTopN(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#33548 ASC NULLS FIRST,sm_type#446 ASC NULLS FIRST,cc_name#6 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#33548,sm_type#446,cc_name#6,30 days#33538L,31-60 days#33539L,61-90 days#33540L,91-120 days#33541L,>120 days#33542L])
               +- GpuHashAggregate(keys=[_groupingexpression#33557, sm_type#446, cc_name#6], functions=[gpubasicsum(CASE WHEN ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 30) THEN 1 ELSE 0 END, LongType, false), gpubasicsum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 30) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 60)) THEN 1 ELSE 0 END, LongType, false), gpubasicsum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 60) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 90)) THEN 1 ELSE 0 END, LongType, false), gpubasicsum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 90) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 120)) THEN 1 ELSE 0 END, LongType, false), gpubasicsum(CASE WHEN ((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 120) THEN 1 ELSE 0 END, LongType, false)], output=[substr(w_warehouse_name, 1, 20)#33548, sm_type#446, cc_name#6, 30 days#33538L, 31-60 days#33539L, 61-90 days#33540L, 91-120 days#33541L, >120 days#33542L])
                  +- GpuShuffleCoalesce 2147483647
                     +- GpuCustomShuffleReader coalesced
                        +- ShuffleQueryStage 8
                           +- GpuColumnarExchange gpuhashpartitioning(_groupingexpression#33557, sm_type#446, cc_name#6, 200), ENSURE_REQUIREMENTS, [id=#570546]
                              +- GpuHashAggregate(keys=[_groupingexpression#33557, sm_type#446, cc_name#6], functions=[partial_gpubasicsum(CASE WHEN ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 30) THEN 1 ELSE 0 END, LongType, false), partial_gpubasicsum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 30) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 60)) THEN 1 ELSE 0 END, LongType, false), partial_gpubasicsum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 60) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 90)) THEN 1 ELSE 0 END, LongType, false), partial_gpubasicsum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 90) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 120)) THEN 1 ELSE 0 END, LongType, false), partial_gpubasicsum(CASE WHEN ((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 120) THEN 1 ELSE 0 END, LongType, false)], output=[_groupingexpression#33557, sm_type#446, cc_name#6, sum#33563L, sum#33564L, sum#33565L, sum#33566L, sum#33567L])
                                 +- GpuProject [cs_sold_date_sk#544, cs_ship_date_sk#546, sm_type#446, cc_name#6, gpusubstring(w_warehouse_name#772, 1, 20) AS _groupingexpression#33557], true
                                    +- GpuShuffledHashJoin [cs_ship_date_sk#546], [d_date_sk#612], Inner, GpuBuildRight, false
                                       :- GpuShuffleCoalesce 2147483647
                                       :  +- GpuCustomShuffleReader coalesced
                                       :     +- ShuffleQueryStage 7
                                       :        +- GpuColumnarExchange gpuhashpartitioning(cs_ship_date_sk#546, 200), ENSURE_REQUIREMENTS, [id=#570406]
                                       :           +- GpuProject [cs_sold_date_sk#544, cs_ship_date_sk#546, w_warehouse_name#772, sm_type#446, cc_name#6], true
                                       :              +- GpuShuffledHashJoin [cs_call_center_sk#555], [cc_call_center_sk#0], Inner, GpuBuildRight, false
                                       :                 :- GpuShuffleCoalesce 2147483647
                                       :                 :  +- GpuCustomShuffleReader coalesced
                                       :                 :     +- ShuffleQueryStage 6
                                       :                 :        +- GpuColumnarExchange gpuhashpartitioning(cs_call_center_sk#555, 200), ENSURE_REQUIREMENTS, [id=#570231]
                                       :                 :           +- GpuProject [cs_sold_date_sk#544, cs_ship_date_sk#546, cs_call_center_sk#555, w_warehouse_name#772, sm_type#446], true
                                       :                 :              +- GpuShuffledHashJoin [cs_ship_mode_sk#557], [sm_ship_mode_sk#444], Inner, GpuBuildRight, false
                                       :                 :                 :- GpuShuffleCoalesce 2147483647
                                       :                 :                 :  +- GpuCustomShuffleReader coalesced
                                       :                 :                 :     +- ShuffleQueryStage 5
                                       :                 :                 :        +- GpuColumnarExchange gpuhashpartitioning(cs_ship_mode_sk#557, 200), ENSURE_REQUIREMENTS, [id=#570014]
                                       :                 :                 :           +- GpuProject [cs_sold_date_sk#544, cs_ship_date_sk#546, cs_call_center_sk#555, cs_ship_mode_sk#557, w_warehouse_name#772], true
                                       :                 :                 :              +- GpuShuffledHashJoin [cs_warehouse_sk#558], [w_warehouse_sk#770], Inner, GpuBuildRight, false
                                       :                 :                 :                 :- GpuShuffleCoalesce 2147483647
                                       :                 :                 :                 :  +- GpuCustomShuffleReader coalesced
                                       :                 :                 :                 :     +- ShuffleQueryStage 0
                                       :                 :                 :                 :        +- GpuColumnarExchange gpuhashpartitioning(cs_warehouse_sk#558, 200), ENSURE_REQUIREMENTS, [id=#569190]
                                       :                 :                 :                 :           +- GpuCoalesceBatches targetsize(2147483647)
                                       :                 :                 :                 :              +- GpuFilter (((gpuisnotnull(cs_warehouse_sk#558) AND gpuisnotnull(cs_ship_mode_sk#557)) AND gpuisnotnull(cs_call_center_sk#555)) AND gpuisnotnull(cs_ship_date_sk#546)), true
                                       :                 :                 :                 :                 +- GpuFileGpuScan parquet [cs_sold_date_sk#544,cs_ship_date_sk#546,cs_call_center_sk#555,cs_ship_mode_sk#557,cs_warehouse_sk#558] Batched: true, DataFilters: [isnotnull(cs_warehouse_sk#558), isnotnull(cs_ship_mode_sk#557), isnotnull(cs_call_center_sk#555)..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_ship_mode_sk), IsNotNull(cs_call_center_sk), IsNotNull(..., ReadSchema: struct<cs_sold_date_sk:int,cs_ship_date_sk:int,cs_call_center_sk:int,cs_ship_mode_sk:int,cs_wareh...
                                       :                 :                 :                 +- GpuCustomShuffleReader coalesced
                                       :                 :                 :                    +- ShuffleQueryStage 1
                                       :                 :                 :                       +- GpuColumnarExchange gpuhashpartitioning(w_warehouse_sk#770, 200), ENSURE_REQUIREMENTS, [id=#569218]
                                       :                 :                 :                          +- GpuCoalesceBatches targetsize(2147483647)
                                       :                 :                 :                             +- GpuFilter gpuisnotnull(w_warehouse_sk#770), true
                                       :                 :                 :                                +- GpuFileGpuScan parquet [w_warehouse_sk#770,w_warehouse_name#772] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#770)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/warehouse.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>
                                       :                 :                 +- GpuCustomShuffleReader coalesced
                                       :                 :                    +- ShuffleQueryStage 2
                                       :                 :                       +- GpuColumnarExchange gpuhashpartitioning(sm_ship_mode_sk#444, 200), ENSURE_REQUIREMENTS, [id=#569250]
                                       :                 :                          +- GpuCoalesceBatches targetsize(2147483647)
                                       :                 :                             +- GpuFilter gpuisnotnull(sm_ship_mode_sk#444), true
                                       :                 :                                +- GpuFileGpuScan parquet [sm_ship_mode_sk#444,sm_type#446] Batched: true, DataFilters: [isnotnull(sm_ship_mode_sk#444)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/ship_mode.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_type:string>
                                       :                 +- GpuCustomShuffleReader coalesced
                                       :                    +- ShuffleQueryStage 3
                                       :                       +- GpuColumnarExchange gpuhashpartitioning(cc_call_center_sk#0, 200), ENSURE_REQUIREMENTS, [id=#569282]
                                       :                          +- GpuCoalesceBatches targetsize(2147483647)
                                       :                             +- GpuFilter gpuisnotnull(cc_call_center_sk#0), true
                                       :                                +- GpuFileGpuScan parquet [cc_call_center_sk#0,cc_name#6] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#0)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/call_center.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk)], ReadSchema: struct<cc_call_center_sk:int,cc_name:string>
                                       +- GpuCustomShuffleReader coalesced
                                          +- ShuffleQueryStage 4
                                             +- GpuColumnarExchange gpuhashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#569323]
                                                +- GpuProject [d_date_sk#612], true
                                                   +- GpuCoalesceBatches targetsize(2147483647)
                                                      +- GpuFilter (((gpuisnotnull(d_month_seq#615) AND (d_month_seq#615 >= 1221)) AND (d_month_seq#615 <= 1232)) AND gpuisnotnull(d_date_sk#612)), true
                                                         +- GpuFileGpuScan parquet [d_date_sk#612,d_month_seq#615] Batched: true, DataFilters: [isnotnull(d_month_seq#615), (d_month_seq#615 >= 1221), (d_month_seq#615 <= 1232), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1221), LessThanOrEqual(d_month_seq,1232),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#33548 ASC NULLS FIRST,sm_type#446 ASC NULLS FIRST,cc_name#6 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#33548,sm_type#446,cc_name#6,30 days#33538L,31-60 days#33539L,61-90 days#33540L,91-120 days#33541L,>120 days#33542L])
   +- HashAggregate(keys=[_groupingexpression#33557, sm_type#446, cc_name#6], functions=[sum(CASE WHEN ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 30) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 30) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 60)) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 60) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 90)) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 90) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 120)) THEN 1 ELSE 0 END), sum(CASE WHEN ((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 120) THEN 1 ELSE 0 END)], output=[substr(w_warehouse_name, 1, 20)#33548, sm_type#446, cc_name#6, 30 days#33538L, 31-60 days#33539L, 61-90 days#33540L, 91-120 days#33541L, >120 days#33542L])
      +- Exchange hashpartitioning(_groupingexpression#33557, sm_type#446, cc_name#6, 200), ENSURE_REQUIREMENTS, [id=#568675]
         +- HashAggregate(keys=[_groupingexpression#33557, sm_type#446, cc_name#6], functions=[partial_sum(CASE WHEN ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 30) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 30) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 60)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 60) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 90)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 90) AND ((cs_ship_date_sk#546 - cs_sold_date_sk#544) <= 120)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN ((cs_ship_date_sk#546 - cs_sold_date_sk#544) > 120) THEN 1 ELSE 0 END)], output=[_groupingexpression#33557, sm_type#446, cc_name#6, sum#33563L, sum#33564L, sum#33565L, sum#33566L, sum#33567L])
            +- Project [cs_sold_date_sk#544, cs_ship_date_sk#546, sm_type#446, cc_name#6, substr(w_warehouse_name#772, 1, 20) AS _groupingexpression#33557]
               +- SortMergeJoin [cs_ship_date_sk#546], [d_date_sk#612], Inner
                  :- Sort [cs_ship_date_sk#546 ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(cs_ship_date_sk#546, 200), ENSURE_REQUIREMENTS, [id=#568667]
                  :     +- Project [cs_sold_date_sk#544, cs_ship_date_sk#546, w_warehouse_name#772, sm_type#446, cc_name#6]
                  :        +- SortMergeJoin [cs_call_center_sk#555], [cc_call_center_sk#0], Inner
                  :           :- Sort [cs_call_center_sk#555 ASC NULLS FIRST], false, 0
                  :           :  +- Exchange hashpartitioning(cs_call_center_sk#555, 200), ENSURE_REQUIREMENTS, [id=#568659]
                  :           :     +- Project [cs_sold_date_sk#544, cs_ship_date_sk#546, cs_call_center_sk#555, w_warehouse_name#772, sm_type#446]
                  :           :        +- SortMergeJoin [cs_ship_mode_sk#557], [sm_ship_mode_sk#444], Inner
                  :           :           :- Sort [cs_ship_mode_sk#557 ASC NULLS FIRST], false, 0
                  :           :           :  +- Exchange hashpartitioning(cs_ship_mode_sk#557, 200), ENSURE_REQUIREMENTS, [id=#568651]
                  :           :           :     +- Project [cs_sold_date_sk#544, cs_ship_date_sk#546, cs_call_center_sk#555, cs_ship_mode_sk#557, w_warehouse_name#772]
                  :           :           :        +- SortMergeJoin [cs_warehouse_sk#558], [w_warehouse_sk#770], Inner
                  :           :           :           :- Sort [cs_warehouse_sk#558 ASC NULLS FIRST], false, 0
                  :           :           :           :  +- Exchange hashpartitioning(cs_warehouse_sk#558, 200), ENSURE_REQUIREMENTS, [id=#568643]
                  :           :           :           :     +- Filter (((isnotnull(cs_warehouse_sk#558) AND isnotnull(cs_ship_mode_sk#557)) AND isnotnull(cs_call_center_sk#555)) AND isnotnull(cs_ship_date_sk#546))
                  :           :           :           :        +- FileScan parquet [cs_sold_date_sk#544,cs_ship_date_sk#546,cs_call_center_sk#555,cs_ship_mode_sk#557,cs_warehouse_sk#558] Batched: true, DataFilters: [isnotnull(cs_warehouse_sk#558), isnotnull(cs_ship_mode_sk#557), isnotnull(cs_call_center_sk#555)..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_ship_mode_sk), IsNotNull(cs_call_center_sk), IsNotNull(..., ReadSchema: struct<cs_sold_date_sk:int,cs_ship_date_sk:int,cs_call_center_sk:int,cs_ship_mode_sk:int,cs_wareh...
                  :           :           :           +- Sort [w_warehouse_sk#770 ASC NULLS FIRST], false, 0
                  :           :           :              +- Exchange hashpartitioning(w_warehouse_sk#770, 200), ENSURE_REQUIREMENTS, [id=#568644]
                  :           :           :                 +- Filter isnotnull(w_warehouse_sk#770)
                  :           :           :                    +- FileScan parquet [w_warehouse_sk#770,w_warehouse_name#772] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#770)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/warehouse.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>
                  :           :           +- Sort [sm_ship_mode_sk#444 ASC NULLS FIRST], false, 0
                  :           :              +- Exchange hashpartitioning(sm_ship_mode_sk#444, 200), ENSURE_REQUIREMENTS, [id=#568652]
                  :           :                 +- Filter isnotnull(sm_ship_mode_sk#444)
                  :           :                    +- FileScan parquet [sm_ship_mode_sk#444,sm_type#446] Batched: true, DataFilters: [isnotnull(sm_ship_mode_sk#444)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/ship_mode.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_type:string>
                  :           +- Sort [cc_call_center_sk#0 ASC NULLS FIRST], false, 0
                  :              +- Exchange hashpartitioning(cc_call_center_sk#0, 200), ENSURE_REQUIREMENTS, [id=#568660]
                  :                 +- Filter isnotnull(cc_call_center_sk#0)
                  :                    +- FileScan parquet [cc_call_center_sk#0,cc_name#6] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#0)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/call_center.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk)], ReadSchema: struct<cc_call_center_sk:int,cc_name:string>
                  +- Sort [d_date_sk#612 ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#568668]
                        +- Project [d_date_sk#612]
                           +- Filter (((isnotnull(d_month_seq#615) AND (d_month_seq#615 >= 1221)) AND (d_month_seq#615 <= 1232)) AND isnotnull(d_date_sk#612))
                              +- FileScan parquet [d_date_sk#612,d_month_seq#615] Batched: true, DataFilters: [isnotnull(d_month_seq#615), (d_month_seq#615 >= 1221), (d_month_seq#615 <= 1232), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1221), LessThanOrEqual(d_month_seq,1232),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
