AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#21166 ASC NULLS FIRST,sm_type#552 ASC NULLS FIRST,cc_name#794 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#21166,sm_type#552,cc_name#794,30 days#21156L,31-60 days#21157L,61-90 days#21158L,91-120 days#21159L,>120 days#21160L])
   +- *(6) HashAggregate(keys=[_groupingexpression#21175, sm_type#552, cc_name#794], functions=[sum(CASE WHEN ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 30) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 30) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 60)) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 60) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 90)) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 90) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 120)) THEN 1 ELSE 0 END), sum(CASE WHEN ((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 120) THEN 1 ELSE 0 END)], output=[substr(w_warehouse_name, 1, 20)#21166, sm_type#552, cc_name#794, 30 days#21156L, 31-60 days#21157L, 61-90 days#21158L, 91-120 days#21159L, >120 days#21160L])
      +- AQEShuffleRead coalesced
         +- ShuffleQueryStage 4
            +- Exchange hashpartitioning(_groupingexpression#21175, sm_type#552, cc_name#794, 200), ENSURE_REQUIREMENTS, [id=#181590]
               +- *(5) HashAggregate(keys=[_groupingexpression#21175, sm_type#552, cc_name#794], functions=[partial_sum(CASE WHEN ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 30) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 30) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 60)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 60) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 90)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 90) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 120)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN ((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 120) THEN 1 ELSE 0 END)], output=[_groupingexpression#21175, sm_type#552, cc_name#794, sum#21181L, sum#21182L, sum#21183L, sum#21184L, sum#21185L])
                  +- *(5) Project [cs_sold_date_sk#118, cs_ship_date_sk#120, sm_type#552, cc_name#794, substr(w_warehouse_name#188, 1, 20) AS _groupingexpression#21175]
                     +- *(5) BroadcastHashJoin [cs_ship_date_sk#120], [d_date_sk#598], Inner, BuildRight, false
                        :- *(5) Project [cs_sold_date_sk#118, cs_ship_date_sk#120, w_warehouse_name#188, sm_type#552, cc_name#794]
                        :  +- *(5) BroadcastHashJoin [cs_call_center_sk#129], [cc_call_center_sk#788], Inner, BuildRight, false
                        :     :- *(5) Project [cs_sold_date_sk#118, cs_ship_date_sk#120, cs_call_center_sk#129, w_warehouse_name#188, sm_type#552]
                        :     :  +- *(5) BroadcastHashJoin [cs_ship_mode_sk#131], [sm_ship_mode_sk#550], Inner, BuildRight, false
                        :     :     :- *(5) Project [cs_sold_date_sk#118, cs_ship_date_sk#120, cs_call_center_sk#129, cs_ship_mode_sk#131, w_warehouse_name#188]
                        :     :     :  +- *(5) BroadcastHashJoin [cs_warehouse_sk#132], [w_warehouse_sk#186], Inner, BuildRight, false
                        :     :     :     :- *(5) Filter (((isnotnull(cs_warehouse_sk#132) AND isnotnull(cs_ship_mode_sk#131)) AND isnotnull(cs_call_center_sk#129)) AND isnotnull(cs_ship_date_sk#120))
                        :     :     :     :  +- *(5) ColumnarToRow
                        :     :     :     :     +- FileScan parquet [cs_sold_date_sk#118,cs_ship_date_sk#120,cs_call_center_sk#129,cs_ship_mode_sk#131,cs_warehouse_sk#132] Batched: true, DataFilters: [isnotnull(cs_warehouse_sk#132), isnotnull(cs_ship_mode_sk#131), isnotnull(cs_call_center_sk#129)..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_ship_mode_sk), IsNotNull(cs_call_center_sk), IsNotNull(..., ReadSchema: struct<cs_sold_date_sk:int,cs_ship_date_sk:int,cs_call_center_sk:int,cs_ship_mode_sk:int,cs_wareh...
                        :     :     :     +- BroadcastQueryStage 0
                        :     :     :        +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#181301]
                        :     :     :           +- *(1) Filter isnotnull(w_warehouse_sk#186)
                        :     :     :              +- *(1) ColumnarToRow
                        :     :     :                 +- FileScan parquet [w_warehouse_sk#186,w_warehouse_name#188] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#186)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/warehouse.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>
                        :     :     +- BroadcastQueryStage 1
                        :     :        +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#181318]
                        :     :           +- *(2) Filter isnotnull(sm_ship_mode_sk#550)
                        :     :              +- *(2) ColumnarToRow
                        :     :                 +- FileScan parquet [sm_ship_mode_sk#550,sm_type#552] Batched: true, DataFilters: [isnotnull(sm_ship_mode_sk#550)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/ship_mode.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_type:string>
                        :     +- BroadcastQueryStage 2
                        :        +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#181335]
                        :           +- *(3) Filter isnotnull(cc_call_center_sk#788)
                        :              +- *(3) ColumnarToRow
                        :                 +- FileScan parquet [cc_call_center_sk#788,cc_name#794] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#788)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/call_center.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk)], ReadSchema: struct<cc_call_center_sk:int,cc_name:string>
                        +- BroadcastQueryStage 3
                           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#181354]
                              +- *(4) Project [d_date_sk#598]
                                 +- *(4) Filter (((isnotnull(d_month_seq#601) AND (d_month_seq#601 >= 1221)) AND (d_month_seq#601 <= 1232)) AND isnotnull(d_date_sk#598))
                                    +- *(4) ColumnarToRow
                                       +- FileScan parquet [d_date_sk#598,d_month_seq#601] Batched: true, DataFilters: [isnotnull(d_month_seq#601), (d_month_seq#601 >= 1221), (d_month_seq#601 <= 1232), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1221), LessThanOrEqual(d_month_seq,1232),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#21166 ASC NULLS FIRST,sm_type#552 ASC NULLS FIRST,cc_name#794 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#21166,sm_type#552,cc_name#794,30 days#21156L,31-60 days#21157L,61-90 days#21158L,91-120 days#21159L,>120 days#21160L])
   +- HashAggregate(keys=[_groupingexpression#21175, sm_type#552, cc_name#794], functions=[sum(CASE WHEN ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 30) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 30) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 60)) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 60) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 90)) THEN 1 ELSE 0 END), sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 90) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 120)) THEN 1 ELSE 0 END), sum(CASE WHEN ((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 120) THEN 1 ELSE 0 END)], output=[substr(w_warehouse_name, 1, 20)#21166, sm_type#552, cc_name#794, 30 days#21156L, 31-60 days#21157L, 61-90 days#21158L, 91-120 days#21159L, >120 days#21160L])
      +- Exchange hashpartitioning(_groupingexpression#21175, sm_type#552, cc_name#794, 200), ENSURE_REQUIREMENTS, [id=#181250]
         +- HashAggregate(keys=[_groupingexpression#21175, sm_type#552, cc_name#794], functions=[partial_sum(CASE WHEN ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 30) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 30) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 60)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 60) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 90)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 90) AND ((cs_ship_date_sk#120 - cs_sold_date_sk#118) <= 120)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN ((cs_ship_date_sk#120 - cs_sold_date_sk#118) > 120) THEN 1 ELSE 0 END)], output=[_groupingexpression#21175, sm_type#552, cc_name#794, sum#21181L, sum#21182L, sum#21183L, sum#21184L, sum#21185L])
            +- Project [cs_sold_date_sk#118, cs_ship_date_sk#120, sm_type#552, cc_name#794, substr(w_warehouse_name#188, 1, 20) AS _groupingexpression#21175]
               +- BroadcastHashJoin [cs_ship_date_sk#120], [d_date_sk#598], Inner, BuildRight, false
                  :- Project [cs_sold_date_sk#118, cs_ship_date_sk#120, w_warehouse_name#188, sm_type#552, cc_name#794]
                  :  +- BroadcastHashJoin [cs_call_center_sk#129], [cc_call_center_sk#788], Inner, BuildRight, false
                  :     :- Project [cs_sold_date_sk#118, cs_ship_date_sk#120, cs_call_center_sk#129, w_warehouse_name#188, sm_type#552]
                  :     :  +- BroadcastHashJoin [cs_ship_mode_sk#131], [sm_ship_mode_sk#550], Inner, BuildRight, false
                  :     :     :- Project [cs_sold_date_sk#118, cs_ship_date_sk#120, cs_call_center_sk#129, cs_ship_mode_sk#131, w_warehouse_name#188]
                  :     :     :  +- BroadcastHashJoin [cs_warehouse_sk#132], [w_warehouse_sk#186], Inner, BuildRight, false
                  :     :     :     :- Filter (((isnotnull(cs_warehouse_sk#132) AND isnotnull(cs_ship_mode_sk#131)) AND isnotnull(cs_call_center_sk#129)) AND isnotnull(cs_ship_date_sk#120))
                  :     :     :     :  +- FileScan parquet [cs_sold_date_sk#118,cs_ship_date_sk#120,cs_call_center_sk#129,cs_ship_mode_sk#131,cs_warehouse_sk#132] Batched: true, DataFilters: [isnotnull(cs_warehouse_sk#132), isnotnull(cs_ship_mode_sk#131), isnotnull(cs_call_center_sk#129)..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cs_warehouse_sk), IsNotNull(cs_ship_mode_sk), IsNotNull(cs_call_center_sk), IsNotNull(..., ReadSchema: struct<cs_sold_date_sk:int,cs_ship_date_sk:int,cs_call_center_sk:int,cs_ship_mode_sk:int,cs_wareh...
                  :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#181233]
                  :     :     :        +- Filter isnotnull(w_warehouse_sk#186)
                  :     :     :           +- FileScan parquet [w_warehouse_sk#186,w_warehouse_name#188] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#186)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/warehouse.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>
                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#181237]
                  :     :        +- Filter isnotnull(sm_ship_mode_sk#550)
                  :     :           +- FileScan parquet [sm_ship_mode_sk#550,sm_type#552] Batched: true, DataFilters: [isnotnull(sm_ship_mode_sk#550)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/ship_mode.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_type:string>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#181241]
                  :        +- Filter isnotnull(cc_call_center_sk#788)
                  :           +- FileScan parquet [cc_call_center_sk#788,cc_name#794] Batched: true, DataFilters: [isnotnull(cc_call_center_sk#788)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/call_center.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cc_call_center_sk)], ReadSchema: struct<cc_call_center_sk:int,cc_name:string>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#181245]
                     +- Project [d_date_sk#598]
                        +- Filter (((isnotnull(d_month_seq#601) AND (d_month_seq#601 >= 1221)) AND (d_month_seq#601 <= 1232)) AND isnotnull(d_date_sk#598))
                           +- FileScan parquet [d_date_sk#598,d_month_seq#601] Batched: true, DataFilters: [isnotnull(d_month_seq#601), (d_month_seq#601 >= 1221), (d_month_seq#601 <= 1232), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1221), LessThanOrEqual(d_month_seq,1232),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
