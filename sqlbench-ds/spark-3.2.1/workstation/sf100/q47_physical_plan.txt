AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[CheckOverflow((promote_precision(cast(sum_sales#10805 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#10806 as decimal(22,6)))), DecimalType(22,6), true) ASC NULLS FIRST,psum#10808 ASC NULLS FIRST], output=[i_category#512,i_brand#508,d_year#604,d_moy#606,avg_monthly_sales#10806,sum_sales#10805,psum#10808,nsum#10809])
   +- *(27) Project [i_category#512, i_brand#508, d_year#604, d_moy#606, avg_monthly_sales#10806, sum_sales#10805, sum_sales#10826 AS psum#10808, sum_sales#10835 AS nsum#10809]
      +- *(27) SortMergeJoin [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#10807], [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, (rn#11063 - 1)], Inner
         :- *(25) Project [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#10805, avg_monthly_sales#10806, rn#10807, sum_sales#10826]
         :  +- *(25) SortMergeJoin [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#10807], [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, (rn#10956 + 1)], Inner
         :     :- *(23) Sort [i_category#512 ASC NULLS FIRST, i_brand#508 ASC NULLS FIRST, s_store_name#331 ASC NULLS FIRST, s_company_name#343 ASC NULLS FIRST, rn#10807 ASC NULLS FIRST], false, 0
         :     :  +- AQEShuffleRead coalesced
         :     :     +- ShuffleQueryStage 24
         :     :        +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#10807, 200), ENSURE_REQUIREMENTS, [id=#101433]
         :     :           +- *(18) Project [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#10805, avg_monthly_sales#10806, rn#10807]
         :     :              +- *(18) Filter ((isnotnull(avg_monthly_sales#10806) AND (avg_monthly_sales#10806 > 0.000000)) AND (CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#10805 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#10806 as decimal(22,6)))), DecimalType(22,6), true), false)) / promote_precision(cast(avg_monthly_sales#10806 as decimal(22,6)))), DecimalType(38,16), true) > 0.1000000000000000))
         :     :                 +- Window [avg(_w0#10819) windowspecdefinition(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#10806], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604]
         :     :                    +- *(17) Filter (isnotnull(d_year#604) AND (d_year#604 = 2000))
         :     :                       +- Window [rank(d_year#604, d_moy#606) windowspecdefinition(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#10807], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343], [d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST]
         :     :                          +- *(16) Sort [i_category#512 ASC NULLS FIRST, i_brand#508 ASC NULLS FIRST, s_store_name#331 ASC NULLS FIRST, s_company_name#343 ASC NULLS FIRST, d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST], false, 0
         :     :                             +- AQEShuffleRead coalesced
         :     :                                +- ShuffleQueryStage 20
         :     :                                   +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, 200), ENSURE_REQUIREMENTS, [id=#101238]
         :     :                                      +- *(13) HashAggregate(keys=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606], functions=[sum(UnscaledValue(ss_sales_price#677))], output=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#10805, _w0#10819])
         :     :                                         +- AQEShuffleRead coalesced
         :     :                                            +- ShuffleQueryStage 15
         :     :                                               +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, 200), ENSURE_REQUIREMENTS, [id=#100979]
         :     :                                                  +- *(10) HashAggregate(keys=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606], functions=[partial_sum(UnscaledValue(ss_sales_price#677))], output=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum#11065L])
         :     :                                                     +- *(10) Project [i_brand#508, i_category#512, ss_sales_price#677, d_year#604, d_moy#606, s_store_name#331, s_company_name#343]
         :     :                                                        +- *(10) BroadcastHashJoin [ss_store_sk#671], [s_store_sk#326], Inner, BuildRight, false
         :     :                                                           :- *(10) Project [i_brand#508, i_category#512, ss_store_sk#671, ss_sales_price#677, d_year#604, d_moy#606]
         :     :                                                           :  +- *(10) BroadcastHashJoin [ss_sold_date_sk#664], [d_date_sk#598], Inner, BuildRight, false
         :     :                                                           :     :- *(10) Project [i_brand#508, i_category#512, ss_sold_date_sk#664, ss_store_sk#671, ss_sales_price#677]
         :     :                                                           :     :  +- *(10) BroadcastHashJoin [i_item_sk#500], [ss_item_sk#666], Inner, BuildLeft, false
         :     :                                                           :     :     :- BroadcastQueryStage 0
         :     :                                                           :     :     :  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99929]
         :     :                                                           :     :     :     +- *(1) Filter ((isnotnull(i_item_sk#500) AND isnotnull(i_category#512)) AND isnotnull(i_brand#508))
         :     :                                                           :     :     :        +- *(1) ColumnarToRow
         :     :                                                           :     :     :           +- FileScan parquet [i_item_sk#500,i_brand#508,i_category#512] Batched: true, DataFilters: [isnotnull(i_item_sk#500), isnotnull(i_category#512), isnotnull(i_brand#508)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
         :     :                                                           :     :     +- *(10) Filter ((isnotnull(ss_item_sk#666) AND isnotnull(ss_sold_date_sk#664)) AND isnotnull(ss_store_sk#671))
         :     :                                                           :     :        +- *(10) ColumnarToRow
         :     :                                                           :     :           +- FileScan parquet [ss_sold_date_sk#664,ss_item_sk#666,ss_store_sk#671,ss_sales_price#677] Batched: true, DataFilters: [isnotnull(ss_item_sk#666), isnotnull(ss_sold_date_sk#664), isnotnull(ss_store_sk#671)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
         :     :                                                           :     +- BroadcastQueryStage 1
         :     :                                                           :        +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99946]
         :     :                                                           :           +- *(2) Filter ((((d_year#604 = 2000) OR ((d_year#604 = 1999) AND (d_moy#606 = 12))) OR ((d_year#604 = 2001) AND (d_moy#606 = 1))) AND isnotnull(d_date_sk#598))
         :     :                                                           :              +- *(2) ColumnarToRow
         :     :                                                           :                 +- FileScan parquet [d_date_sk#598,d_year#604,d_moy#606] Batched: true, DataFilters: [(((d_year#604 = 2000) OR ((d_year#604 = 1999) AND (d_moy#606 = 12))) OR ((d_year#604 = 2001) AND..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
         :     :                                                           +- BroadcastQueryStage 2
         :     :                                                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99963]
         :     :                                                                 +- *(3) Filter ((isnotnull(s_store_sk#326) AND isnotnull(s_store_name#331)) AND isnotnull(s_company_name#343))
         :     :                                                                    +- *(3) ColumnarToRow
         :     :                                                                       +- FileScan parquet [s_store_sk#326,s_store_name#331,s_company_name#343] Batched: true, DataFilters: [isnotnull(s_store_sk#326), isnotnull(s_store_name#331), isnotnull(s_company_name#343)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
         :     +- *(24) Sort [i_category#10862 ASC NULLS FIRST, i_brand#10858 ASC NULLS FIRST, s_store_name#10928 ASC NULLS FIRST, s_company_name#10940 ASC NULLS FIRST, (rn#10956 + 1) ASC NULLS FIRST], false, 0
         :        +- AQEShuffleRead coalesced
         :           +- ShuffleQueryStage 25
         :              +- Exchange hashpartitioning(i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, (rn#10956 + 1), 200), ENSURE_REQUIREMENTS, [id=#101541]
         :                 +- *(20) Project [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, sum_sales#10805 AS sum_sales#10826, rn#10956]
         :                    +- Window [rank(d_year#10901, d_moy#10903) windowspecdefinition(i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901 ASC NULLS FIRST, d_moy#10903 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#10956], [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940], [d_year#10901 ASC NULLS FIRST, d_moy#10903 ASC NULLS FIRST]
         :                       +- *(19) Sort [i_category#10862 ASC NULLS FIRST, i_brand#10858 ASC NULLS FIRST, s_store_name#10928 ASC NULLS FIRST, s_company_name#10940 ASC NULLS FIRST, d_year#10901 ASC NULLS FIRST, d_moy#10903 ASC NULLS FIRST], false, 0
         :                          +- AQEShuffleRead coalesced
         :                             +- ShuffleQueryStage 21
         :                                +- Exchange hashpartitioning(i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, 200), ENSURE_REQUIREMENTS, [id=#101273]
         :                                   +- *(14) HashAggregate(keys=[i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901, d_moy#10903], functions=[sum(UnscaledValue(ss_sales_price#10885))], output=[i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901, d_moy#10903, sum_sales#10805])
         :                                      +- AQEShuffleRead coalesced
         :                                         +- ShuffleQueryStage 17
         :                                            +- ReusedExchange [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901, d_moy#10903, sum#11067L], Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, 200), ENSURE_REQUIREMENTS, [id=#100979]
         +- *(26) Sort [i_category#10969 ASC NULLS FIRST, i_brand#10965 ASC NULLS FIRST, s_store_name#11035 ASC NULLS FIRST, s_company_name#11047 ASC NULLS FIRST, (rn#11063 - 1) ASC NULLS FIRST], false, 0
            +- AQEShuffleRead coalesced
               +- ShuffleQueryStage 26
                  +- Exchange hashpartitioning(i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, (rn#11063 - 1), 200), ENSURE_REQUIREMENTS, [id=#101571]
                     +- *(22) Project [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, sum_sales#10805 AS sum_sales#10835, rn#11063]
                        +- Window [rank(d_year#11008, d_moy#11010) windowspecdefinition(i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008 ASC NULLS FIRST, d_moy#11010 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#11063], [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047], [d_year#11008 ASC NULLS FIRST, d_moy#11010 ASC NULLS FIRST]
                           +- *(21) Sort [i_category#10969 ASC NULLS FIRST, i_brand#10965 ASC NULLS FIRST, s_store_name#11035 ASC NULLS FIRST, s_company_name#11047 ASC NULLS FIRST, d_year#11008 ASC NULLS FIRST, d_moy#11010 ASC NULLS FIRST], false, 0
                              +- AQEShuffleRead coalesced
                                 +- ShuffleQueryStage 23
                                    +- ReusedExchange [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008, d_moy#11010, sum_sales#10805], Exchange hashpartitioning(i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, 200), ENSURE_REQUIREMENTS, [id=#101273]
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[CheckOverflow((promote_precision(cast(sum_sales#10805 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#10806 as decimal(22,6)))), DecimalType(22,6), true) ASC NULLS FIRST,psum#10808 ASC NULLS FIRST], output=[i_category#512,i_brand#508,d_year#604,d_moy#606,avg_monthly_sales#10806,sum_sales#10805,psum#10808,nsum#10809])
   +- Project [i_category#512, i_brand#508, d_year#604, d_moy#606, avg_monthly_sales#10806, sum_sales#10805, sum_sales#10826 AS psum#10808, sum_sales#10835 AS nsum#10809]
      +- SortMergeJoin [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#10807], [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, (rn#11063 - 1)], Inner
         :- Project [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#10805, avg_monthly_sales#10806, rn#10807, sum_sales#10826]
         :  +- SortMergeJoin [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#10807], [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, (rn#10956 + 1)], Inner
         :     :- Sort [i_category#512 ASC NULLS FIRST, i_brand#508 ASC NULLS FIRST, s_store_name#331 ASC NULLS FIRST, s_company_name#343 ASC NULLS FIRST, rn#10807 ASC NULLS FIRST], false, 0
         :     :  +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#10807, 200), ENSURE_REQUIREMENTS, [id=#99840]
         :     :     +- Project [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#10805, avg_monthly_sales#10806, rn#10807]
         :     :        +- Filter ((isnotnull(avg_monthly_sales#10806) AND (avg_monthly_sales#10806 > 0.000000)) AND (CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#10805 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#10806 as decimal(22,6)))), DecimalType(22,6), true), false)) / promote_precision(cast(avg_monthly_sales#10806 as decimal(22,6)))), DecimalType(38,16), true) > 0.1000000000000000))
         :     :           +- Window [avg(_w0#10819) windowspecdefinition(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#10806], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604]
         :     :              +- Filter (isnotnull(d_year#604) AND (d_year#604 = 2000))
         :     :                 +- Window [rank(d_year#604, d_moy#606) windowspecdefinition(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#10807], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343], [d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST]
         :     :                    +- Sort [i_category#512 ASC NULLS FIRST, i_brand#508 ASC NULLS FIRST, s_store_name#331 ASC NULLS FIRST, s_company_name#343 ASC NULLS FIRST, d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST], false, 0
         :     :                       +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, 200), ENSURE_REQUIREMENTS, [id=#99811]
         :     :                          +- HashAggregate(keys=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606], functions=[sum(UnscaledValue(ss_sales_price#677))], output=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#10805, _w0#10819])
         :     :                             +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, 200), ENSURE_REQUIREMENTS, [id=#99808]
         :     :                                +- HashAggregate(keys=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606], functions=[partial_sum(UnscaledValue(ss_sales_price#677))], output=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum#11065L])
         :     :                                   +- Project [i_brand#508, i_category#512, ss_sales_price#677, d_year#604, d_moy#606, s_store_name#331, s_company_name#343]
         :     :                                      +- BroadcastHashJoin [ss_store_sk#671], [s_store_sk#326], Inner, BuildRight, false
         :     :                                         :- Project [i_brand#508, i_category#512, ss_store_sk#671, ss_sales_price#677, d_year#604, d_moy#606]
         :     :                                         :  +- BroadcastHashJoin [ss_sold_date_sk#664], [d_date_sk#598], Inner, BuildRight, false
         :     :                                         :     :- Project [i_brand#508, i_category#512, ss_sold_date_sk#664, ss_store_sk#671, ss_sales_price#677]
         :     :                                         :     :  +- BroadcastHashJoin [i_item_sk#500], [ss_item_sk#666], Inner, BuildLeft, false
         :     :                                         :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99795]
         :     :                                         :     :     :  +- Filter ((isnotnull(i_item_sk#500) AND isnotnull(i_category#512)) AND isnotnull(i_brand#508))
         :     :                                         :     :     :     +- FileScan parquet [i_item_sk#500,i_brand#508,i_category#512] Batched: true, DataFilters: [isnotnull(i_item_sk#500), isnotnull(i_category#512), isnotnull(i_brand#508)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
         :     :                                         :     :     +- Filter ((isnotnull(ss_item_sk#666) AND isnotnull(ss_sold_date_sk#664)) AND isnotnull(ss_store_sk#671))
         :     :                                         :     :        +- FileScan parquet [ss_sold_date_sk#664,ss_item_sk#666,ss_store_sk#671,ss_sales_price#677] Batched: true, DataFilters: [isnotnull(ss_item_sk#666), isnotnull(ss_sold_date_sk#664), isnotnull(ss_store_sk#671)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
         :     :                                         :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99799]
         :     :                                         :        +- Filter ((((d_year#604 = 2000) OR ((d_year#604 = 1999) AND (d_moy#606 = 12))) OR ((d_year#604 = 2001) AND (d_moy#606 = 1))) AND isnotnull(d_date_sk#598))
         :     :                                         :           +- FileScan parquet [d_date_sk#598,d_year#604,d_moy#606] Batched: true, DataFilters: [(((d_year#604 = 2000) OR ((d_year#604 = 1999) AND (d_moy#606 = 12))) OR ((d_year#604 = 2001) AND..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
         :     :                                         +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99803]
         :     :                                            +- Filter ((isnotnull(s_store_sk#326) AND isnotnull(s_store_name#331)) AND isnotnull(s_company_name#343))
         :     :                                               +- FileScan parquet [s_store_sk#326,s_store_name#331,s_company_name#343] Batched: true, DataFilters: [isnotnull(s_store_sk#326), isnotnull(s_store_name#331), isnotnull(s_company_name#343)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
         :     +- Sort [i_category#10862 ASC NULLS FIRST, i_brand#10858 ASC NULLS FIRST, s_store_name#10928 ASC NULLS FIRST, s_company_name#10940 ASC NULLS FIRST, (rn#10956 + 1) ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, (rn#10956 + 1), 200), ENSURE_REQUIREMENTS, [id=#99841]
         :           +- Project [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, sum_sales#10805 AS sum_sales#10826, rn#10956]
         :              +- Window [rank(d_year#10901, d_moy#10903) windowspecdefinition(i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901 ASC NULLS FIRST, d_moy#10903 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#10956], [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940], [d_year#10901 ASC NULLS FIRST, d_moy#10903 ASC NULLS FIRST]
         :                 +- Sort [i_category#10862 ASC NULLS FIRST, i_brand#10858 ASC NULLS FIRST, s_store_name#10928 ASC NULLS FIRST, s_company_name#10940 ASC NULLS FIRST, d_year#10901 ASC NULLS FIRST, d_moy#10903 ASC NULLS FIRST], false, 0
         :                    +- Exchange hashpartitioning(i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, 200), ENSURE_REQUIREMENTS, [id=#99834]
         :                       +- HashAggregate(keys=[i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901, d_moy#10903], functions=[sum(UnscaledValue(ss_sales_price#10885))], output=[i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901, d_moy#10903, sum_sales#10805])
         :                          +- Exchange hashpartitioning(i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901, d_moy#10903, 200), ENSURE_REQUIREMENTS, [id=#99831]
         :                             +- HashAggregate(keys=[i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901, d_moy#10903], functions=[partial_sum(UnscaledValue(ss_sales_price#10885))], output=[i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901, d_moy#10903, sum#11067L])
         :                                +- Project [i_brand#10858, i_category#10862, ss_sales_price#10885, d_year#10901, d_moy#10903, s_store_name#10928, s_company_name#10940]
         :                                   +- BroadcastHashJoin [ss_store_sk#10879], [s_store_sk#10923], Inner, BuildRight, false
         :                                      :- Project [i_brand#10858, i_category#10862, ss_store_sk#10879, ss_sales_price#10885, d_year#10901, d_moy#10903]
         :                                      :  +- BroadcastHashJoin [ss_sold_date_sk#10872], [d_date_sk#10895], Inner, BuildRight, false
         :                                      :     :- Project [i_brand#10858, i_category#10862, ss_sold_date_sk#10872, ss_store_sk#10879, ss_sales_price#10885]
         :                                      :     :  +- BroadcastHashJoin [i_item_sk#10850], [ss_item_sk#10874], Inner, BuildLeft, false
         :                                      :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99818]
         :                                      :     :     :  +- Filter ((isnotnull(i_item_sk#10850) AND isnotnull(i_category#10862)) AND isnotnull(i_brand#10858))
         :                                      :     :     :     +- FileScan parquet [i_item_sk#10850,i_brand#10858,i_category#10862] Batched: true, DataFilters: [isnotnull(i_item_sk#10850), isnotnull(i_category#10862), isnotnull(i_brand#10858)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
         :                                      :     :     +- Filter ((isnotnull(ss_item_sk#10874) AND isnotnull(ss_sold_date_sk#10872)) AND isnotnull(ss_store_sk#10879))
         :                                      :     :        +- FileScan parquet [ss_sold_date_sk#10872,ss_item_sk#10874,ss_store_sk#10879,ss_sales_price#10885] Batched: true, DataFilters: [isnotnull(ss_item_sk#10874), isnotnull(ss_sold_date_sk#10872), isnotnull(ss_store_sk#10879)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
         :                                      :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99822]
         :                                      :        +- Filter ((((d_year#10901 = 2000) OR ((d_year#10901 = 1999) AND (d_moy#10903 = 12))) OR ((d_year#10901 = 2001) AND (d_moy#10903 = 1))) AND isnotnull(d_date_sk#10895))
         :                                      :           +- FileScan parquet [d_date_sk#10895,d_year#10901,d_moy#10903] Batched: true, DataFilters: [(((d_year#10901 = 2000) OR ((d_year#10901 = 1999) AND (d_moy#10903 = 12))) OR ((d_year#10901 = 2..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
         :                                      +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99826]
         :                                         +- Filter ((isnotnull(s_store_sk#10923) AND isnotnull(s_store_name#10928)) AND isnotnull(s_company_name#10940))
         :                                            +- FileScan parquet [s_store_sk#10923,s_store_name#10928,s_company_name#10940] Batched: true, DataFilters: [isnotnull(s_store_sk#10923), isnotnull(s_store_name#10928), isnotnull(s_company_name#10940)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
         +- Sort [i_category#10969 ASC NULLS FIRST, i_brand#10965 ASC NULLS FIRST, s_store_name#11035 ASC NULLS FIRST, s_company_name#11047 ASC NULLS FIRST, (rn#11063 - 1) ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, (rn#11063 - 1), 200), ENSURE_REQUIREMENTS, [id=#99868]
               +- Project [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, sum_sales#10805 AS sum_sales#10835, rn#11063]
                  +- Window [rank(d_year#11008, d_moy#11010) windowspecdefinition(i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008 ASC NULLS FIRST, d_moy#11010 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#11063], [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047], [d_year#11008 ASC NULLS FIRST, d_moy#11010 ASC NULLS FIRST]
                     +- Sort [i_category#10969 ASC NULLS FIRST, i_brand#10965 ASC NULLS FIRST, s_store_name#11035 ASC NULLS FIRST, s_company_name#11047 ASC NULLS FIRST, d_year#11008 ASC NULLS FIRST, d_moy#11010 ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, 200), ENSURE_REQUIREMENTS, [id=#99862]
                           +- HashAggregate(keys=[i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008, d_moy#11010], functions=[sum(UnscaledValue(ss_sales_price#10992))], output=[i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008, d_moy#11010, sum_sales#10805])
                              +- Exchange hashpartitioning(i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008, d_moy#11010, 200), ENSURE_REQUIREMENTS, [id=#99859]
                                 +- HashAggregate(keys=[i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008, d_moy#11010], functions=[partial_sum(UnscaledValue(ss_sales_price#10992))], output=[i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008, d_moy#11010, sum#11069L])
                                    +- Project [i_brand#10965, i_category#10969, ss_sales_price#10992, d_year#11008, d_moy#11010, s_store_name#11035, s_company_name#11047]
                                       +- BroadcastHashJoin [ss_store_sk#10986], [s_store_sk#11030], Inner, BuildRight, false
                                          :- Project [i_brand#10965, i_category#10969, ss_store_sk#10986, ss_sales_price#10992, d_year#11008, d_moy#11010]
                                          :  +- BroadcastHashJoin [ss_sold_date_sk#10979], [d_date_sk#11002], Inner, BuildRight, false
                                          :     :- Project [i_brand#10965, i_category#10969, ss_sold_date_sk#10979, ss_store_sk#10986, ss_sales_price#10992]
                                          :     :  +- BroadcastHashJoin [i_item_sk#10957], [ss_item_sk#10981], Inner, BuildLeft, false
                                          :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99846]
                                          :     :     :  +- Filter ((isnotnull(i_item_sk#10957) AND isnotnull(i_category#10969)) AND isnotnull(i_brand#10965))
                                          :     :     :     +- FileScan parquet [i_item_sk#10957,i_brand#10965,i_category#10969] Batched: true, DataFilters: [isnotnull(i_item_sk#10957), isnotnull(i_category#10969), isnotnull(i_brand#10965)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
                                          :     :     +- Filter ((isnotnull(ss_item_sk#10981) AND isnotnull(ss_sold_date_sk#10979)) AND isnotnull(ss_store_sk#10986))
                                          :     :        +- FileScan parquet [ss_sold_date_sk#10979,ss_item_sk#10981,ss_store_sk#10986,ss_sales_price#10992] Batched: true, DataFilters: [isnotnull(ss_item_sk#10981), isnotnull(ss_sold_date_sk#10979), isnotnull(ss_store_sk#10986)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
                                          :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99850]
                                          :        +- Filter ((((d_year#11008 = 2000) OR ((d_year#11008 = 1999) AND (d_moy#11010 = 12))) OR ((d_year#11008 = 2001) AND (d_moy#11010 = 1))) AND isnotnull(d_date_sk#11002))
                                          :           +- FileScan parquet [d_date_sk#11002,d_year#11008,d_moy#11010] Batched: true, DataFilters: [(((d_year#11008 = 2000) OR ((d_year#11008 = 1999) AND (d_moy#11010 = 12))) OR ((d_year#11008 = 2..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
                                          +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#99854]
                                             +- Filter ((isnotnull(s_store_sk#11030) AND isnotnull(s_store_name#11035)) AND isnotnull(s_company_name#11047))
                                                +- FileScan parquet [s_store_sk#11030,s_store_name#11035,s_company_name#11047] Batched: true, DataFilters: [isnotnull(s_store_sk#11030), isnotnull(s_store_name#11035), isnotnull(s_company_name#11047)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
