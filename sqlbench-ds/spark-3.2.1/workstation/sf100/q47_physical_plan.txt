AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[CheckOverflow((promote_precision(cast(sum_sales#9423 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#9424 as decimal(22,6)))), DecimalType(22,6), true) ASC NULLS FIRST,psum#9426 ASC NULLS FIRST], output=[i_category#512,i_brand#508,d_year#604,d_moy#606,avg_monthly_sales#9424,sum_sales#9423,psum#9426,nsum#9427])
   +- *(27) Project [i_category#512, i_brand#508, d_year#604, d_moy#606, avg_monthly_sales#9424, sum_sales#9423, sum_sales#9444 AS psum#9426, sum_sales#9453 AS nsum#9427]
      +- *(27) SortMergeJoin [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#9425], [i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, (rn#9681 - 1)], Inner
         :- *(25) Project [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#9423, avg_monthly_sales#9424, rn#9425, sum_sales#9444]
         :  +- *(25) SortMergeJoin [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#9425], [i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, (rn#9574 + 1)], Inner
         :     :- *(23) Sort [i_category#512 ASC NULLS FIRST, i_brand#508 ASC NULLS FIRST, s_store_name#331 ASC NULLS FIRST, s_company_name#343 ASC NULLS FIRST, rn#9425 ASC NULLS FIRST], false, 0
         :     :  +- AQEShuffleRead coalesced
         :     :     +- ShuffleQueryStage 24
         :     :        +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#9425, 200), ENSURE_REQUIREMENTS, [id=#78722]
         :     :           +- *(18) Project [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#9423, avg_monthly_sales#9424, rn#9425]
         :     :              +- *(18) Filter ((isnotnull(avg_monthly_sales#9424) AND (avg_monthly_sales#9424 > 0.000000)) AND (CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#9423 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#9424 as decimal(22,6)))), DecimalType(22,6), true), false)) / promote_precision(cast(avg_monthly_sales#9424 as decimal(22,6)))), DecimalType(38,16), true) > 0.1000000000000000))
         :     :                 +- Window [avg(_w0#9437) windowspecdefinition(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#9424], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604]
         :     :                    +- *(17) Filter (isnotnull(d_year#604) AND (d_year#604 = 2000))
         :     :                       +- Window [rank(d_year#604, d_moy#606) windowspecdefinition(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#9425], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343], [d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST]
         :     :                          +- *(16) Sort [i_category#512 ASC NULLS FIRST, i_brand#508 ASC NULLS FIRST, s_store_name#331 ASC NULLS FIRST, s_company_name#343 ASC NULLS FIRST, d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST], false, 0
         :     :                             +- AQEShuffleRead coalesced
         :     :                                +- ShuffleQueryStage 20
         :     :                                   +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, 200), ENSURE_REQUIREMENTS, [id=#78527]
         :     :                                      +- *(13) HashAggregate(keys=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606], functions=[sum(UnscaledValue(ss_sales_price#677))], output=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#9423, _w0#9437])
         :     :                                         +- AQEShuffleRead coalesced
         :     :                                            +- ShuffleQueryStage 15
         :     :                                               +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, 200), ENSURE_REQUIREMENTS, [id=#78268]
         :     :                                                  +- *(10) HashAggregate(keys=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606], functions=[partial_sum(UnscaledValue(ss_sales_price#677))], output=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum#9683L])
         :     :                                                     +- *(10) Project [i_brand#508, i_category#512, ss_sales_price#677, d_year#604, d_moy#606, s_store_name#331, s_company_name#343]
         :     :                                                        +- *(10) BroadcastHashJoin [ss_store_sk#671], [s_store_sk#326], Inner, BuildRight, false
         :     :                                                           :- *(10) Project [i_brand#508, i_category#512, ss_store_sk#671, ss_sales_price#677, d_year#604, d_moy#606]
         :     :                                                           :  +- *(10) BroadcastHashJoin [ss_sold_date_sk#664], [d_date_sk#598], Inner, BuildRight, false
         :     :                                                           :     :- *(10) Project [i_brand#508, i_category#512, ss_sold_date_sk#664, ss_store_sk#671, ss_sales_price#677]
         :     :                                                           :     :  +- *(10) BroadcastHashJoin [i_item_sk#500], [ss_item_sk#666], Inner, BuildLeft, false
         :     :                                                           :     :     :- BroadcastQueryStage 0
         :     :                                                           :     :     :  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77218]
         :     :                                                           :     :     :     +- *(1) Filter ((isnotnull(i_item_sk#500) AND isnotnull(i_category#512)) AND isnotnull(i_brand#508))
         :     :                                                           :     :     :        +- *(1) ColumnarToRow
         :     :                                                           :     :     :           +- FileScan parquet [i_item_sk#500,i_brand#508,i_category#512] Batched: true, DataFilters: [isnotnull(i_item_sk#500), isnotnull(i_category#512), isnotnull(i_brand#508)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
         :     :                                                           :     :     +- *(10) Filter ((isnotnull(ss_item_sk#666) AND isnotnull(ss_sold_date_sk#664)) AND isnotnull(ss_store_sk#671))
         :     :                                                           :     :        +- *(10) ColumnarToRow
         :     :                                                           :     :           +- FileScan parquet [ss_sold_date_sk#664,ss_item_sk#666,ss_store_sk#671,ss_sales_price#677] Batched: true, DataFilters: [isnotnull(ss_item_sk#666), isnotnull(ss_sold_date_sk#664), isnotnull(ss_store_sk#671)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
         :     :                                                           :     +- BroadcastQueryStage 1
         :     :                                                           :        +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77235]
         :     :                                                           :           +- *(2) Filter ((((d_year#604 = 2000) OR ((d_year#604 = 1999) AND (d_moy#606 = 12))) OR ((d_year#604 = 2001) AND (d_moy#606 = 1))) AND isnotnull(d_date_sk#598))
         :     :                                                           :              +- *(2) ColumnarToRow
         :     :                                                           :                 +- FileScan parquet [d_date_sk#598,d_year#604,d_moy#606] Batched: true, DataFilters: [(((d_year#604 = 2000) OR ((d_year#604 = 1999) AND (d_moy#606 = 12))) OR ((d_year#604 = 2001) AND..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
         :     :                                                           +- BroadcastQueryStage 2
         :     :                                                              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77252]
         :     :                                                                 +- *(3) Filter ((isnotnull(s_store_sk#326) AND isnotnull(s_store_name#331)) AND isnotnull(s_company_name#343))
         :     :                                                                    +- *(3) ColumnarToRow
         :     :                                                                       +- FileScan parquet [s_store_sk#326,s_store_name#331,s_company_name#343] Batched: true, DataFilters: [isnotnull(s_store_sk#326), isnotnull(s_store_name#331), isnotnull(s_company_name#343)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
         :     +- *(24) Sort [i_category#9480 ASC NULLS FIRST, i_brand#9476 ASC NULLS FIRST, s_store_name#9546 ASC NULLS FIRST, s_company_name#9558 ASC NULLS FIRST, (rn#9574 + 1) ASC NULLS FIRST], false, 0
         :        +- AQEShuffleRead coalesced
         :           +- ShuffleQueryStage 25
         :              +- Exchange hashpartitioning(i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, (rn#9574 + 1), 200), ENSURE_REQUIREMENTS, [id=#78830]
         :                 +- *(20) Project [i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, sum_sales#9423 AS sum_sales#9444, rn#9574]
         :                    +- Window [rank(d_year#9519, d_moy#9521) windowspecdefinition(i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, d_year#9519 ASC NULLS FIRST, d_moy#9521 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#9574], [i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558], [d_year#9519 ASC NULLS FIRST, d_moy#9521 ASC NULLS FIRST]
         :                       +- *(19) Sort [i_category#9480 ASC NULLS FIRST, i_brand#9476 ASC NULLS FIRST, s_store_name#9546 ASC NULLS FIRST, s_company_name#9558 ASC NULLS FIRST, d_year#9519 ASC NULLS FIRST, d_moy#9521 ASC NULLS FIRST], false, 0
         :                          +- AQEShuffleRead coalesced
         :                             +- ShuffleQueryStage 21
         :                                +- Exchange hashpartitioning(i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, 200), ENSURE_REQUIREMENTS, [id=#78562]
         :                                   +- *(14) HashAggregate(keys=[i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, d_year#9519, d_moy#9521], functions=[sum(UnscaledValue(ss_sales_price#9503))], output=[i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, d_year#9519, d_moy#9521, sum_sales#9423])
         :                                      +- AQEShuffleRead coalesced
         :                                         +- ShuffleQueryStage 17
         :                                            +- ReusedExchange [i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, d_year#9519, d_moy#9521, sum#9685L], Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, 200), ENSURE_REQUIREMENTS, [id=#78268]
         +- *(26) Sort [i_category#9587 ASC NULLS FIRST, i_brand#9583 ASC NULLS FIRST, s_store_name#9653 ASC NULLS FIRST, s_company_name#9665 ASC NULLS FIRST, (rn#9681 - 1) ASC NULLS FIRST], false, 0
            +- AQEShuffleRead coalesced
               +- ShuffleQueryStage 26
                  +- Exchange hashpartitioning(i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, (rn#9681 - 1), 200), ENSURE_REQUIREMENTS, [id=#78860]
                     +- *(22) Project [i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, sum_sales#9423 AS sum_sales#9453, rn#9681]
                        +- Window [rank(d_year#9626, d_moy#9628) windowspecdefinition(i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, d_year#9626 ASC NULLS FIRST, d_moy#9628 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#9681], [i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665], [d_year#9626 ASC NULLS FIRST, d_moy#9628 ASC NULLS FIRST]
                           +- *(21) Sort [i_category#9587 ASC NULLS FIRST, i_brand#9583 ASC NULLS FIRST, s_store_name#9653 ASC NULLS FIRST, s_company_name#9665 ASC NULLS FIRST, d_year#9626 ASC NULLS FIRST, d_moy#9628 ASC NULLS FIRST], false, 0
                              +- AQEShuffleRead coalesced
                                 +- ShuffleQueryStage 23
                                    +- ReusedExchange [i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, d_year#9626, d_moy#9628, sum_sales#9423], Exchange hashpartitioning(i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, 200), ENSURE_REQUIREMENTS, [id=#78562]
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[CheckOverflow((promote_precision(cast(sum_sales#9423 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#9424 as decimal(22,6)))), DecimalType(22,6), true) ASC NULLS FIRST,psum#9426 ASC NULLS FIRST], output=[i_category#512,i_brand#508,d_year#604,d_moy#606,avg_monthly_sales#9424,sum_sales#9423,psum#9426,nsum#9427])
   +- Project [i_category#512, i_brand#508, d_year#604, d_moy#606, avg_monthly_sales#9424, sum_sales#9423, sum_sales#9444 AS psum#9426, sum_sales#9453 AS nsum#9427]
      +- SortMergeJoin [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#9425], [i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, (rn#9681 - 1)], Inner
         :- Project [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#9423, avg_monthly_sales#9424, rn#9425, sum_sales#9444]
         :  +- SortMergeJoin [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#9425], [i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, (rn#9574 + 1)], Inner
         :     :- Sort [i_category#512 ASC NULLS FIRST, i_brand#508 ASC NULLS FIRST, s_store_name#331 ASC NULLS FIRST, s_company_name#343 ASC NULLS FIRST, rn#9425 ASC NULLS FIRST], false, 0
         :     :  +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, rn#9425, 200), ENSURE_REQUIREMENTS, [id=#77129]
         :     :     +- Project [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#9423, avg_monthly_sales#9424, rn#9425]
         :     :        +- Filter ((isnotnull(avg_monthly_sales#9424) AND (avg_monthly_sales#9424 > 0.000000)) AND (CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#9423 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#9424 as decimal(22,6)))), DecimalType(22,6), true), false)) / promote_precision(cast(avg_monthly_sales#9424 as decimal(22,6)))), DecimalType(38,16), true) > 0.1000000000000000))
         :     :           +- Window [avg(_w0#9437) windowspecdefinition(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#9424], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604]
         :     :              +- Filter (isnotnull(d_year#604) AND (d_year#604 = 2000))
         :     :                 +- Window [rank(d_year#604, d_moy#606) windowspecdefinition(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#9425], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343], [d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST]
         :     :                    +- Sort [i_category#512 ASC NULLS FIRST, i_brand#508 ASC NULLS FIRST, s_store_name#331 ASC NULLS FIRST, s_company_name#343 ASC NULLS FIRST, d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST], false, 0
         :     :                       +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, 200), ENSURE_REQUIREMENTS, [id=#77100]
         :     :                          +- HashAggregate(keys=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606], functions=[sum(UnscaledValue(ss_sales_price#677))], output=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#9423, _w0#9437])
         :     :                             +- Exchange hashpartitioning(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, 200), ENSURE_REQUIREMENTS, [id=#77097]
         :     :                                +- HashAggregate(keys=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606], functions=[partial_sum(UnscaledValue(ss_sales_price#677))], output=[i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum#9683L])
         :     :                                   +- Project [i_brand#508, i_category#512, ss_sales_price#677, d_year#604, d_moy#606, s_store_name#331, s_company_name#343]
         :     :                                      +- BroadcastHashJoin [ss_store_sk#671], [s_store_sk#326], Inner, BuildRight, false
         :     :                                         :- Project [i_brand#508, i_category#512, ss_store_sk#671, ss_sales_price#677, d_year#604, d_moy#606]
         :     :                                         :  +- BroadcastHashJoin [ss_sold_date_sk#664], [d_date_sk#598], Inner, BuildRight, false
         :     :                                         :     :- Project [i_brand#508, i_category#512, ss_sold_date_sk#664, ss_store_sk#671, ss_sales_price#677]
         :     :                                         :     :  +- BroadcastHashJoin [i_item_sk#500], [ss_item_sk#666], Inner, BuildLeft, false
         :     :                                         :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77084]
         :     :                                         :     :     :  +- Filter ((isnotnull(i_item_sk#500) AND isnotnull(i_category#512)) AND isnotnull(i_brand#508))
         :     :                                         :     :     :     +- FileScan parquet [i_item_sk#500,i_brand#508,i_category#512] Batched: true, DataFilters: [isnotnull(i_item_sk#500), isnotnull(i_category#512), isnotnull(i_brand#508)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
         :     :                                         :     :     +- Filter ((isnotnull(ss_item_sk#666) AND isnotnull(ss_sold_date_sk#664)) AND isnotnull(ss_store_sk#671))
         :     :                                         :     :        +- FileScan parquet [ss_sold_date_sk#664,ss_item_sk#666,ss_store_sk#671,ss_sales_price#677] Batched: true, DataFilters: [isnotnull(ss_item_sk#666), isnotnull(ss_sold_date_sk#664), isnotnull(ss_store_sk#671)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
         :     :                                         :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77088]
         :     :                                         :        +- Filter ((((d_year#604 = 2000) OR ((d_year#604 = 1999) AND (d_moy#606 = 12))) OR ((d_year#604 = 2001) AND (d_moy#606 = 1))) AND isnotnull(d_date_sk#598))
         :     :                                         :           +- FileScan parquet [d_date_sk#598,d_year#604,d_moy#606] Batched: true, DataFilters: [(((d_year#604 = 2000) OR ((d_year#604 = 1999) AND (d_moy#606 = 12))) OR ((d_year#604 = 2001) AND..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
         :     :                                         +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77092]
         :     :                                            +- Filter ((isnotnull(s_store_sk#326) AND isnotnull(s_store_name#331)) AND isnotnull(s_company_name#343))
         :     :                                               +- FileScan parquet [s_store_sk#326,s_store_name#331,s_company_name#343] Batched: true, DataFilters: [isnotnull(s_store_sk#326), isnotnull(s_store_name#331), isnotnull(s_company_name#343)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
         :     +- Sort [i_category#9480 ASC NULLS FIRST, i_brand#9476 ASC NULLS FIRST, s_store_name#9546 ASC NULLS FIRST, s_company_name#9558 ASC NULLS FIRST, (rn#9574 + 1) ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, (rn#9574 + 1), 200), ENSURE_REQUIREMENTS, [id=#77130]
         :           +- Project [i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, sum_sales#9423 AS sum_sales#9444, rn#9574]
         :              +- Window [rank(d_year#9519, d_moy#9521) windowspecdefinition(i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, d_year#9519 ASC NULLS FIRST, d_moy#9521 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#9574], [i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558], [d_year#9519 ASC NULLS FIRST, d_moy#9521 ASC NULLS FIRST]
         :                 +- Sort [i_category#9480 ASC NULLS FIRST, i_brand#9476 ASC NULLS FIRST, s_store_name#9546 ASC NULLS FIRST, s_company_name#9558 ASC NULLS FIRST, d_year#9519 ASC NULLS FIRST, d_moy#9521 ASC NULLS FIRST], false, 0
         :                    +- Exchange hashpartitioning(i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, 200), ENSURE_REQUIREMENTS, [id=#77123]
         :                       +- HashAggregate(keys=[i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, d_year#9519, d_moy#9521], functions=[sum(UnscaledValue(ss_sales_price#9503))], output=[i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, d_year#9519, d_moy#9521, sum_sales#9423])
         :                          +- Exchange hashpartitioning(i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, d_year#9519, d_moy#9521, 200), ENSURE_REQUIREMENTS, [id=#77120]
         :                             +- HashAggregate(keys=[i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, d_year#9519, d_moy#9521], functions=[partial_sum(UnscaledValue(ss_sales_price#9503))], output=[i_category#9480, i_brand#9476, s_store_name#9546, s_company_name#9558, d_year#9519, d_moy#9521, sum#9685L])
         :                                +- Project [i_brand#9476, i_category#9480, ss_sales_price#9503, d_year#9519, d_moy#9521, s_store_name#9546, s_company_name#9558]
         :                                   +- BroadcastHashJoin [ss_store_sk#9497], [s_store_sk#9541], Inner, BuildRight, false
         :                                      :- Project [i_brand#9476, i_category#9480, ss_store_sk#9497, ss_sales_price#9503, d_year#9519, d_moy#9521]
         :                                      :  +- BroadcastHashJoin [ss_sold_date_sk#9490], [d_date_sk#9513], Inner, BuildRight, false
         :                                      :     :- Project [i_brand#9476, i_category#9480, ss_sold_date_sk#9490, ss_store_sk#9497, ss_sales_price#9503]
         :                                      :     :  +- BroadcastHashJoin [i_item_sk#9468], [ss_item_sk#9492], Inner, BuildLeft, false
         :                                      :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77107]
         :                                      :     :     :  +- Filter ((isnotnull(i_item_sk#9468) AND isnotnull(i_category#9480)) AND isnotnull(i_brand#9476))
         :                                      :     :     :     +- FileScan parquet [i_item_sk#9468,i_brand#9476,i_category#9480] Batched: true, DataFilters: [isnotnull(i_item_sk#9468), isnotnull(i_category#9480), isnotnull(i_brand#9476)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
         :                                      :     :     +- Filter ((isnotnull(ss_item_sk#9492) AND isnotnull(ss_sold_date_sk#9490)) AND isnotnull(ss_store_sk#9497))
         :                                      :     :        +- FileScan parquet [ss_sold_date_sk#9490,ss_item_sk#9492,ss_store_sk#9497,ss_sales_price#9503] Batched: true, DataFilters: [isnotnull(ss_item_sk#9492), isnotnull(ss_sold_date_sk#9490), isnotnull(ss_store_sk#9497)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
         :                                      :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77111]
         :                                      :        +- Filter ((((d_year#9519 = 2000) OR ((d_year#9519 = 1999) AND (d_moy#9521 = 12))) OR ((d_year#9519 = 2001) AND (d_moy#9521 = 1))) AND isnotnull(d_date_sk#9513))
         :                                      :           +- FileScan parquet [d_date_sk#9513,d_year#9519,d_moy#9521] Batched: true, DataFilters: [(((d_year#9519 = 2000) OR ((d_year#9519 = 1999) AND (d_moy#9521 = 12))) OR ((d_year#9519 = 2001)..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
         :                                      +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77115]
         :                                         +- Filter ((isnotnull(s_store_sk#9541) AND isnotnull(s_store_name#9546)) AND isnotnull(s_company_name#9558))
         :                                            +- FileScan parquet [s_store_sk#9541,s_store_name#9546,s_company_name#9558] Batched: true, DataFilters: [isnotnull(s_store_sk#9541), isnotnull(s_store_name#9546), isnotnull(s_company_name#9558)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
         +- Sort [i_category#9587 ASC NULLS FIRST, i_brand#9583 ASC NULLS FIRST, s_store_name#9653 ASC NULLS FIRST, s_company_name#9665 ASC NULLS FIRST, (rn#9681 - 1) ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, (rn#9681 - 1), 200), ENSURE_REQUIREMENTS, [id=#77157]
               +- Project [i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, sum_sales#9423 AS sum_sales#9453, rn#9681]
                  +- Window [rank(d_year#9626, d_moy#9628) windowspecdefinition(i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, d_year#9626 ASC NULLS FIRST, d_moy#9628 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#9681], [i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665], [d_year#9626 ASC NULLS FIRST, d_moy#9628 ASC NULLS FIRST]
                     +- Sort [i_category#9587 ASC NULLS FIRST, i_brand#9583 ASC NULLS FIRST, s_store_name#9653 ASC NULLS FIRST, s_company_name#9665 ASC NULLS FIRST, d_year#9626 ASC NULLS FIRST, d_moy#9628 ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, 200), ENSURE_REQUIREMENTS, [id=#77151]
                           +- HashAggregate(keys=[i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, d_year#9626, d_moy#9628], functions=[sum(UnscaledValue(ss_sales_price#9610))], output=[i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, d_year#9626, d_moy#9628, sum_sales#9423])
                              +- Exchange hashpartitioning(i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, d_year#9626, d_moy#9628, 200), ENSURE_REQUIREMENTS, [id=#77148]
                                 +- HashAggregate(keys=[i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, d_year#9626, d_moy#9628], functions=[partial_sum(UnscaledValue(ss_sales_price#9610))], output=[i_category#9587, i_brand#9583, s_store_name#9653, s_company_name#9665, d_year#9626, d_moy#9628, sum#9687L])
                                    +- Project [i_brand#9583, i_category#9587, ss_sales_price#9610, d_year#9626, d_moy#9628, s_store_name#9653, s_company_name#9665]
                                       +- BroadcastHashJoin [ss_store_sk#9604], [s_store_sk#9648], Inner, BuildRight, false
                                          :- Project [i_brand#9583, i_category#9587, ss_store_sk#9604, ss_sales_price#9610, d_year#9626, d_moy#9628]
                                          :  +- BroadcastHashJoin [ss_sold_date_sk#9597], [d_date_sk#9620], Inner, BuildRight, false
                                          :     :- Project [i_brand#9583, i_category#9587, ss_sold_date_sk#9597, ss_store_sk#9604, ss_sales_price#9610]
                                          :     :  +- BroadcastHashJoin [i_item_sk#9575], [ss_item_sk#9599], Inner, BuildLeft, false
                                          :     :     :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77135]
                                          :     :     :  +- Filter ((isnotnull(i_item_sk#9575) AND isnotnull(i_category#9587)) AND isnotnull(i_brand#9583))
                                          :     :     :     +- FileScan parquet [i_item_sk#9575,i_brand#9583,i_category#9587] Batched: true, DataFilters: [isnotnull(i_item_sk#9575), isnotnull(i_category#9587), isnotnull(i_brand#9583)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
                                          :     :     +- Filter ((isnotnull(ss_item_sk#9599) AND isnotnull(ss_sold_date_sk#9597)) AND isnotnull(ss_store_sk#9604))
                                          :     :        +- FileScan parquet [ss_sold_date_sk#9597,ss_item_sk#9599,ss_store_sk#9604,ss_sales_price#9610] Batched: true, DataFilters: [isnotnull(ss_item_sk#9599), isnotnull(ss_sold_date_sk#9597), isnotnull(ss_store_sk#9604)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_item_sk), IsNotNull(ss_sold_date_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
                                          :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77139]
                                          :        +- Filter ((((d_year#9626 = 2000) OR ((d_year#9626 = 1999) AND (d_moy#9628 = 12))) OR ((d_year#9626 = 2001) AND (d_moy#9628 = 1))) AND isnotnull(d_date_sk#9620))
                                          :           +- FileScan parquet [d_date_sk#9620,d_year#9626,d_moy#9628] Batched: true, DataFilters: [(((d_year#9626 = 2000) OR ((d_year#9626 = 1999) AND (d_moy#9628 = 12))) OR ((d_year#9626 = 2001)..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
                                          +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#77143]
                                             +- Filter ((isnotnull(s_store_sk#9648) AND isnotnull(s_store_name#9653)) AND isnotnull(s_company_name#9665))
                                                +- FileScan parquet [s_store_sk#9648,s_store_name#9653,s_company_name#9665] Batched: true, DataFilters: [isnotnull(s_store_sk#9648), isnotnull(s_store_name#9653), isnotnull(s_company_name#9665)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
