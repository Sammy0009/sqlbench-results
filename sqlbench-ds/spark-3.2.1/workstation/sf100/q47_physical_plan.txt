AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[CheckOverflow((promote_precision(cast(sum_sales#16036 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#16037 as decimal(22,6)))), DecimalType(22,6), true) ASC NULLS FIRST,psum#16039 ASC NULLS FIRST], output=[i_category#680,i_brand#676,d_year#618,d_moy#620,avg_monthly_sales#16037,sum_sales#16036,psum#16039,nsum#16040])
   +- GpuColumnarToRow false
      +- GpuProject [i_category#680, i_brand#676, d_year#618, d_moy#620, avg_monthly_sales#16037, sum_sales#16036, sum_sales#16057 AS psum#16039, sum_sales#16066 AS nsum#16040], true
         +- GpuShuffledHashJoin [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, rn#16038], [i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, (rn#16294 - 1)], Inner, GpuBuildRight, false
            :- GpuProject [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum_sales#16036, avg_monthly_sales#16037, rn#16038, sum_sales#16057], true
            :  +- GpuShuffledHashJoin [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, rn#16038], [i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, (rn#16187 + 1)], Inner, GpuBuildRight, false
            :     :- GpuShuffleCoalesce 2147483647
            :     :  +- GpuCustomShuffleReader coalesced
            :     :     +- ShuffleQueryStage 39
            :     :        +- GpuColumnarExchange gpuhashpartitioning(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, rn#16038, 200), ENSURE_REQUIREMENTS, [id=#292539]
            :     :           +- GpuProject [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum_sales#16036, avg_monthly_sales#16037, rn#16038], true
            :     :              +- GpuRowToColumnar targetsize(2147483647)
            :     :                 +- *(1) Filter ((isnotnull(avg_monthly_sales#16037) AND (avg_monthly_sales#16037 > 0.000000)) AND (CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#16036 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#16037 as decimal(22,6)))), DecimalType(22,6), true), false)) / promote_precision(cast(avg_monthly_sales#16037 as decimal(22,6)))), DecimalType(38,16), true) > 0.1000000000000000))
            :     :                    +- GpuColumnarToRow false
            :     :                       +- GpuProject [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum_sales#16036, _w0#16050, rn#16038, cast((_gpu_w9#16591 / _gpu_w10#16592L) as decimal(21,6)) AS avg_monthly_sales#16037], false
            :     :                          +- GpuWindow [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum_sales#16036, _w0#16050, rn#16038, gpudecimal128sum(_w0#16050, DecimalType(27,2), false, false) gpuwindowspecdefinition(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(unboundedfollowing$()))) AS _gpu_w9#16591, gpucount(_w0#16050, false) gpuwindowspecdefinition(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(unboundedfollowing$()))) AS _gpu_w10#16592L], [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618]
            :     :                             +- GpuCoalesceBatches batchedbykey(i_category#680 ASC NULLS FIRST, i_brand#676 ASC NULLS FIRST, s_store_name#717 ASC NULLS FIRST, s_company_name#729 ASC NULLS FIRST, d_year#618 ASC NULLS FIRST)
            :     :                                +- GpuFilter (gpuisnotnull(d_year#618) AND (d_year#618 = 2000)), true
            :     :                                   +- GpuRunningWindow [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum_sales#16036, _w0#16050, gpurank(d_year#618, d_moy#620) gpuwindowspecdefinition(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618 ASC NULLS FIRST, d_moy#620 ASC NULLS FIRST, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(currentrow$()))) AS rn#16038], [i_category#680, i_brand#676, s_store_name#717, s_company_name#729], [d_year#618 ASC NULLS FIRST, d_moy#620 ASC NULLS FIRST]
            :     :                                      +- GpuSort [i_category#680 ASC NULLS FIRST, i_brand#676 ASC NULLS FIRST, s_store_name#717 ASC NULLS FIRST, s_company_name#729 ASC NULLS FIRST, d_year#618 ASC NULLS FIRST, d_moy#620 ASC NULLS FIRST], false, com.nvidia.spark.rapids.OutOfCoreSort$@59d99269
            :     :                                         +- GpuShuffleCoalesce 2147483647
            :     :                                            +- GpuCustomShuffleReader coalesced
            :     :                                               +- ShuffleQueryStage 35
            :     :                                                  +- GpuColumnarExchange gpuhashpartitioning(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, 200), ENSURE_REQUIREMENTS, [id=#292161]
            :     :                                                     +- GpuHashAggregate(keys=[i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620], functions=[gpubasicsum(UnscaledValue(ss_sales_price#265), LongType, false)], output=[i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum_sales#16036, _w0#16050])
            :     :                                                        +- GpuShuffleCoalesce 2147483647
            :     :                                                           +- GpuCustomShuffleReader coalesced
            :     :                                                              +- ShuffleQueryStage 30
            :     :                                                                 +- GpuColumnarExchange gpuhashpartitioning(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, 200), ENSURE_REQUIREMENTS, [id=#291764]
            :     :                                                                    +- GpuHashAggregate(keys=[i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620], functions=[partial_gpubasicsum(UnscaledValue(ss_sales_price#265), LongType, false)], output=[i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum#16296L])
            :     :                                                                       +- GpuProject [ss_sales_price#265, d_year#618, d_moy#620, i_brand#676, i_category#680, s_store_name#717, s_company_name#729], true
            :     :                                                                          +- GpuShuffledHashJoin [ss_store_sk#259], [s_store_sk#712], Inner, GpuBuildRight, false
            :     :                                                                             :- GpuShuffleCoalesce 2147483647
            :     :                                                                             :  +- GpuCustomShuffleReader coalesced
            :     :                                                                             :     +- ShuffleQueryStage 25
            :     :                                                                             :        +- GpuColumnarExchange gpuhashpartitioning(ss_store_sk#259, 200), ENSURE_REQUIREMENTS, [id=#290811]
            :     :                                                                             :           +- GpuProject [ss_store_sk#259, ss_sales_price#265, d_year#618, d_moy#620, i_brand#676, i_category#680], true
            :     :                                                                             :              +- GpuShuffledHashJoin [ss_item_sk#254], [i_item_sk#668], Inner, GpuBuildRight, false
            :     :                                                                             :                 :- GpuShuffleCoalesce 2147483647
            :     :                                                                             :                 :  +- GpuCustomShuffleReader coalesced
            :     :                                                                             :                 :     +- ShuffleQueryStage 20
            :     :                                                                             :                 :        +- GpuColumnarExchange gpuhashpartitioning(ss_item_sk#254, 200), ENSURE_REQUIREMENTS, [id=#290149]
            :     :                                                                             :                 :           +- GpuProject [ss_item_sk#254, ss_store_sk#259, ss_sales_price#265, d_year#618, d_moy#620], true
            :     :                                                                             :                 :              +- GpuShuffledHashJoin [ss_sold_date_sk#252], [d_date_sk#612], Inner, GpuBuildRight, false
            :     :                                                                             :                 :                 :- GpuShuffleCoalesce 2147483647
            :     :                                                                             :                 :                 :  +- GpuCustomShuffleReader coalesced
            :     :                                                                             :                 :                 :     +- ShuffleQueryStage 0
            :     :                                                                             :                 :                 :        +- GpuColumnarExchange gpuhashpartitioning(ss_sold_date_sk#252, 200), ENSURE_REQUIREMENTS, [id=#287549]
            :     :                                                                             :                 :                 :           +- GpuCoalesceBatches targetsize(2147483647)
            :     :                                                                             :                 :                 :              +- GpuFilter ((gpuisnotnull(ss_sold_date_sk#252) AND gpuisnotnull(ss_item_sk#254)) AND gpuisnotnull(ss_store_sk#259)), true
            :     :                                                                             :                 :                 :                 +- GpuFileGpuScan parquet [ss_sold_date_sk#252,ss_item_sk#254,ss_store_sk#259,ss_sales_price#265] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#252), isnotnull(ss_item_sk#254), isnotnull(ss_store_sk#259)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk), IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
            :     :                                                                             :                 :                 +- GpuCustomShuffleReader coalesced
            :     :                                                                             :                 :                    +- ShuffleQueryStage 1
            :     :                                                                             :                 :                       +- GpuColumnarExchange gpuhashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#287577]
            :     :                                                                             :                 :                          +- GpuCoalesceBatches targetsize(2147483647)
            :     :                                                                             :                 :                             +- GpuFilter ((((d_year#618 = 2000) OR ((d_year#618 = 1999) AND (d_moy#620 = 12))) OR ((d_year#618 = 2001) AND (d_moy#620 = 1))) AND gpuisnotnull(d_date_sk#612)), true
            :     :                                                                             :                 :                                +- GpuFileGpuScan parquet [d_date_sk#612,d_year#618,d_moy#620] Batched: true, DataFilters: [(((d_year#618 = 2000) OR ((d_year#618 = 1999) AND (d_moy#620 = 12))) OR ((d_year#618 = 2001) AND..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
            :     :                                                                             :                 +- GpuCustomShuffleReader coalesced
            :     :                                                                             :                    +- ShuffleQueryStage 2
            :     :                                                                             :                       +- GpuColumnarExchange gpuhashpartitioning(i_item_sk#668, 200), ENSURE_REQUIREMENTS, [id=#287609]
            :     :                                                                             :                          +- GpuCoalesceBatches targetsize(2147483647)
            :     :                                                                             :                             +- GpuFilter ((gpuisnotnull(i_item_sk#668) AND gpuisnotnull(i_category#680)) AND gpuisnotnull(i_brand#676)), true
            :     :                                                                             :                                +- GpuFileGpuScan parquet [i_item_sk#668,i_brand#676,i_category#680] Batched: true, DataFilters: [isnotnull(i_item_sk#668), isnotnull(i_category#680), isnotnull(i_brand#676)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
            :     :                                                                             +- GpuCustomShuffleReader coalesced
            :     :                                                                                +- ShuffleQueryStage 3
            :     :                                                                                   +- GpuColumnarExchange gpuhashpartitioning(s_store_sk#712, 200), ENSURE_REQUIREMENTS, [id=#287641]
            :     :                                                                                      +- GpuCoalesceBatches targetsize(2147483647)
            :     :                                                                                         +- GpuFilter ((gpuisnotnull(s_store_sk#712) AND gpuisnotnull(s_store_name#717)) AND gpuisnotnull(s_company_name#729)), true
            :     :                                                                                            +- GpuFileGpuScan parquet [s_store_sk#712,s_store_name#717,s_company_name#729] Batched: true, DataFilters: [isnotnull(s_store_sk#712), isnotnull(s_store_name#717), isnotnull(s_company_name#729)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
            :     +- GpuCustomShuffleReader coalesced
            :        +- ShuffleQueryStage 40
            :           +- GpuColumnarExchange gpuhashpartitioning(i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, (rn#16187 + 1), 200), ENSURE_REQUIREMENTS, [id=#292723]
            :              +- GpuProject [i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, sum_sales#16036 AS sum_sales#16057, rn#16187], true
            :                 +- GpuRunningWindow [i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132, d_moy#16134, sum_sales#16036, gpurank(d_year#16132, d_moy#16134) gpuwindowspecdefinition(i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132 ASC NULLS FIRST, d_moy#16134 ASC NULLS FIRST, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(currentrow$()))) AS rn#16187], [i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171], [d_year#16132 ASC NULLS FIRST, d_moy#16134 ASC NULLS FIRST]
            :                    +- GpuSort [i_category#16093 ASC NULLS FIRST, i_brand#16089 ASC NULLS FIRST, s_store_name#16159 ASC NULLS FIRST, s_company_name#16171 ASC NULLS FIRST, d_year#16132 ASC NULLS FIRST, d_moy#16134 ASC NULLS FIRST], false, com.nvidia.spark.rapids.OutOfCoreSort$@59d99269
            :                       +- GpuShuffleCoalesce 2147483647
            :                          +- GpuCustomShuffleReader coalesced
            :                             +- ShuffleQueryStage 36
            :                                +- GpuColumnarExchange gpuhashpartitioning(i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, 200), ENSURE_REQUIREMENTS, [id=#292213]
            :                                   +- GpuHashAggregate(keys=[i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132, d_moy#16134], functions=[gpubasicsum(UnscaledValue(ss_sales_price#16116), LongType, false)], output=[i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132, d_moy#16134, sum_sales#16036])
            :                                      +- GpuShuffleCoalesce 2147483647
            :                                         +- GpuCustomShuffleReader coalesced
            :                                            +- ShuffleQueryStage 32
            :                                               +- ReusedExchange [i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132, d_moy#16134, sum#16298L], GpuColumnarExchange gpuhashpartitioning(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, 200), ENSURE_REQUIREMENTS, [id=#291764]
            +- GpuCoalesceBatches RequireSingleBatchWithFilter
               +- GpuShuffleCoalesce 2147483647
                  +- GpuCustomShuffleReader coalesced
                     +- ShuffleQueryStage 41
                        +- GpuColumnarExchange gpuhashpartitioning(i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, (rn#16294 - 1), 200), ENSURE_REQUIREMENTS, [id=#292772]
                           +- GpuProject [i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, sum_sales#16036 AS sum_sales#16066, rn#16294], true
                              +- GpuRunningWindow [i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, d_year#16239, d_moy#16241, sum_sales#16036, gpurank(d_year#16239, d_moy#16241) gpuwindowspecdefinition(i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, d_year#16239 ASC NULLS FIRST, d_moy#16241 ASC NULLS FIRST, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(currentrow$()))) AS rn#16294], [i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278], [d_year#16239 ASC NULLS FIRST, d_moy#16241 ASC NULLS FIRST]
                                 +- GpuSort [i_category#16200 ASC NULLS FIRST, i_brand#16196 ASC NULLS FIRST, s_store_name#16266 ASC NULLS FIRST, s_company_name#16278 ASC NULLS FIRST, d_year#16239 ASC NULLS FIRST, d_moy#16241 ASC NULLS FIRST], false, com.nvidia.spark.rapids.OutOfCoreSort$@59d99269
                                    +- GpuShuffleCoalesce 2147483647
                                       +- GpuCustomShuffleReader coalesced
                                          +- ShuffleQueryStage 38
                                             +- ReusedExchange [i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, d_year#16239, d_moy#16241, sum_sales#16036], GpuColumnarExchange gpuhashpartitioning(i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, 200), ENSURE_REQUIREMENTS, [id=#292213]
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[CheckOverflow((promote_precision(cast(sum_sales#16036 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#16037 as decimal(22,6)))), DecimalType(22,6), true) ASC NULLS FIRST,psum#16039 ASC NULLS FIRST], output=[i_category#680,i_brand#676,d_year#618,d_moy#620,avg_monthly_sales#16037,sum_sales#16036,psum#16039,nsum#16040])
   +- Project [i_category#680, i_brand#676, d_year#618, d_moy#620, avg_monthly_sales#16037, sum_sales#16036, sum_sales#16057 AS psum#16039, sum_sales#16066 AS nsum#16040]
      +- SortMergeJoin [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, rn#16038], [i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, (rn#16294 - 1)], Inner
         :- Project [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum_sales#16036, avg_monthly_sales#16037, rn#16038, sum_sales#16057]
         :  +- SortMergeJoin [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, rn#16038], [i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, (rn#16187 + 1)], Inner
         :     :- Sort [i_category#680 ASC NULLS FIRST, i_brand#676 ASC NULLS FIRST, s_store_name#717 ASC NULLS FIRST, s_company_name#729 ASC NULLS FIRST, rn#16038 ASC NULLS FIRST], false, 0
         :     :  +- Exchange hashpartitioning(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, rn#16038, 200), ENSURE_REQUIREMENTS, [id=#286157]
         :     :     +- Project [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum_sales#16036, avg_monthly_sales#16037, rn#16038]
         :     :        +- Filter ((isnotnull(avg_monthly_sales#16037) AND (avg_monthly_sales#16037 > 0.000000)) AND (CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#16036 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#16037 as decimal(22,6)))), DecimalType(22,6), true), false)) / promote_precision(cast(avg_monthly_sales#16037 as decimal(22,6)))), DecimalType(38,16), true) > 0.1000000000000000))
         :     :           +- Window [avg(_w0#16050) windowspecdefinition(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#16037], [i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618]
         :     :              +- Filter (isnotnull(d_year#618) AND (d_year#618 = 2000))
         :     :                 +- Window [rank(d_year#618, d_moy#620) windowspecdefinition(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618 ASC NULLS FIRST, d_moy#620 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#16038], [i_category#680, i_brand#676, s_store_name#717, s_company_name#729], [d_year#618 ASC NULLS FIRST, d_moy#620 ASC NULLS FIRST]
         :     :                    +- Sort [i_category#680 ASC NULLS FIRST, i_brand#676 ASC NULLS FIRST, s_store_name#717 ASC NULLS FIRST, s_company_name#729 ASC NULLS FIRST, d_year#618 ASC NULLS FIRST, d_moy#620 ASC NULLS FIRST], false, 0
         :     :                       +- Exchange hashpartitioning(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, 200), ENSURE_REQUIREMENTS, [id=#286116]
         :     :                          +- HashAggregate(keys=[i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620], functions=[sum(UnscaledValue(ss_sales_price#265))], output=[i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum_sales#16036, _w0#16050])
         :     :                             +- Exchange hashpartitioning(i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, 200), ENSURE_REQUIREMENTS, [id=#286113]
         :     :                                +- HashAggregate(keys=[i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620], functions=[partial_sum(UnscaledValue(ss_sales_price#265))], output=[i_category#680, i_brand#676, s_store_name#717, s_company_name#729, d_year#618, d_moy#620, sum#16296L])
         :     :                                   +- Project [ss_sales_price#265, d_year#618, d_moy#620, i_brand#676, i_category#680, s_store_name#717, s_company_name#729]
         :     :                                      +- SortMergeJoin [ss_store_sk#259], [s_store_sk#712], Inner
         :     :                                         :- Sort [ss_store_sk#259 ASC NULLS FIRST], false, 0
         :     :                                         :  +- Exchange hashpartitioning(ss_store_sk#259, 200), ENSURE_REQUIREMENTS, [id=#286105]
         :     :                                         :     +- Project [ss_store_sk#259, ss_sales_price#265, d_year#618, d_moy#620, i_brand#676, i_category#680]
         :     :                                         :        +- SortMergeJoin [ss_item_sk#254], [i_item_sk#668], Inner
         :     :                                         :           :- Sort [ss_item_sk#254 ASC NULLS FIRST], false, 0
         :     :                                         :           :  +- Exchange hashpartitioning(ss_item_sk#254, 200), ENSURE_REQUIREMENTS, [id=#286097]
         :     :                                         :           :     +- Project [ss_item_sk#254, ss_store_sk#259, ss_sales_price#265, d_year#618, d_moy#620]
         :     :                                         :           :        +- SortMergeJoin [ss_sold_date_sk#252], [d_date_sk#612], Inner
         :     :                                         :           :           :- Sort [ss_sold_date_sk#252 ASC NULLS FIRST], false, 0
         :     :                                         :           :           :  +- Exchange hashpartitioning(ss_sold_date_sk#252, 200), ENSURE_REQUIREMENTS, [id=#286089]
         :     :                                         :           :           :     +- Filter ((isnotnull(ss_sold_date_sk#252) AND isnotnull(ss_item_sk#254)) AND isnotnull(ss_store_sk#259))
         :     :                                         :           :           :        +- FileScan parquet [ss_sold_date_sk#252,ss_item_sk#254,ss_store_sk#259,ss_sales_price#265] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#252), isnotnull(ss_item_sk#254), isnotnull(ss_store_sk#259)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk), IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
         :     :                                         :           :           +- Sort [d_date_sk#612 ASC NULLS FIRST], false, 0
         :     :                                         :           :              +- Exchange hashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#286090]
         :     :                                         :           :                 +- Filter ((((d_year#618 = 2000) OR ((d_year#618 = 1999) AND (d_moy#620 = 12))) OR ((d_year#618 = 2001) AND (d_moy#620 = 1))) AND isnotnull(d_date_sk#612))
         :     :                                         :           :                    +- FileScan parquet [d_date_sk#612,d_year#618,d_moy#620] Batched: true, DataFilters: [(((d_year#618 = 2000) OR ((d_year#618 = 1999) AND (d_moy#620 = 12))) OR ((d_year#618 = 2001) AND..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
         :     :                                         :           +- Sort [i_item_sk#668 ASC NULLS FIRST], false, 0
         :     :                                         :              +- Exchange hashpartitioning(i_item_sk#668, 200), ENSURE_REQUIREMENTS, [id=#286098]
         :     :                                         :                 +- Filter ((isnotnull(i_item_sk#668) AND isnotnull(i_category#680)) AND isnotnull(i_brand#676))
         :     :                                         :                    +- FileScan parquet [i_item_sk#668,i_brand#676,i_category#680] Batched: true, DataFilters: [isnotnull(i_item_sk#668), isnotnull(i_category#680), isnotnull(i_brand#676)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
         :     :                                         +- Sort [s_store_sk#712 ASC NULLS FIRST], false, 0
         :     :                                            +- Exchange hashpartitioning(s_store_sk#712, 200), ENSURE_REQUIREMENTS, [id=#286106]
         :     :                                               +- Filter ((isnotnull(s_store_sk#712) AND isnotnull(s_store_name#717)) AND isnotnull(s_company_name#729))
         :     :                                                  +- FileScan parquet [s_store_sk#712,s_store_name#717,s_company_name#729] Batched: true, DataFilters: [isnotnull(s_store_sk#712), isnotnull(s_store_name#717), isnotnull(s_company_name#729)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
         :     +- Sort [i_category#16093 ASC NULLS FIRST, i_brand#16089 ASC NULLS FIRST, s_store_name#16159 ASC NULLS FIRST, s_company_name#16171 ASC NULLS FIRST, (rn#16187 + 1) ASC NULLS FIRST], false, 0
         :        +- Exchange hashpartitioning(i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, (rn#16187 + 1), 200), ENSURE_REQUIREMENTS, [id=#286158]
         :           +- Project [i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, sum_sales#16036 AS sum_sales#16057, rn#16187]
         :              +- Window [rank(d_year#16132, d_moy#16134) windowspecdefinition(i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132 ASC NULLS FIRST, d_moy#16134 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#16187], [i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171], [d_year#16132 ASC NULLS FIRST, d_moy#16134 ASC NULLS FIRST]
         :                 +- Sort [i_category#16093 ASC NULLS FIRST, i_brand#16089 ASC NULLS FIRST, s_store_name#16159 ASC NULLS FIRST, s_company_name#16171 ASC NULLS FIRST, d_year#16132 ASC NULLS FIRST, d_moy#16134 ASC NULLS FIRST], false, 0
         :                    +- Exchange hashpartitioning(i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, 200), ENSURE_REQUIREMENTS, [id=#286151]
         :                       +- HashAggregate(keys=[i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132, d_moy#16134], functions=[sum(UnscaledValue(ss_sales_price#16116))], output=[i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132, d_moy#16134, sum_sales#16036])
         :                          +- Exchange hashpartitioning(i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132, d_moy#16134, 200), ENSURE_REQUIREMENTS, [id=#286148]
         :                             +- HashAggregate(keys=[i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132, d_moy#16134], functions=[partial_sum(UnscaledValue(ss_sales_price#16116))], output=[i_category#16093, i_brand#16089, s_store_name#16159, s_company_name#16171, d_year#16132, d_moy#16134, sum#16298L])
         :                                +- Project [ss_sales_price#16116, d_year#16132, d_moy#16134, i_brand#16089, i_category#16093, s_store_name#16159, s_company_name#16171]
         :                                   +- SortMergeJoin [ss_store_sk#16110], [s_store_sk#16154], Inner
         :                                      :- Sort [ss_store_sk#16110 ASC NULLS FIRST], false, 0
         :                                      :  +- Exchange hashpartitioning(ss_store_sk#16110, 200), ENSURE_REQUIREMENTS, [id=#286140]
         :                                      :     +- Project [ss_store_sk#16110, ss_sales_price#16116, d_year#16132, d_moy#16134, i_brand#16089, i_category#16093]
         :                                      :        +- SortMergeJoin [ss_item_sk#16105], [i_item_sk#16081], Inner
         :                                      :           :- Sort [ss_item_sk#16105 ASC NULLS FIRST], false, 0
         :                                      :           :  +- Exchange hashpartitioning(ss_item_sk#16105, 200), ENSURE_REQUIREMENTS, [id=#286132]
         :                                      :           :     +- Project [ss_item_sk#16105, ss_store_sk#16110, ss_sales_price#16116, d_year#16132, d_moy#16134]
         :                                      :           :        +- SortMergeJoin [ss_sold_date_sk#16103], [d_date_sk#16126], Inner
         :                                      :           :           :- Sort [ss_sold_date_sk#16103 ASC NULLS FIRST], false, 0
         :                                      :           :           :  +- Exchange hashpartitioning(ss_sold_date_sk#16103, 200), ENSURE_REQUIREMENTS, [id=#286124]
         :                                      :           :           :     +- Filter ((isnotnull(ss_sold_date_sk#16103) AND isnotnull(ss_item_sk#16105)) AND isnotnull(ss_store_sk#16110))
         :                                      :           :           :        +- FileScan parquet [ss_sold_date_sk#16103,ss_item_sk#16105,ss_store_sk#16110,ss_sales_price#16116] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#16103), isnotnull(ss_item_sk#16105), isnotnull(ss_store_sk#16110)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk), IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
         :                                      :           :           +- Sort [d_date_sk#16126 ASC NULLS FIRST], false, 0
         :                                      :           :              +- Exchange hashpartitioning(d_date_sk#16126, 200), ENSURE_REQUIREMENTS, [id=#286125]
         :                                      :           :                 +- Filter ((((d_year#16132 = 2000) OR ((d_year#16132 = 1999) AND (d_moy#16134 = 12))) OR ((d_year#16132 = 2001) AND (d_moy#16134 = 1))) AND isnotnull(d_date_sk#16126))
         :                                      :           :                    +- FileScan parquet [d_date_sk#16126,d_year#16132,d_moy#16134] Batched: true, DataFilters: [(((d_year#16132 = 2000) OR ((d_year#16132 = 1999) AND (d_moy#16134 = 12))) OR ((d_year#16132 = 2..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
         :                                      :           +- Sort [i_item_sk#16081 ASC NULLS FIRST], false, 0
         :                                      :              +- Exchange hashpartitioning(i_item_sk#16081, 200), ENSURE_REQUIREMENTS, [id=#286133]
         :                                      :                 +- Filter ((isnotnull(i_item_sk#16081) AND isnotnull(i_category#16093)) AND isnotnull(i_brand#16089))
         :                                      :                    +- FileScan parquet [i_item_sk#16081,i_brand#16089,i_category#16093] Batched: true, DataFilters: [isnotnull(i_item_sk#16081), isnotnull(i_category#16093), isnotnull(i_brand#16089)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
         :                                      +- Sort [s_store_sk#16154 ASC NULLS FIRST], false, 0
         :                                         +- Exchange hashpartitioning(s_store_sk#16154, 200), ENSURE_REQUIREMENTS, [id=#286141]
         :                                            +- Filter ((isnotnull(s_store_sk#16154) AND isnotnull(s_store_name#16159)) AND isnotnull(s_company_name#16171))
         :                                               +- FileScan parquet [s_store_sk#16154,s_store_name#16159,s_company_name#16171] Batched: true, DataFilters: [isnotnull(s_store_sk#16154), isnotnull(s_store_name#16159), isnotnull(s_company_name#16171)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
         +- Sort [i_category#16200 ASC NULLS FIRST, i_brand#16196 ASC NULLS FIRST, s_store_name#16266 ASC NULLS FIRST, s_company_name#16278 ASC NULLS FIRST, (rn#16294 - 1) ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, (rn#16294 - 1), 200), ENSURE_REQUIREMENTS, [id=#286197]
               +- Project [i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, sum_sales#16036 AS sum_sales#16066, rn#16294]
                  +- Window [rank(d_year#16239, d_moy#16241) windowspecdefinition(i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, d_year#16239 ASC NULLS FIRST, d_moy#16241 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#16294], [i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278], [d_year#16239 ASC NULLS FIRST, d_moy#16241 ASC NULLS FIRST]
                     +- Sort [i_category#16200 ASC NULLS FIRST, i_brand#16196 ASC NULLS FIRST, s_store_name#16266 ASC NULLS FIRST, s_company_name#16278 ASC NULLS FIRST, d_year#16239 ASC NULLS FIRST, d_moy#16241 ASC NULLS FIRST], false, 0
                        +- Exchange hashpartitioning(i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, 200), ENSURE_REQUIREMENTS, [id=#286191]
                           +- HashAggregate(keys=[i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, d_year#16239, d_moy#16241], functions=[sum(UnscaledValue(ss_sales_price#16223))], output=[i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, d_year#16239, d_moy#16241, sum_sales#16036])
                              +- Exchange hashpartitioning(i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, d_year#16239, d_moy#16241, 200), ENSURE_REQUIREMENTS, [id=#286188]
                                 +- HashAggregate(keys=[i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, d_year#16239, d_moy#16241], functions=[partial_sum(UnscaledValue(ss_sales_price#16223))], output=[i_category#16200, i_brand#16196, s_store_name#16266, s_company_name#16278, d_year#16239, d_moy#16241, sum#16300L])
                                    +- Project [ss_sales_price#16223, d_year#16239, d_moy#16241, i_brand#16196, i_category#16200, s_store_name#16266, s_company_name#16278]
                                       +- SortMergeJoin [ss_store_sk#16217], [s_store_sk#16261], Inner
                                          :- Sort [ss_store_sk#16217 ASC NULLS FIRST], false, 0
                                          :  +- Exchange hashpartitioning(ss_store_sk#16217, 200), ENSURE_REQUIREMENTS, [id=#286180]
                                          :     +- Project [ss_store_sk#16217, ss_sales_price#16223, d_year#16239, d_moy#16241, i_brand#16196, i_category#16200]
                                          :        +- SortMergeJoin [ss_item_sk#16212], [i_item_sk#16188], Inner
                                          :           :- Sort [ss_item_sk#16212 ASC NULLS FIRST], false, 0
                                          :           :  +- Exchange hashpartitioning(ss_item_sk#16212, 200), ENSURE_REQUIREMENTS, [id=#286172]
                                          :           :     +- Project [ss_item_sk#16212, ss_store_sk#16217, ss_sales_price#16223, d_year#16239, d_moy#16241]
                                          :           :        +- SortMergeJoin [ss_sold_date_sk#16210], [d_date_sk#16233], Inner
                                          :           :           :- Sort [ss_sold_date_sk#16210 ASC NULLS FIRST], false, 0
                                          :           :           :  +- Exchange hashpartitioning(ss_sold_date_sk#16210, 200), ENSURE_REQUIREMENTS, [id=#286164]
                                          :           :           :     +- Filter ((isnotnull(ss_sold_date_sk#16210) AND isnotnull(ss_item_sk#16212)) AND isnotnull(ss_store_sk#16217))
                                          :           :           :        +- FileScan parquet [ss_sold_date_sk#16210,ss_item_sk#16212,ss_store_sk#16217,ss_sales_price#16223] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#16210), isnotnull(ss_item_sk#16212), isnotnull(ss_store_sk#16217)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk), IsNotNull(ss_item_sk), IsNotNull(ss_store_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_store_sk:int,ss_sales_price:decimal(7,2)>
                                          :           :           +- Sort [d_date_sk#16233 ASC NULLS FIRST], false, 0
                                          :           :              +- Exchange hashpartitioning(d_date_sk#16233, 200), ENSURE_REQUIREMENTS, [id=#286165]
                                          :           :                 +- Filter ((((d_year#16239 = 2000) OR ((d_year#16239 = 1999) AND (d_moy#16241 = 12))) OR ((d_year#16239 = 2001) AND (d_moy#16241 = 1))) AND isnotnull(d_date_sk#16233))
                                          :           :                    +- FileScan parquet [d_date_sk#16233,d_year#16239,d_moy#16241] Batched: true, DataFilters: [(((d_year#16239 = 2000) OR ((d_year#16239 = 1999) AND (d_moy#16241 = 12))) OR ((d_year#16239 = 2..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [Or(Or(EqualTo(d_year,2000),And(EqualTo(d_year,1999),EqualTo(d_moy,12))),And(EqualTo(d_year,2001)..., ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
                                          :           +- Sort [i_item_sk#16188 ASC NULLS FIRST], false, 0
                                          :              +- Exchange hashpartitioning(i_item_sk#16188, 200), ENSURE_REQUIREMENTS, [id=#286173]
                                          :                 +- Filter ((isnotnull(i_item_sk#16188) AND isnotnull(i_category#16200)) AND isnotnull(i_brand#16196))
                                          :                    +- FileScan parquet [i_item_sk#16188,i_brand#16196,i_category#16200] Batched: true, DataFilters: [isnotnull(i_item_sk#16188), isnotnull(i_category#16200), isnotnull(i_brand#16196)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/item.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_category), IsNotNull(i_brand)], ReadSchema: struct<i_item_sk:int,i_brand:string,i_category:string>
                                          +- Sort [s_store_sk#16261 ASC NULLS FIRST], false, 0
                                             +- Exchange hashpartitioning(s_store_sk#16261, 200), ENSURE_REQUIREMENTS, [id=#286181]
                                                +- Filter ((isnotnull(s_store_sk#16261) AND isnotnull(s_store_name#16266)) AND isnotnull(s_company_name#16278))
                                                   +- FileScan parquet [s_store_sk#16261,s_store_name#16266,s_company_name#16278] Batched: true, DataFilters: [isnotnull(s_store_sk#16261), isnotnull(s_store_name#16266), isnotnull(s_company_name#16278)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_store_sk), IsNotNull(s_store_name), IsNotNull(s_company_name)], ReadSchema: struct<s_store_sk:int,s_store_name:string,s_company_name:string>
