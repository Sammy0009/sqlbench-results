AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   GpuColumnarToRow false
   +- GpuTopN(limit=100, orderBy=[channel#16657 ASC NULLS FIRST,return_rank#16655 ASC NULLS FIRST,currency_rank#16656 ASC NULLS FIRST,item#16652 ASC NULLS FIRST], output=[channel#16657,item#16652,return_ratio#16653,return_rank#16655,currency_rank#16656])
      +- GpuHashAggregate(keys=[channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656], functions=[], output=[channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656])
         +- GpuShuffleCoalesce 2147483647
            +- GpuCustomShuffleReader coalesced
               +- ShuffleQueryStage 20
                  +- GpuColumnarExchange gpuhashpartitioning(channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656, 200), ENSURE_REQUIREMENTS, [id=#302336]
                     +- GpuHashAggregate(keys=[channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656], functions=[], output=[channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656])
                        +- GpuUnion
                           :- GpuProject [web AS channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656], true
                           :  +- GpuCoalesceBatches targetsize(2147483647)
                           :     +- GpuFilter ((return_rank#16655 <= 10) OR (currency_rank#16656 <= 10)), true
                           :        +- GpuRunningWindow [item#16652, return_ratio#16653, currency_ratio#16654, return_rank#16655, gpurank(currency_ratio#16654) gpuwindowspecdefinition(currency_ratio#16654 ASC NULLS FIRST, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(currentrow$()))) AS currency_rank#16656], [currency_ratio#16654 ASC NULLS FIRST]
                           :           +- GpuSort [currency_ratio#16654 ASC NULLS FIRST], false, com.nvidia.spark.rapids.OutOfCoreSort$@59d99269
                           :              +- GpuRunningWindow [item#16652, return_ratio#16653, currency_ratio#16654, gpurank(return_ratio#16653) gpuwindowspecdefinition(return_ratio#16653 ASC NULLS FIRST, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(currentrow$()))) AS return_rank#16655], [return_ratio#16653 ASC NULLS FIRST]
                           :                 +- GpuSort [return_ratio#16653 ASC NULLS FIRST], false, com.nvidia.spark.rapids.OutOfCoreSort$@59d99269
                           :                    +- GpuRowToColumnar targetsize(2147483647)
                           :                       +- ShuffleQueryStage 17
                           :                          +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#301241]
                           :                             +- *(4) HashAggregate(keys=[ws_item_sk#479], functions=[sum(coalesce(wr_return_quantity#312, 0)), sum(coalesce(ws_quantity#494, 0)), sum(coalesce(cast(wr_return_amt#313 as decimal(12,2)), 0.00)), sum(coalesce(cast(ws_net_paid#505 as decimal(12,2)), 0.00))], output=[item#16652, return_ratio#16653, currency_ratio#16654])
                           :                                +- AQEShuffleRead coalesced
                           :                                   +- ShuffleQueryStage 14
                           :                                      +- Exchange hashpartitioning(ws_item_sk#479, 200), ENSURE_REQUIREMENTS, [id=#300311]
                           :                                         +- *(1) HashAggregate(keys=[ws_item_sk#479], functions=[partial_sum(coalesce(wr_return_quantity#312, 0)), partial_sum(coalesce(ws_quantity#494, 0)), partial_sum(coalesce(cast(wr_return_amt#313 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(ws_net_paid#505 as decimal(12,2)), 0.00))], output=[ws_item_sk#479, sum#16833L, sum#16834L, sum#16835, isEmpty#16836, sum#16837, isEmpty#16838])
                           :                                            +- GpuColumnarToRow false
                           :                                               +- GpuProject [ws_item_sk#479, ws_quantity#494, ws_net_paid#505, wr_return_quantity#312, wr_return_amt#313], true
                           :                                                  +- GpuShuffledHashJoin [ws_item_sk#479, ws_order_number#493L], [wr_item_sk#300, wr_order_number#311L], Inner, GpuBuildRight, false
                           :                                                     :- GpuShuffleCoalesce 2147483647
                           :                                                     :  +- GpuCustomShuffleReader coalesced
                           :                                                     :     +- ShuffleQueryStage 11
                           :                                                     :        +- GpuColumnarExchange gpuhashpartitioning(ws_item_sk#479, ws_order_number#493L, 200), ENSURE_REQUIREMENTS, [id=#297993]
                           :                                                     :           +- GpuProject [ws_item_sk#479, ws_order_number#493L, ws_quantity#494, ws_net_paid#505], true
                           :                                                     :              +- GpuShuffledHashJoin [ws_sold_date_sk#476], [d_date_sk#612], Inner, GpuBuildRight, false
                           :                                                     :                 :- GpuShuffleCoalesce 2147483647
                           :                                                     :                 :  +- GpuCustomShuffleReader coalesced
                           :                                                     :                 :     +- ShuffleQueryStage 0
                           :                                                     :                 :        +- GpuColumnarExchange gpuhashpartitioning(ws_sold_date_sk#476, 200), ENSURE_REQUIREMENTS, [id=#296696]
                           :                                                     :                 :           +- GpuProject [ws_sold_date_sk#476, ws_item_sk#479, ws_order_number#493L, ws_quantity#494, ws_net_paid#505], true
                           :                                                     :                 :              +- GpuCoalesceBatches targetsize(2147483647)
                           :                                                     :                 :                 +- GpuFilter ((((((((gpuisnotnull(ws_net_profit#509) AND gpuisnotnull(ws_net_paid#505)) AND gpuisnotnull(ws_quantity#494)) AND (ws_net_profit#509 > 1.00)) AND (ws_net_paid#505 > 0.00)) AND (ws_quantity#494 > 0)) AND gpuisnotnull(ws_sold_date_sk#476)) AND gpuisnotnull(ws_item_sk#479)) AND gpuisnotnull(ws_order_number#493L)), true
                           :                                                     :                 :                    +- GpuFileGpuScan parquet [ws_sold_date_sk#476,ws_item_sk#479,ws_order_number#493L,ws_quantity#494,ws_net_paid#505,ws_net_profit#509] Batched: true, DataFilters: [isnotnull(ws_net_profit#509), isnotnull(ws_net_paid#505), isnotnull(ws_quantity#494), (ws_net_pr..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_net_profit), IsNotNull(ws_net_paid), IsNotNull(ws_quantity), GreaterThan(ws_net_pro..., ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_order_number:bigint,ws_quantity:int,ws_net_paid:deci...
                           :                                                     :                 +- GpuCustomShuffleReader coalesced
                           :                                                     :                    +- ShuffleQueryStage 1
                           :                                                     :                       +- GpuColumnarExchange gpuhashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#296735]
                           :                                                     :                          +- GpuProject [d_date_sk#612], true
                           :                                                     :                             +- GpuCoalesceBatches targetsize(2147483647)
                           :                                                     :                                +- GpuFilter ((((gpuisnotnull(d_year#618) AND gpuisnotnull(d_moy#620)) AND (d_year#618 = 2000)) AND (d_moy#620 = 11)) AND gpuisnotnull(d_date_sk#612)), true
                           :                                                     :                                   +- GpuFileGpuScan parquet [d_date_sk#612,d_year#618,d_moy#620] Batched: true, DataFilters: [isnotnull(d_year#618), isnotnull(d_moy#620), (d_year#618 = 2000), (d_moy#620 = 11), isnotnull(d_..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
                           :                                                     +- GpuCustomShuffleReader coalesced
                           :                                                        +- ShuffleQueryStage 2
                           :                                                           +- GpuColumnarExchange gpuhashpartitioning(wr_item_sk#300, wr_order_number#311L, 200), ENSURE_REQUIREMENTS, [id=#296769]
                           :                                                              +- GpuCoalesceBatches targetsize(2147483647)
                           :                                                                 +- GpuFilter (((gpuisnotnull(wr_return_amt#313) AND (wr_return_amt#313 > 10000.00)) AND gpuisnotnull(wr_item_sk#300)) AND gpuisnotnull(wr_order_number#311L)), true
                           :                                                                    +- GpuFileGpuScan parquet [wr_item_sk#300,wr_order_number#311L,wr_return_quantity#312,wr_return_amt#313] Batched: true, DataFilters: [isnotnull(wr_return_amt#313), (wr_return_amt#313 > 10000.00), isnotnull(wr_item_sk#300), isnotnu..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/web_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(wr_return_amt), GreaterThan(wr_return_amt,10000.00), IsNotNull(wr_item_sk), IsNotNull(..., ReadSchema: struct<wr_item_sk:int,wr_order_number:bigint,wr_return_quantity:int,wr_return_amt:decimal(7,2)>
                           :- GpuProject [catalog AS channel#16663, item#16658, return_ratio#16659, return_rank#16661, currency_rank#16662], true
                           :  +- GpuCoalesceBatches targetsize(2147483647)
                           :     +- GpuFilter ((return_rank#16661 <= 10) OR (currency_rank#16662 <= 10)), true
                           :        +- GpuRunningWindow [item#16658, return_ratio#16659, currency_ratio#16660, return_rank#16661, gpurank(currency_ratio#16660) gpuwindowspecdefinition(currency_ratio#16660 ASC NULLS FIRST, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(currentrow$()))) AS currency_rank#16662], [currency_ratio#16660 ASC NULLS FIRST]
                           :           +- GpuSort [currency_ratio#16660 ASC NULLS FIRST], false, com.nvidia.spark.rapids.OutOfCoreSort$@59d99269
                           :              +- GpuRunningWindow [item#16658, return_ratio#16659, currency_ratio#16660, gpurank(return_ratio#16659) gpuwindowspecdefinition(return_ratio#16659 ASC NULLS FIRST, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(currentrow$()))) AS return_rank#16661], [return_ratio#16659 ASC NULLS FIRST]
                           :                 +- GpuSort [return_ratio#16659 ASC NULLS FIRST], false, com.nvidia.spark.rapids.OutOfCoreSort$@59d99269
                           :                    +- GpuRowToColumnar targetsize(2147483647)
                           :                       +- ShuffleQueryStage 18
                           :                          +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#301456]
                           :                             +- *(5) HashAggregate(keys=[cs_item_sk#559], functions=[sum(coalesce(cr_return_quantity#363, 0)), sum(coalesce(cs_quantity#562, 0)), sum(coalesce(cast(cr_return_amount#364 as decimal(12,2)), 0.00)), sum(coalesce(cast(cs_net_paid#573 as decimal(12,2)), 0.00))], output=[item#16658, return_ratio#16659, currency_ratio#16660])
                           :                                +- AQEShuffleRead coalesced
                           :                                   +- ShuffleQueryStage 15
                           :                                      +- Exchange hashpartitioning(cs_item_sk#559, 200), ENSURE_REQUIREMENTS, [id=#300681]
                           :                                         +- *(2) HashAggregate(keys=[cs_item_sk#559], functions=[partial_sum(coalesce(cr_return_quantity#363, 0)), partial_sum(coalesce(cs_quantity#562, 0)), partial_sum(coalesce(cast(cr_return_amount#364 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(cs_net_paid#573 as decimal(12,2)), 0.00))], output=[cs_item_sk#559, sum#16845L, sum#16846L, sum#16847, isEmpty#16848, sum#16849, isEmpty#16850])
                           :                                            +- GpuColumnarToRow false
                           :                                               +- GpuProject [cs_item_sk#559, cs_quantity#562, cs_net_paid#573, cr_return_quantity#363, cr_return_amount#364], true
                           :                                                  +- GpuShuffledHashJoin [cs_item_sk#559, cs_order_number#561L], [cr_item_sk#348, cr_order_number#362L], Inner, GpuBuildRight, false
                           :                                                     :- GpuShuffleCoalesce 2147483647
                           :                                                     :  +- GpuCustomShuffleReader coalesced
                           :                                                     :     +- ShuffleQueryStage 12
                           :                                                     :        +- GpuColumnarExchange gpuhashpartitioning(cs_item_sk#559, cs_order_number#561L, 200), ENSURE_REQUIREMENTS, [id=#298821]
                           :                                                     :           +- GpuProject [cs_item_sk#559, cs_order_number#561L, cs_quantity#562, cs_net_paid#573], true
                           :                                                     :              +- GpuShuffledHashJoin [cs_sold_date_sk#544], [d_date_sk#16670], Inner, GpuBuildRight, false
                           :                                                     :                 :- GpuShuffleCoalesce 2147483647
                           :                                                     :                 :  +- GpuCustomShuffleReader coalesced
                           :                                                     :                 :     +- ShuffleQueryStage 3
                           :                                                     :                 :        +- GpuColumnarExchange gpuhashpartitioning(cs_sold_date_sk#544, 200), ENSURE_REQUIREMENTS, [id=#296818]
                           :                                                     :                 :           +- GpuProject [cs_sold_date_sk#544, cs_item_sk#559, cs_order_number#561L, cs_quantity#562, cs_net_paid#573], true
                           :                                                     :                 :              +- GpuCoalesceBatches targetsize(2147483647)
                           :                                                     :                 :                 +- GpuFilter ((((((((gpuisnotnull(cs_net_profit#577) AND gpuisnotnull(cs_net_paid#573)) AND gpuisnotnull(cs_quantity#562)) AND (cs_net_profit#577 > 1.00)) AND (cs_net_paid#573 > 0.00)) AND (cs_quantity#562 > 0)) AND gpuisnotnull(cs_sold_date_sk#544)) AND gpuisnotnull(cs_item_sk#559)) AND gpuisnotnull(cs_order_number#561L)), true
                           :                                                     :                 :                    +- GpuFileGpuScan parquet [cs_sold_date_sk#544,cs_item_sk#559,cs_order_number#561L,cs_quantity#562,cs_net_paid#573,cs_net_profit#577] Batched: true, DataFilters: [isnotnull(cs_net_profit#577), isnotnull(cs_net_paid#573), isnotnull(cs_quantity#562), (cs_net_pr..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cs_net_profit), IsNotNull(cs_net_paid), IsNotNull(cs_quantity), GreaterThan(cs_net_pro..., ReadSchema: struct<cs_sold_date_sk:int,cs_item_sk:int,cs_order_number:bigint,cs_quantity:int,cs_net_paid:deci...
                           :                                                     :                 +- GpuCustomShuffleReader coalesced
                           :                                                     :                    +- ShuffleQueryStage 5
                           :                                                     :                       +- ReusedExchange [d_date_sk#16670], GpuColumnarExchange gpuhashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#296735]
                           :                                                     +- GpuCustomShuffleReader coalesced
                           :                                                        +- ShuffleQueryStage 6
                           :                                                           +- GpuColumnarExchange gpuhashpartitioning(cr_item_sk#348, cr_order_number#362L, 200), ENSURE_REQUIREMENTS, [id=#296893]
                           :                                                              +- GpuCoalesceBatches targetsize(2147483647)
                           :                                                                 +- GpuFilter (((gpuisnotnull(cr_return_amount#364) AND (cr_return_amount#364 > 10000.00)) AND gpuisnotnull(cr_item_sk#348)) AND gpuisnotnull(cr_order_number#362L)), true
                           :                                                                    +- GpuFileGpuScan parquet [cr_item_sk#348,cr_order_number#362L,cr_return_quantity#363,cr_return_amount#364] Batched: true, DataFilters: [isnotnull(cr_return_amount#364), (cr_return_amount#364 > 10000.00), isnotnull(cr_item_sk#348), i..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cr_return_amount), GreaterThan(cr_return_amount,10000.00), IsNotNull(cr_item_sk), IsNo..., ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint,cr_return_quantity:int,cr_return_amount:decimal(7,2)>
                           +- GpuProject [store AS channel#16669, item#16664, return_ratio#16665, return_rank#16667, currency_rank#16668], true
                              +- GpuCoalesceBatches targetsize(2147483647)
                                 +- GpuFilter ((return_rank#16667 <= 10) OR (currency_rank#16668 <= 10)), true
                                    +- GpuRunningWindow [item#16664, return_ratio#16665, currency_ratio#16666, return_rank#16667, gpurank(currency_ratio#16666) gpuwindowspecdefinition(currency_ratio#16666 ASC NULLS FIRST, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(currentrow$()))) AS currency_rank#16668], [currency_ratio#16666 ASC NULLS FIRST]
                                       +- GpuSort [currency_ratio#16666 ASC NULLS FIRST], false, com.nvidia.spark.rapids.OutOfCoreSort$@59d99269
                                          +- GpuRunningWindow [item#16664, return_ratio#16665, currency_ratio#16666, gpurank(return_ratio#16665) gpuwindowspecdefinition(return_ratio#16665 ASC NULLS FIRST, gpuspecifiedwindowframe(RowFrame, gpuspecialframeboundary(unboundedpreceding$()), gpuspecialframeboundary(currentrow$()))) AS return_rank#16667], [return_ratio#16665 ASC NULLS FIRST]
                                             +- GpuSort [return_ratio#16665 ASC NULLS FIRST], false, com.nvidia.spark.rapids.OutOfCoreSort$@59d99269
                                                +- GpuRowToColumnar targetsize(2147483647)
                                                   +- ShuffleQueryStage 19
                                                      +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#301826]
                                                         +- *(6) HashAggregate(keys=[ss_item_sk#254], functions=[sum(coalesce(sr_return_quantity#146, 0)), sum(coalesce(ss_quantity#262, 0)), sum(coalesce(cast(sr_return_amt#147 as decimal(12,2)), 0.00)), sum(coalesce(cast(ss_net_paid#272 as decimal(12,2)), 0.00))], output=[item#16664, return_ratio#16665, currency_ratio#16666])
                                                            +- AQEShuffleRead coalesced
                                                               +- ShuffleQueryStage 16
                                                                  +- Exchange hashpartitioning(ss_item_sk#254, 200), ENSURE_REQUIREMENTS, [id=#301008]
                                                                     +- *(3) HashAggregate(keys=[ss_item_sk#254], functions=[partial_sum(coalesce(sr_return_quantity#146, 0)), partial_sum(coalesce(ss_quantity#262, 0)), partial_sum(coalesce(cast(sr_return_amt#147 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(ss_net_paid#272 as decimal(12,2)), 0.00))], output=[ss_item_sk#254, sum#16857L, sum#16858L, sum#16859, isEmpty#16860, sum#16861, isEmpty#16862])
                                                                        +- GpuColumnarToRow false
                                                                           +- GpuProject [ss_item_sk#254, ss_quantity#262, ss_net_paid#272, sr_return_quantity#146, sr_return_amt#147], true
                                                                              +- GpuShuffledHashJoin [ss_ticket_number#261L, ss_item_sk#254], [sr_ticket_number#145L, sr_item_sk#138], Inner, GpuBuildRight, false
                                                                                 :- GpuShuffleCoalesce 2147483647
                                                                                 :  +- GpuCustomShuffleReader coalesced
                                                                                 :     +- ShuffleQueryStage 13
                                                                                 :        +- GpuColumnarExchange gpuhashpartitioning(ss_ticket_number#261L, ss_item_sk#254, 200), ENSURE_REQUIREMENTS, [id=#299589]
                                                                                 :           +- GpuProject [ss_item_sk#254, ss_ticket_number#261L, ss_quantity#262, ss_net_paid#272], true
                                                                                 :              +- GpuShuffledHashJoin [ss_sold_date_sk#252], [d_date_sk#16698], Inner, GpuBuildRight, false
                                                                                 :                 :- GpuShuffleCoalesce 2147483647
                                                                                 :                 :  +- GpuCustomShuffleReader coalesced
                                                                                 :                 :     +- ShuffleQueryStage 7
                                                                                 :                 :        +- GpuColumnarExchange gpuhashpartitioning(ss_sold_date_sk#252, 200), ENSURE_REQUIREMENTS, [id=#296942]
                                                                                 :                 :           +- GpuProject [ss_sold_date_sk#252, ss_item_sk#254, ss_ticket_number#261L, ss_quantity#262, ss_net_paid#272], true
                                                                                 :                 :              +- GpuCoalesceBatches targetsize(2147483647)
                                                                                 :                 :                 +- GpuFilter ((((((((gpuisnotnull(ss_net_profit#274) AND gpuisnotnull(ss_net_paid#272)) AND gpuisnotnull(ss_quantity#262)) AND (ss_net_profit#274 > 1.00)) AND (ss_net_paid#272 > 0.00)) AND (ss_quantity#262 > 0)) AND gpuisnotnull(ss_sold_date_sk#252)) AND gpuisnotnull(ss_ticket_number#261L)) AND gpuisnotnull(ss_item_sk#254)), true
                                                                                 :                 :                    +- GpuFileGpuScan parquet [ss_sold_date_sk#252,ss_item_sk#254,ss_ticket_number#261L,ss_quantity#262,ss_net_paid#272,ss_net_profit#274] Batched: true, DataFilters: [isnotnull(ss_net_profit#274), isnotnull(ss_net_paid#272), isnotnull(ss_quantity#262), (ss_net_pr..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_net_profit), IsNotNull(ss_net_paid), IsNotNull(ss_quantity), GreaterThan(ss_net_pro..., ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_ticket_number:bigint,ss_quantity:int,ss_net_paid:dec...
                                                                                 :                 +- GpuCustomShuffleReader coalesced
                                                                                 :                    +- ShuffleQueryStage 9
                                                                                 :                       +- ReusedExchange [d_date_sk#16698], GpuColumnarExchange gpuhashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#296735]
                                                                                 +- GpuCustomShuffleReader coalesced
                                                                                    +- ShuffleQueryStage 10
                                                                                       +- GpuColumnarExchange gpuhashpartitioning(sr_ticket_number#145L, sr_item_sk#138, 200), ENSURE_REQUIREMENTS, [id=#297017]
                                                                                          +- GpuCoalesceBatches targetsize(2147483647)
                                                                                             +- GpuFilter (((gpuisnotnull(sr_return_amt#147) AND (sr_return_amt#147 > 10000.00)) AND gpuisnotnull(sr_ticket_number#145L)) AND gpuisnotnull(sr_item_sk#138)), true
                                                                                                +- GpuFileGpuScan parquet [sr_item_sk#138,sr_ticket_number#145L,sr_return_quantity#146,sr_return_amt#147] Batched: true, DataFilters: [isnotnull(sr_return_amt#147), (sr_return_amt#147 > 10000.00), isnotnull(sr_ticket_number#145L), ..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/store_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sr_return_amt), GreaterThan(sr_return_amt,10000.00), IsNotNull(sr_ticket_number), IsNo..., ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint,sr_return_quantity:int,sr_return_amt:decimal(7,2)>
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[channel#16657 ASC NULLS FIRST,return_rank#16655 ASC NULLS FIRST,currency_rank#16656 ASC NULLS FIRST,item#16652 ASC NULLS FIRST], output=[channel#16657,item#16652,return_ratio#16653,return_rank#16655,currency_rank#16656])
   +- HashAggregate(keys=[channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656], functions=[], output=[channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656])
      +- Exchange hashpartitioning(channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656, 200), ENSURE_REQUIREMENTS, [id=#295434]
         +- HashAggregate(keys=[channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656], functions=[], output=[channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656])
            +- Union
               :- Project [web AS channel#16657, item#16652, return_ratio#16653, return_rank#16655, currency_rank#16656]
               :  +- Filter ((return_rank#16655 <= 10) OR (currency_rank#16656 <= 10))
               :     +- Window [rank(currency_ratio#16654) windowspecdefinition(currency_ratio#16654 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#16656], [currency_ratio#16654 ASC NULLS FIRST]
               :        +- Sort [currency_ratio#16654 ASC NULLS FIRST], false, 0
               :           +- Window [rank(return_ratio#16653) windowspecdefinition(return_ratio#16653 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#16655], [return_ratio#16653 ASC NULLS FIRST]
               :              +- Sort [return_ratio#16653 ASC NULLS FIRST], false, 0
               :                 +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#295367]
               :                    +- HashAggregate(keys=[ws_item_sk#479], functions=[sum(coalesce(wr_return_quantity#312, 0)), sum(coalesce(ws_quantity#494, 0)), sum(coalesce(cast(wr_return_amt#313 as decimal(12,2)), 0.00)), sum(coalesce(cast(ws_net_paid#505 as decimal(12,2)), 0.00))], output=[item#16652, return_ratio#16653, currency_ratio#16654])
               :                       +- Exchange hashpartitioning(ws_item_sk#479, 200), ENSURE_REQUIREMENTS, [id=#295364]
               :                          +- HashAggregate(keys=[ws_item_sk#479], functions=[partial_sum(coalesce(wr_return_quantity#312, 0)), partial_sum(coalesce(ws_quantity#494, 0)), partial_sum(coalesce(cast(wr_return_amt#313 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(ws_net_paid#505 as decimal(12,2)), 0.00))], output=[ws_item_sk#479, sum#16833L, sum#16834L, sum#16835, isEmpty#16836, sum#16837, isEmpty#16838])
               :                             +- Project [ws_item_sk#479, ws_quantity#494, ws_net_paid#505, wr_return_quantity#312, wr_return_amt#313]
               :                                +- SortMergeJoin [ws_item_sk#479, ws_order_number#493L], [wr_item_sk#300, wr_order_number#311L], Inner
               :                                   :- Sort [ws_item_sk#479 ASC NULLS FIRST, ws_order_number#493L ASC NULLS FIRST], false, 0
               :                                   :  +- Exchange hashpartitioning(ws_item_sk#479, ws_order_number#493L, 200), ENSURE_REQUIREMENTS, [id=#295356]
               :                                   :     +- Project [ws_item_sk#479, ws_order_number#493L, ws_quantity#494, ws_net_paid#505]
               :                                   :        +- SortMergeJoin [ws_sold_date_sk#476], [d_date_sk#612], Inner
               :                                   :           :- Sort [ws_sold_date_sk#476 ASC NULLS FIRST], false, 0
               :                                   :           :  +- Exchange hashpartitioning(ws_sold_date_sk#476, 200), ENSURE_REQUIREMENTS, [id=#295348]
               :                                   :           :     +- Project [ws_sold_date_sk#476, ws_item_sk#479, ws_order_number#493L, ws_quantity#494, ws_net_paid#505]
               :                                   :           :        +- Filter ((((((((isnotnull(ws_net_profit#509) AND isnotnull(ws_net_paid#505)) AND isnotnull(ws_quantity#494)) AND (ws_net_profit#509 > 1.00)) AND (ws_net_paid#505 > 0.00)) AND (ws_quantity#494 > 0)) AND isnotnull(ws_sold_date_sk#476)) AND isnotnull(ws_item_sk#479)) AND isnotnull(ws_order_number#493L))
               :                                   :           :           +- FileScan parquet [ws_sold_date_sk#476,ws_item_sk#479,ws_order_number#493L,ws_quantity#494,ws_net_paid#505,ws_net_profit#509] Batched: true, DataFilters: [isnotnull(ws_net_profit#509), isnotnull(ws_net_paid#505), isnotnull(ws_quantity#494), (ws_net_pr..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_net_profit), IsNotNull(ws_net_paid), IsNotNull(ws_quantity), GreaterThan(ws_net_pro..., ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_order_number:bigint,ws_quantity:int,ws_net_paid:deci...
               :                                   :           +- Sort [d_date_sk#612 ASC NULLS FIRST], false, 0
               :                                   :              +- Exchange hashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#295349]
               :                                   :                 +- Project [d_date_sk#612]
               :                                   :                    +- Filter ((((isnotnull(d_year#618) AND isnotnull(d_moy#620)) AND (d_year#618 = 2000)) AND (d_moy#620 = 11)) AND isnotnull(d_date_sk#612))
               :                                   :                       +- FileScan parquet [d_date_sk#612,d_year#618,d_moy#620] Batched: true, DataFilters: [isnotnull(d_year#618), isnotnull(d_moy#620), (d_year#618 = 2000), (d_moy#620 = 11), isnotnull(d_..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
               :                                   +- Sort [wr_item_sk#300 ASC NULLS FIRST, wr_order_number#311L ASC NULLS FIRST], false, 0
               :                                      +- Exchange hashpartitioning(wr_item_sk#300, wr_order_number#311L, 200), ENSURE_REQUIREMENTS, [id=#295357]
               :                                         +- Filter (((isnotnull(wr_return_amt#313) AND (wr_return_amt#313 > 10000.00)) AND isnotnull(wr_item_sk#300)) AND isnotnull(wr_order_number#311L))
               :                                            +- FileScan parquet [wr_item_sk#300,wr_order_number#311L,wr_return_quantity#312,wr_return_amt#313] Batched: true, DataFilters: [isnotnull(wr_return_amt#313), (wr_return_amt#313 > 10000.00), isnotnull(wr_item_sk#300), isnotnu..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(wr_return_amt), GreaterThan(wr_return_amt,10000.00), IsNotNull(wr_item_sk), IsNotNull(..., ReadSchema: struct<wr_item_sk:int,wr_order_number:bigint,wr_return_quantity:int,wr_return_amt:decimal(7,2)>
               :- Project [catalog AS channel#16663, item#16658, return_ratio#16659, return_rank#16661, currency_rank#16662]
               :  +- Filter ((return_rank#16661 <= 10) OR (currency_rank#16662 <= 10))
               :     +- Window [rank(currency_ratio#16660) windowspecdefinition(currency_ratio#16660 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#16662], [currency_ratio#16660 ASC NULLS FIRST]
               :        +- Sort [currency_ratio#16660 ASC NULLS FIRST], false, 0
               :           +- Window [rank(return_ratio#16659) windowspecdefinition(return_ratio#16659 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#16661], [return_ratio#16659 ASC NULLS FIRST]
               :              +- Sort [return_ratio#16659 ASC NULLS FIRST], false, 0
               :                 +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#295395]
               :                    +- HashAggregate(keys=[cs_item_sk#559], functions=[sum(coalesce(cr_return_quantity#363, 0)), sum(coalesce(cs_quantity#562, 0)), sum(coalesce(cast(cr_return_amount#364 as decimal(12,2)), 0.00)), sum(coalesce(cast(cs_net_paid#573 as decimal(12,2)), 0.00))], output=[item#16658, return_ratio#16659, currency_ratio#16660])
               :                       +- Exchange hashpartitioning(cs_item_sk#559, 200), ENSURE_REQUIREMENTS, [id=#295392]
               :                          +- HashAggregate(keys=[cs_item_sk#559], functions=[partial_sum(coalesce(cr_return_quantity#363, 0)), partial_sum(coalesce(cs_quantity#562, 0)), partial_sum(coalesce(cast(cr_return_amount#364 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(cs_net_paid#573 as decimal(12,2)), 0.00))], output=[cs_item_sk#559, sum#16845L, sum#16846L, sum#16847, isEmpty#16848, sum#16849, isEmpty#16850])
               :                             +- Project [cs_item_sk#559, cs_quantity#562, cs_net_paid#573, cr_return_quantity#363, cr_return_amount#364]
               :                                +- SortMergeJoin [cs_item_sk#559, cs_order_number#561L], [cr_item_sk#348, cr_order_number#362L], Inner
               :                                   :- Sort [cs_item_sk#559 ASC NULLS FIRST, cs_order_number#561L ASC NULLS FIRST], false, 0
               :                                   :  +- Exchange hashpartitioning(cs_item_sk#559, cs_order_number#561L, 200), ENSURE_REQUIREMENTS, [id=#295384]
               :                                   :     +- Project [cs_item_sk#559, cs_order_number#561L, cs_quantity#562, cs_net_paid#573]
               :                                   :        +- SortMergeJoin [cs_sold_date_sk#544], [d_date_sk#16670], Inner
               :                                   :           :- Sort [cs_sold_date_sk#544 ASC NULLS FIRST], false, 0
               :                                   :           :  +- Exchange hashpartitioning(cs_sold_date_sk#544, 200), ENSURE_REQUIREMENTS, [id=#295376]
               :                                   :           :     +- Project [cs_sold_date_sk#544, cs_item_sk#559, cs_order_number#561L, cs_quantity#562, cs_net_paid#573]
               :                                   :           :        +- Filter ((((((((isnotnull(cs_net_profit#577) AND isnotnull(cs_net_paid#573)) AND isnotnull(cs_quantity#562)) AND (cs_net_profit#577 > 1.00)) AND (cs_net_paid#573 > 0.00)) AND (cs_quantity#562 > 0)) AND isnotnull(cs_sold_date_sk#544)) AND isnotnull(cs_item_sk#559)) AND isnotnull(cs_order_number#561L))
               :                                   :           :           +- FileScan parquet [cs_sold_date_sk#544,cs_item_sk#559,cs_order_number#561L,cs_quantity#562,cs_net_paid#573,cs_net_profit#577] Batched: true, DataFilters: [isnotnull(cs_net_profit#577), isnotnull(cs_net_paid#573), isnotnull(cs_quantity#562), (cs_net_pr..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cs_net_profit), IsNotNull(cs_net_paid), IsNotNull(cs_quantity), GreaterThan(cs_net_pro..., ReadSchema: struct<cs_sold_date_sk:int,cs_item_sk:int,cs_order_number:bigint,cs_quantity:int,cs_net_paid:deci...
               :                                   :           +- Sort [d_date_sk#16670 ASC NULLS FIRST], false, 0
               :                                   :              +- Exchange hashpartitioning(d_date_sk#16670, 200), ENSURE_REQUIREMENTS, [id=#295377]
               :                                   :                 +- Project [d_date_sk#16670]
               :                                   :                    +- Filter ((((isnotnull(d_year#16676) AND isnotnull(d_moy#16678)) AND (d_year#16676 = 2000)) AND (d_moy#16678 = 11)) AND isnotnull(d_date_sk#16670))
               :                                   :                       +- FileScan parquet [d_date_sk#16670,d_year#16676,d_moy#16678] Batched: true, DataFilters: [isnotnull(d_year#16676), isnotnull(d_moy#16678), (d_year#16676 = 2000), (d_moy#16678 = 11), isno..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
               :                                   +- Sort [cr_item_sk#348 ASC NULLS FIRST, cr_order_number#362L ASC NULLS FIRST], false, 0
               :                                      +- Exchange hashpartitioning(cr_item_sk#348, cr_order_number#362L, 200), ENSURE_REQUIREMENTS, [id=#295385]
               :                                         +- Filter (((isnotnull(cr_return_amount#364) AND (cr_return_amount#364 > 10000.00)) AND isnotnull(cr_item_sk#348)) AND isnotnull(cr_order_number#362L))
               :                                            +- FileScan parquet [cr_item_sk#348,cr_order_number#362L,cr_return_quantity#363,cr_return_amount#364] Batched: true, DataFilters: [isnotnull(cr_return_amount#364), (cr_return_amount#364 > 10000.00), isnotnull(cr_item_sk#348), i..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cr_return_amount), GreaterThan(cr_return_amount,10000.00), IsNotNull(cr_item_sk), IsNo..., ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint,cr_return_quantity:int,cr_return_amount:decimal(7,2)>
               +- Project [store AS channel#16669, item#16664, return_ratio#16665, return_rank#16667, currency_rank#16668]
                  +- Filter ((return_rank#16667 <= 10) OR (currency_rank#16668 <= 10))
                     +- Window [rank(currency_ratio#16666) windowspecdefinition(currency_ratio#16666 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#16668], [currency_ratio#16666 ASC NULLS FIRST]
                        +- Sort [currency_ratio#16666 ASC NULLS FIRST], false, 0
                           +- Window [rank(return_ratio#16665) windowspecdefinition(return_ratio#16665 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#16667], [return_ratio#16665 ASC NULLS FIRST]
                              +- Sort [return_ratio#16665 ASC NULLS FIRST], false, 0
                                 +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#295423]
                                    +- HashAggregate(keys=[ss_item_sk#254], functions=[sum(coalesce(sr_return_quantity#146, 0)), sum(coalesce(ss_quantity#262, 0)), sum(coalesce(cast(sr_return_amt#147 as decimal(12,2)), 0.00)), sum(coalesce(cast(ss_net_paid#272 as decimal(12,2)), 0.00))], output=[item#16664, return_ratio#16665, currency_ratio#16666])
                                       +- Exchange hashpartitioning(ss_item_sk#254, 200), ENSURE_REQUIREMENTS, [id=#295420]
                                          +- HashAggregate(keys=[ss_item_sk#254], functions=[partial_sum(coalesce(sr_return_quantity#146, 0)), partial_sum(coalesce(ss_quantity#262, 0)), partial_sum(coalesce(cast(sr_return_amt#147 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(ss_net_paid#272 as decimal(12,2)), 0.00))], output=[ss_item_sk#254, sum#16857L, sum#16858L, sum#16859, isEmpty#16860, sum#16861, isEmpty#16862])
                                             +- Project [ss_item_sk#254, ss_quantity#262, ss_net_paid#272, sr_return_quantity#146, sr_return_amt#147]
                                                +- SortMergeJoin [ss_ticket_number#261L, ss_item_sk#254], [sr_ticket_number#145L, sr_item_sk#138], Inner
                                                   :- Sort [ss_ticket_number#261L ASC NULLS FIRST, ss_item_sk#254 ASC NULLS FIRST], false, 0
                                                   :  +- Exchange hashpartitioning(ss_ticket_number#261L, ss_item_sk#254, 200), ENSURE_REQUIREMENTS, [id=#295412]
                                                   :     +- Project [ss_item_sk#254, ss_ticket_number#261L, ss_quantity#262, ss_net_paid#272]
                                                   :        +- SortMergeJoin [ss_sold_date_sk#252], [d_date_sk#16698], Inner
                                                   :           :- Sort [ss_sold_date_sk#252 ASC NULLS FIRST], false, 0
                                                   :           :  +- Exchange hashpartitioning(ss_sold_date_sk#252, 200), ENSURE_REQUIREMENTS, [id=#295404]
                                                   :           :     +- Project [ss_sold_date_sk#252, ss_item_sk#254, ss_ticket_number#261L, ss_quantity#262, ss_net_paid#272]
                                                   :           :        +- Filter ((((((((isnotnull(ss_net_profit#274) AND isnotnull(ss_net_paid#272)) AND isnotnull(ss_quantity#262)) AND (ss_net_profit#274 > 1.00)) AND (ss_net_paid#272 > 0.00)) AND (ss_quantity#262 > 0)) AND isnotnull(ss_sold_date_sk#252)) AND isnotnull(ss_ticket_number#261L)) AND isnotnull(ss_item_sk#254))
                                                   :           :           +- FileScan parquet [ss_sold_date_sk#252,ss_item_sk#254,ss_ticket_number#261L,ss_quantity#262,ss_net_paid#272,ss_net_profit#274] Batched: true, DataFilters: [isnotnull(ss_net_profit#274), isnotnull(ss_net_paid#272), isnotnull(ss_quantity#262), (ss_net_pr..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_net_profit), IsNotNull(ss_net_paid), IsNotNull(ss_quantity), GreaterThan(ss_net_pro..., ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_ticket_number:bigint,ss_quantity:int,ss_net_paid:dec...
                                                   :           +- Sort [d_date_sk#16698 ASC NULLS FIRST], false, 0
                                                   :              +- Exchange hashpartitioning(d_date_sk#16698, 200), ENSURE_REQUIREMENTS, [id=#295405]
                                                   :                 +- Project [d_date_sk#16698]
                                                   :                    +- Filter ((((isnotnull(d_year#16704) AND isnotnull(d_moy#16706)) AND (d_year#16704 = 2000)) AND (d_moy#16706 = 11)) AND isnotnull(d_date_sk#16698))
                                                   :                       +- FileScan parquet [d_date_sk#16698,d_year#16704,d_moy#16706] Batched: true, DataFilters: [isnotnull(d_year#16704), isnotnull(d_moy#16706), (d_year#16704 = 2000), (d_moy#16706 = 11), isno..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
                                                   +- Sort [sr_ticket_number#145L ASC NULLS FIRST, sr_item_sk#138 ASC NULLS FIRST], false, 0
                                                      +- Exchange hashpartitioning(sr_ticket_number#145L, sr_item_sk#138, 200), ENSURE_REQUIREMENTS, [id=#295413]
                                                         +- Filter (((isnotnull(sr_return_amt#147) AND (sr_return_amt#147 > 10000.00)) AND isnotnull(sr_ticket_number#145L)) AND isnotnull(sr_item_sk#138))
                                                            +- FileScan parquet [sr_item_sk#138,sr_ticket_number#145L,sr_return_quantity#146,sr_return_amt#147] Batched: true, DataFilters: [isnotnull(sr_return_amt#147), (sr_return_amt#147 > 10000.00), isnotnull(sr_ticket_number#145L), ..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sr_return_amt), GreaterThan(sr_return_amt,10000.00), IsNotNull(sr_ticket_number), IsNo..., ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint,sr_return_quantity:int,sr_return_amt:decimal(7,2)>
