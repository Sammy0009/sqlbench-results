AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[channel#11229 ASC NULLS FIRST,return_rank#11227 ASC NULLS FIRST,currency_rank#11228 ASC NULLS FIRST,item#11224 ASC NULLS FIRST], output=[channel#11229,item#11224,return_ratio#11225,return_rank#11227,currency_rank#11228])
   +- *(26) HashAggregate(keys=[channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228], functions=[], output=[channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228])
      +- AQEShuffleRead coalesced
         +- ShuffleQueryStage 20
            +- Exchange hashpartitioning(channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228, 200), ENSURE_REQUIREMENTS, [id=#105814]
               +- *(25) HashAggregate(keys=[channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228], functions=[], output=[channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228])
                  +- Union
                     :- *(18) Project [web AS channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228]
                     :  +- *(18) Filter ((return_rank#11227 <= 10) OR (currency_rank#11228 <= 10))
                     :     +- Window [rank(currency_ratio#11226) windowspecdefinition(currency_ratio#11226 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#11228], [currency_ratio#11226 ASC NULLS FIRST]
                     :        +- *(17) Sort [currency_ratio#11226 ASC NULLS FIRST], false, 0
                     :           +- Window [rank(return_ratio#11225) windowspecdefinition(return_ratio#11225 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#11227], [return_ratio#11225 ASC NULLS FIRST]
                     :              +- *(16) Sort [return_ratio#11225 ASC NULLS FIRST], false, 0
                     :                 +- ShuffleQueryStage 16
                     :                    +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#105056]
                     :                       +- *(12) HashAggregate(keys=[ws_item_sk#387], functions=[sum(coalesce(wr_return_quantity#466, 0)), sum(coalesce(ws_quantity#402, 0)), sum(coalesce(cast(wr_return_amt#467 as decimal(12,2)), 0.00)), sum(coalesce(cast(ws_net_paid#413 as decimal(12,2)), 0.00))], output=[item#11224, return_ratio#11225, currency_ratio#11226])
                     :                          +- AQEShuffleRead coalesced
                     :                             +- ShuffleQueryStage 13
                     :                                +- Exchange hashpartitioning(ws_item_sk#387, 200), ENSURE_REQUIREMENTS, [id=#104366]
                     :                                   +- *(10) HashAggregate(keys=[ws_item_sk#387], functions=[partial_sum(coalesce(wr_return_quantity#466, 0)), partial_sum(coalesce(ws_quantity#402, 0)), partial_sum(coalesce(cast(wr_return_amt#467 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(ws_net_paid#413 as decimal(12,2)), 0.00))], output=[ws_item_sk#387, sum#11405L, sum#11406L, sum#11407, isEmpty#11408, sum#11409, isEmpty#11410])
                     :                                      +- *(10) Project [ws_item_sk#387, ws_quantity#402, ws_net_paid#413, wr_return_quantity#466, wr_return_amt#467]
                     :                                         +- *(10) BroadcastHashJoin [ws_sold_date_sk#384], [d_date_sk#598], Inner, BuildRight, false
                     :                                            :- *(10) Project [ws_sold_date_sk#384, ws_item_sk#387, ws_quantity#402, ws_net_paid#413, wr_return_quantity#466, wr_return_amt#467]
                     :                                            :  +- *(10) BroadcastHashJoin [ws_order_number#401L, ws_item_sk#387], [wr_order_number#465L, wr_item_sk#454], Inner, BuildRight, false
                     :                                            :     :- AQEShuffleRead local
                     :                                            :     :  +- ShuffleQueryStage 0
                     :                                            :     :     +- Exchange hashpartitioning(ws_order_number#401L, ws_item_sk#387, 200), ENSURE_REQUIREMENTS, [id=#102711]
                     :                                            :     :        +- *(1) Project [ws_sold_date_sk#384, ws_item_sk#387, ws_order_number#401L, ws_quantity#402, ws_net_paid#413]
                     :                                            :     :           +- *(1) Filter ((((((((isnotnull(ws_net_profit#417) AND isnotnull(ws_net_paid#413)) AND isnotnull(ws_quantity#402)) AND (ws_net_profit#417 > 1.00)) AND (ws_net_paid#413 > 0.00)) AND (ws_quantity#402 > 0)) AND isnotnull(ws_order_number#401L)) AND isnotnull(ws_item_sk#387)) AND isnotnull(ws_sold_date_sk#384))
                     :                                            :     :              +- *(1) ColumnarToRow
                     :                                            :     :                 +- FileScan parquet [ws_sold_date_sk#384,ws_item_sk#387,ws_order_number#401L,ws_quantity#402,ws_net_paid#413,ws_net_profit#417] Batched: true, DataFilters: [isnotnull(ws_net_profit#417), isnotnull(ws_net_paid#413), isnotnull(ws_quantity#402), (ws_net_pr..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_net_profit), IsNotNull(ws_net_paid), IsNotNull(ws_quantity), GreaterThan(ws_net_pro..., ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_order_number:bigint,ws_quantity:int,ws_net_paid:deci...
                     :                                            :     +- BroadcastQueryStage 11
                     :                                            :        +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, bigint, false], input[0, int, false]),false), [id=#103477]
                     :                                            :           +- AQEShuffleRead local
                     :                                            :              +- ShuffleQueryStage 1
                     :                                            :                 +- Exchange hashpartitioning(wr_order_number#465L, wr_item_sk#454, 200), ENSURE_REQUIREMENTS, [id=#102730]
                     :                                            :                    +- *(2) Filter (((isnotnull(wr_return_amt#467) AND (wr_return_amt#467 > 10000.00)) AND isnotnull(wr_order_number#465L)) AND isnotnull(wr_item_sk#454))
                     :                                            :                       +- *(2) ColumnarToRow
                     :                                            :                          +- FileScan parquet [wr_item_sk#454,wr_order_number#465L,wr_return_quantity#466,wr_return_amt#467] Batched: true, DataFilters: [isnotnull(wr_return_amt#467), (wr_return_amt#467 > 10000.00), isnotnull(wr_order_number#465L), i..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(wr_return_amt), GreaterThan(wr_return_amt,10000.00), IsNotNull(wr_order_number), IsNot..., ReadSchema: struct<wr_item_sk:int,wr_order_number:bigint,wr_return_quantity:int,wr_return_amt:decimal(7,2)>
                     :                                            +- BroadcastQueryStage 2
                     :                                               +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#102751]
                     :                                                  +- *(3) Project [d_date_sk#598]
                     :                                                     +- *(3) Filter ((((isnotnull(d_year#604) AND isnotnull(d_moy#606)) AND (d_year#604 = 2000)) AND (d_moy#606 = 11)) AND isnotnull(d_date_sk#598))
                     :                                                        +- *(3) ColumnarToRow
                     :                                                           +- FileScan parquet [d_date_sk#598,d_year#604,d_moy#606] Batched: true, DataFilters: [isnotnull(d_year#604), isnotnull(d_moy#606), (d_year#604 = 2000), (d_moy#606 = 11), isnotnull(d_..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
                     :- *(21) Project [catalog AS channel#11235, item#11230, return_ratio#11231, return_rank#11233, currency_rank#11234]
                     :  +- *(21) Filter ((return_rank#11233 <= 10) OR (currency_rank#11234 <= 10))
                     :     +- Window [rank(currency_ratio#11232) windowspecdefinition(currency_ratio#11232 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#11234], [currency_ratio#11232 ASC NULLS FIRST]
                     :        +- *(20) Sort [currency_ratio#11232 ASC NULLS FIRST], false, 0
                     :           +- Window [rank(return_ratio#11231) windowspecdefinition(return_ratio#11231 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#11233], [return_ratio#11231 ASC NULLS FIRST]
                     :              +- *(19) Sort [return_ratio#11231 ASC NULLS FIRST], false, 0
                     :                 +- ShuffleQueryStage 18
                     :                    +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#105460]
                     :                       +- *(14) HashAggregate(keys=[cs_item_sk#133], functions=[sum(coalesce(cr_return_quantity#265, 0)), sum(coalesce(cs_quantity#136, 0)), sum(coalesce(cast(cr_return_amount#266 as decimal(12,2)), 0.00)), sum(coalesce(cast(cs_net_paid#147 as decimal(12,2)), 0.00))], output=[item#11230, return_ratio#11231, currency_ratio#11232])
                     :                          +- AQEShuffleRead coalesced
                     :                             +- ShuffleQueryStage 14
                     :                                +- Exchange hashpartitioning(cs_item_sk#133, 200), ENSURE_REQUIREMENTS, [id=#104578]
                     :                                   +- *(11) HashAggregate(keys=[cs_item_sk#133], functions=[partial_sum(coalesce(cr_return_quantity#265, 0)), partial_sum(coalesce(cs_quantity#136, 0)), partial_sum(coalesce(cast(cr_return_amount#266 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(cs_net_paid#147 as decimal(12,2)), 0.00))], output=[cs_item_sk#133, sum#11417L, sum#11418L, sum#11419, isEmpty#11420, sum#11421, isEmpty#11422])
                     :                                      +- *(11) Project [cs_item_sk#133, cs_quantity#136, cs_net_paid#147, cr_return_quantity#265, cr_return_amount#266]
                     :                                         +- *(11) BroadcastHashJoin [cs_sold_date_sk#118], [d_date_sk#11242], Inner, BuildRight, false
                     :                                            :- *(11) Project [cs_sold_date_sk#118, cs_item_sk#133, cs_quantity#136, cs_net_paid#147, cr_return_quantity#265, cr_return_amount#266]
                     :                                            :  +- *(11) BroadcastHashJoin [cs_order_number#135L, cs_item_sk#133], [cr_order_number#264L, cr_item_sk#250], Inner, BuildRight, false
                     :                                            :     :- AQEShuffleRead local
                     :                                            :     :  +- ShuffleQueryStage 3
                     :                                            :     :     +- Exchange hashpartitioning(cs_order_number#135L, cs_item_sk#133, 200), ENSURE_REQUIREMENTS, [id=#102782]
                     :                                            :     :        +- *(4) Project [cs_sold_date_sk#118, cs_item_sk#133, cs_order_number#135L, cs_quantity#136, cs_net_paid#147]
                     :                                            :     :           +- *(4) Filter ((((((((isnotnull(cs_net_profit#151) AND isnotnull(cs_net_paid#147)) AND isnotnull(cs_quantity#136)) AND (cs_net_profit#151 > 1.00)) AND (cs_net_paid#147 > 0.00)) AND (cs_quantity#136 > 0)) AND isnotnull(cs_order_number#135L)) AND isnotnull(cs_item_sk#133)) AND isnotnull(cs_sold_date_sk#118))
                     :                                            :     :              +- *(4) ColumnarToRow
                     :                                            :     :                 +- FileScan parquet [cs_sold_date_sk#118,cs_item_sk#133,cs_order_number#135L,cs_quantity#136,cs_net_paid#147,cs_net_profit#151] Batched: true, DataFilters: [isnotnull(cs_net_profit#151), isnotnull(cs_net_paid#147), isnotnull(cs_quantity#136), (cs_net_pr..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cs_net_profit), IsNotNull(cs_net_paid), IsNotNull(cs_quantity), GreaterThan(cs_net_pro..., ReadSchema: struct<cs_sold_date_sk:int,cs_item_sk:int,cs_order_number:bigint,cs_quantity:int,cs_net_paid:deci...
                     :                                            :     +- BroadcastQueryStage 12
                     :                                            :        +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, bigint, false], input[0, int, false]),false), [id=#103965]
                     :                                            :           +- AQEShuffleRead local
                     :                                            :              +- ShuffleQueryStage 4
                     :                                            :                 +- Exchange hashpartitioning(cr_order_number#264L, cr_item_sk#250, 200), ENSURE_REQUIREMENTS, [id=#102801]
                     :                                            :                    +- *(5) Filter (((isnotnull(cr_return_amount#266) AND (cr_return_amount#266 > 10000.00)) AND isnotnull(cr_order_number#264L)) AND isnotnull(cr_item_sk#250))
                     :                                            :                       +- *(5) ColumnarToRow
                     :                                            :                          +- FileScan parquet [cr_item_sk#250,cr_order_number#264L,cr_return_quantity#265,cr_return_amount#266] Batched: true, DataFilters: [isnotnull(cr_return_amount#266), (cr_return_amount#266 > 10000.00), isnotnull(cr_order_number#26..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cr_return_amount), GreaterThan(cr_return_amount,10000.00), IsNotNull(cr_order_number),..., ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint,cr_return_quantity:int,cr_return_amount:decimal(7,2)>
                     :                                            +- BroadcastQueryStage 6
                     :                                               +- ReusedExchange [d_date_sk#11242], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#102751]
                     +- *(24) Project [store AS channel#11241, item#11236, return_ratio#11237, return_rank#11239, currency_rank#11240]
                        +- *(24) Filter ((return_rank#11239 <= 10) OR (currency_rank#11240 <= 10))
                           +- Window [rank(currency_ratio#11238) windowspecdefinition(currency_ratio#11238 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#11240], [currency_ratio#11238 ASC NULLS FIRST]
                              +- *(23) Sort [currency_ratio#11238 ASC NULLS FIRST], false, 0
                                 +- Window [rank(return_ratio#11237) windowspecdefinition(return_ratio#11237 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#11239], [return_ratio#11237 ASC NULLS FIRST]
                                    +- *(22) Sort [return_ratio#11237 ASC NULLS FIRST], false, 0
                                       +- ShuffleQueryStage 19
                                          +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#105660]
                                             +- *(15) HashAggregate(keys=[ss_item_sk#666], functions=[sum(coalesce(sr_return_quantity#720, 0)), sum(coalesce(ss_quantity#674, 0)), sum(coalesce(cast(sr_return_amt#721 as decimal(12,2)), 0.00)), sum(coalesce(cast(ss_net_paid#684 as decimal(12,2)), 0.00))], output=[item#11236, return_ratio#11237, currency_ratio#11238])
                                                +- AQEShuffleRead coalesced
                                                   +- ShuffleQueryStage 17
                                                      +- Exchange hashpartitioning(ss_item_sk#666, 200), ENSURE_REQUIREMENTS, [id=#105322]
                                                         +- *(13) HashAggregate(keys=[ss_item_sk#666], functions=[partial_sum(coalesce(sr_return_quantity#720, 0)), partial_sum(coalesce(ss_quantity#674, 0)), partial_sum(coalesce(cast(sr_return_amt#721 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(ss_net_paid#684 as decimal(12,2)), 0.00))], output=[ss_item_sk#666, sum#11429L, sum#11430L, sum#11431, isEmpty#11432, sum#11433, isEmpty#11434])
                                                            +- *(13) Project [ss_item_sk#666, ss_quantity#674, ss_net_paid#684, sr_return_quantity#720, sr_return_amt#721]
                                                               +- *(13) BroadcastHashJoin [ss_sold_date_sk#664], [d_date_sk#11270], Inner, BuildRight, false
                                                                  :- *(13) Project [ss_sold_date_sk#664, ss_item_sk#666, ss_quantity#674, ss_net_paid#684, sr_return_quantity#720, sr_return_amt#721]
                                                                  :  +- *(13) BroadcastHashJoin [ss_ticket_number#673L, ss_item_sk#666], [sr_ticket_number#719L, sr_item_sk#712], Inner, BuildRight, false
                                                                  :     :- AQEShuffleRead local
                                                                  :     :  +- ShuffleQueryStage 7
                                                                  :     :     +- Exchange hashpartitioning(ss_ticket_number#673L, ss_item_sk#666, 200), ENSURE_REQUIREMENTS, [id=#102855]
                                                                  :     :        +- *(7) Project [ss_sold_date_sk#664, ss_item_sk#666, ss_ticket_number#673L, ss_quantity#674, ss_net_paid#684]
                                                                  :     :           +- *(7) Filter ((((((((isnotnull(ss_net_profit#686) AND isnotnull(ss_net_paid#684)) AND isnotnull(ss_quantity#674)) AND (ss_net_profit#686 > 1.00)) AND (ss_net_paid#684 > 0.00)) AND (ss_quantity#674 > 0)) AND isnotnull(ss_ticket_number#673L)) AND isnotnull(ss_item_sk#666)) AND isnotnull(ss_sold_date_sk#664))
                                                                  :     :              +- *(7) ColumnarToRow
                                                                  :     :                 +- FileScan parquet [ss_sold_date_sk#664,ss_item_sk#666,ss_ticket_number#673L,ss_quantity#674,ss_net_paid#684,ss_net_profit#686] Batched: true, DataFilters: [isnotnull(ss_net_profit#686), isnotnull(ss_net_paid#684), isnotnull(ss_quantity#674), (ss_net_pr..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_net_profit), IsNotNull(ss_net_paid), IsNotNull(ss_quantity), GreaterThan(ss_net_pro..., ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_ticket_number:bigint,ss_quantity:int,ss_net_paid:dec...
                                                                  :     +- BroadcastQueryStage 15
                                                                  :        +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, bigint, false], input[0, int, false]),false), [id=#104785]
                                                                  :           +- AQEShuffleRead local
                                                                  :              +- ShuffleQueryStage 8
                                                                  :                 +- Exchange hashpartitioning(sr_ticket_number#719L, sr_item_sk#712, 200), ENSURE_REQUIREMENTS, [id=#102874]
                                                                  :                    +- *(8) Filter (((isnotnull(sr_return_amt#721) AND (sr_return_amt#721 > 10000.00)) AND isnotnull(sr_ticket_number#719L)) AND isnotnull(sr_item_sk#712))
                                                                  :                       +- *(8) ColumnarToRow
                                                                  :                          +- FileScan parquet [sr_item_sk#712,sr_ticket_number#719L,sr_return_quantity#720,sr_return_amt#721] Batched: true, DataFilters: [isnotnull(sr_return_amt#721), (sr_return_amt#721 > 10000.00), isnotnull(sr_ticket_number#719L), ..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sr_return_amt), GreaterThan(sr_return_amt,10000.00), IsNotNull(sr_ticket_number), IsNo..., ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint,sr_return_quantity:int,sr_return_amt:decimal(7,2)>
                                                                  +- BroadcastQueryStage 10
                                                                     +- ReusedExchange [d_date_sk#11270], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#102751]
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[channel#11229 ASC NULLS FIRST,return_rank#11227 ASC NULLS FIRST,currency_rank#11228 ASC NULLS FIRST,item#11224 ASC NULLS FIRST], output=[channel#11229,item#11224,return_ratio#11225,return_rank#11227,currency_rank#11228])
   +- HashAggregate(keys=[channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228], functions=[], output=[channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228])
      +- Exchange hashpartitioning(channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228, 200), ENSURE_REQUIREMENTS, [id=#102547]
         +- HashAggregate(keys=[channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228], functions=[], output=[channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228])
            +- Union
               :- Project [web AS channel#11229, item#11224, return_ratio#11225, return_rank#11227, currency_rank#11228]
               :  +- Filter ((return_rank#11227 <= 10) OR (currency_rank#11228 <= 10))
               :     +- Window [rank(currency_ratio#11226) windowspecdefinition(currency_ratio#11226 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#11228], [currency_ratio#11226 ASC NULLS FIRST]
               :        +- Sort [currency_ratio#11226 ASC NULLS FIRST], false, 0
               :           +- Window [rank(return_ratio#11225) windowspecdefinition(return_ratio#11225 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#11227], [return_ratio#11225 ASC NULLS FIRST]
               :              +- Sort [return_ratio#11225 ASC NULLS FIRST], false, 0
               :                 +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#102488]
               :                    +- HashAggregate(keys=[ws_item_sk#387], functions=[sum(coalesce(wr_return_quantity#466, 0)), sum(coalesce(ws_quantity#402, 0)), sum(coalesce(cast(wr_return_amt#467 as decimal(12,2)), 0.00)), sum(coalesce(cast(ws_net_paid#413 as decimal(12,2)), 0.00))], output=[item#11224, return_ratio#11225, currency_ratio#11226])
               :                       +- Exchange hashpartitioning(ws_item_sk#387, 200), ENSURE_REQUIREMENTS, [id=#102485]
               :                          +- HashAggregate(keys=[ws_item_sk#387], functions=[partial_sum(coalesce(wr_return_quantity#466, 0)), partial_sum(coalesce(ws_quantity#402, 0)), partial_sum(coalesce(cast(wr_return_amt#467 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(ws_net_paid#413 as decimal(12,2)), 0.00))], output=[ws_item_sk#387, sum#11405L, sum#11406L, sum#11407, isEmpty#11408, sum#11409, isEmpty#11410])
               :                             +- Project [ws_item_sk#387, ws_quantity#402, ws_net_paid#413, wr_return_quantity#466, wr_return_amt#467]
               :                                +- BroadcastHashJoin [ws_sold_date_sk#384], [d_date_sk#598], Inner, BuildRight, false
               :                                   :- Project [ws_sold_date_sk#384, ws_item_sk#387, ws_quantity#402, ws_net_paid#413, wr_return_quantity#466, wr_return_amt#467]
               :                                   :  +- SortMergeJoin [ws_order_number#401L, ws_item_sk#387], [wr_order_number#465L, wr_item_sk#454], Inner
               :                                   :     :- Sort [ws_order_number#401L ASC NULLS FIRST, ws_item_sk#387 ASC NULLS FIRST], false, 0
               :                                   :     :  +- Exchange hashpartitioning(ws_order_number#401L, ws_item_sk#387, 200), ENSURE_REQUIREMENTS, [id=#102473]
               :                                   :     :     +- Project [ws_sold_date_sk#384, ws_item_sk#387, ws_order_number#401L, ws_quantity#402, ws_net_paid#413]
               :                                   :     :        +- Filter ((((((((isnotnull(ws_net_profit#417) AND isnotnull(ws_net_paid#413)) AND isnotnull(ws_quantity#402)) AND (ws_net_profit#417 > 1.00)) AND (ws_net_paid#413 > 0.00)) AND (ws_quantity#402 > 0)) AND isnotnull(ws_order_number#401L)) AND isnotnull(ws_item_sk#387)) AND isnotnull(ws_sold_date_sk#384))
               :                                   :     :           +- FileScan parquet [ws_sold_date_sk#384,ws_item_sk#387,ws_order_number#401L,ws_quantity#402,ws_net_paid#413,ws_net_profit#417] Batched: true, DataFilters: [isnotnull(ws_net_profit#417), isnotnull(ws_net_paid#413), isnotnull(ws_quantity#402), (ws_net_pr..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_net_profit), IsNotNull(ws_net_paid), IsNotNull(ws_quantity), GreaterThan(ws_net_pro..., ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_order_number:bigint,ws_quantity:int,ws_net_paid:deci...
               :                                   :     +- Sort [wr_order_number#465L ASC NULLS FIRST, wr_item_sk#454 ASC NULLS FIRST], false, 0
               :                                   :        +- Exchange hashpartitioning(wr_order_number#465L, wr_item_sk#454, 200), ENSURE_REQUIREMENTS, [id=#102474]
               :                                   :           +- Filter (((isnotnull(wr_return_amt#467) AND (wr_return_amt#467 > 10000.00)) AND isnotnull(wr_order_number#465L)) AND isnotnull(wr_item_sk#454))
               :                                   :              +- FileScan parquet [wr_item_sk#454,wr_order_number#465L,wr_return_quantity#466,wr_return_amt#467] Batched: true, DataFilters: [isnotnull(wr_return_amt#467), (wr_return_amt#467 > 10000.00), isnotnull(wr_order_number#465L), i..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(wr_return_amt), GreaterThan(wr_return_amt,10000.00), IsNotNull(wr_order_number), IsNot..., ReadSchema: struct<wr_item_sk:int,wr_order_number:bigint,wr_return_quantity:int,wr_return_amt:decimal(7,2)>
               :                                   +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#102480]
               :                                      +- Project [d_date_sk#598]
               :                                         +- Filter ((((isnotnull(d_year#604) AND isnotnull(d_moy#606)) AND (d_year#604 = 2000)) AND (d_moy#606 = 11)) AND isnotnull(d_date_sk#598))
               :                                            +- FileScan parquet [d_date_sk#598,d_year#604,d_moy#606] Batched: true, DataFilters: [isnotnull(d_year#604), isnotnull(d_moy#606), (d_year#604 = 2000), (d_moy#606 = 11), isnotnull(d_..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
               :- Project [catalog AS channel#11235, item#11230, return_ratio#11231, return_rank#11233, currency_rank#11234]
               :  +- Filter ((return_rank#11233 <= 10) OR (currency_rank#11234 <= 10))
               :     +- Window [rank(currency_ratio#11232) windowspecdefinition(currency_ratio#11232 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#11234], [currency_ratio#11232 ASC NULLS FIRST]
               :        +- Sort [currency_ratio#11232 ASC NULLS FIRST], false, 0
               :           +- Window [rank(return_ratio#11231) windowspecdefinition(return_ratio#11231 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#11233], [return_ratio#11231 ASC NULLS FIRST]
               :              +- Sort [return_ratio#11231 ASC NULLS FIRST], false, 0
               :                 +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#102512]
               :                    +- HashAggregate(keys=[cs_item_sk#133], functions=[sum(coalesce(cr_return_quantity#265, 0)), sum(coalesce(cs_quantity#136, 0)), sum(coalesce(cast(cr_return_amount#266 as decimal(12,2)), 0.00)), sum(coalesce(cast(cs_net_paid#147 as decimal(12,2)), 0.00))], output=[item#11230, return_ratio#11231, currency_ratio#11232])
               :                       +- Exchange hashpartitioning(cs_item_sk#133, 200), ENSURE_REQUIREMENTS, [id=#102509]
               :                          +- HashAggregate(keys=[cs_item_sk#133], functions=[partial_sum(coalesce(cr_return_quantity#265, 0)), partial_sum(coalesce(cs_quantity#136, 0)), partial_sum(coalesce(cast(cr_return_amount#266 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(cs_net_paid#147 as decimal(12,2)), 0.00))], output=[cs_item_sk#133, sum#11417L, sum#11418L, sum#11419, isEmpty#11420, sum#11421, isEmpty#11422])
               :                             +- Project [cs_item_sk#133, cs_quantity#136, cs_net_paid#147, cr_return_quantity#265, cr_return_amount#266]
               :                                +- BroadcastHashJoin [cs_sold_date_sk#118], [d_date_sk#11242], Inner, BuildRight, false
               :                                   :- Project [cs_sold_date_sk#118, cs_item_sk#133, cs_quantity#136, cs_net_paid#147, cr_return_quantity#265, cr_return_amount#266]
               :                                   :  +- SortMergeJoin [cs_order_number#135L, cs_item_sk#133], [cr_order_number#264L, cr_item_sk#250], Inner
               :                                   :     :- Sort [cs_order_number#135L ASC NULLS FIRST, cs_item_sk#133 ASC NULLS FIRST], false, 0
               :                                   :     :  +- Exchange hashpartitioning(cs_order_number#135L, cs_item_sk#133, 200), ENSURE_REQUIREMENTS, [id=#102497]
               :                                   :     :     +- Project [cs_sold_date_sk#118, cs_item_sk#133, cs_order_number#135L, cs_quantity#136, cs_net_paid#147]
               :                                   :     :        +- Filter ((((((((isnotnull(cs_net_profit#151) AND isnotnull(cs_net_paid#147)) AND isnotnull(cs_quantity#136)) AND (cs_net_profit#151 > 1.00)) AND (cs_net_paid#147 > 0.00)) AND (cs_quantity#136 > 0)) AND isnotnull(cs_order_number#135L)) AND isnotnull(cs_item_sk#133)) AND isnotnull(cs_sold_date_sk#118))
               :                                   :     :           +- FileScan parquet [cs_sold_date_sk#118,cs_item_sk#133,cs_order_number#135L,cs_quantity#136,cs_net_paid#147,cs_net_profit#151] Batched: true, DataFilters: [isnotnull(cs_net_profit#151), isnotnull(cs_net_paid#147), isnotnull(cs_quantity#136), (cs_net_pr..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cs_net_profit), IsNotNull(cs_net_paid), IsNotNull(cs_quantity), GreaterThan(cs_net_pro..., ReadSchema: struct<cs_sold_date_sk:int,cs_item_sk:int,cs_order_number:bigint,cs_quantity:int,cs_net_paid:deci...
               :                                   :     +- Sort [cr_order_number#264L ASC NULLS FIRST, cr_item_sk#250 ASC NULLS FIRST], false, 0
               :                                   :        +- Exchange hashpartitioning(cr_order_number#264L, cr_item_sk#250, 200), ENSURE_REQUIREMENTS, [id=#102498]
               :                                   :           +- Filter (((isnotnull(cr_return_amount#266) AND (cr_return_amount#266 > 10000.00)) AND isnotnull(cr_order_number#264L)) AND isnotnull(cr_item_sk#250))
               :                                   :              +- FileScan parquet [cr_item_sk#250,cr_order_number#264L,cr_return_quantity#265,cr_return_amount#266] Batched: true, DataFilters: [isnotnull(cr_return_amount#266), (cr_return_amount#266 > 10000.00), isnotnull(cr_order_number#26..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/catalog_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(cr_return_amount), GreaterThan(cr_return_amount,10000.00), IsNotNull(cr_order_number),..., ReadSchema: struct<cr_item_sk:int,cr_order_number:bigint,cr_return_quantity:int,cr_return_amount:decimal(7,2)>
               :                                   +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#102504]
               :                                      +- Project [d_date_sk#11242]
               :                                         +- Filter ((((isnotnull(d_year#11248) AND isnotnull(d_moy#11250)) AND (d_year#11248 = 2000)) AND (d_moy#11250 = 11)) AND isnotnull(d_date_sk#11242))
               :                                            +- FileScan parquet [d_date_sk#11242,d_year#11248,d_moy#11250] Batched: true, DataFilters: [isnotnull(d_year#11248), isnotnull(d_moy#11250), (d_year#11248 = 2000), (d_moy#11250 = 11), isno..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
               +- Project [store AS channel#11241, item#11236, return_ratio#11237, return_rank#11239, currency_rank#11240]
                  +- Filter ((return_rank#11239 <= 10) OR (currency_rank#11240 <= 10))
                     +- Window [rank(currency_ratio#11238) windowspecdefinition(currency_ratio#11238 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS currency_rank#11240], [currency_ratio#11238 ASC NULLS FIRST]
                        +- Sort [currency_ratio#11238 ASC NULLS FIRST], false, 0
                           +- Window [rank(return_ratio#11237) windowspecdefinition(return_ratio#11237 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS return_rank#11239], [return_ratio#11237 ASC NULLS FIRST]
                              +- Sort [return_ratio#11237 ASC NULLS FIRST], false, 0
                                 +- Exchange SinglePartition, ENSURE_REQUIREMENTS, [id=#102536]
                                    +- HashAggregate(keys=[ss_item_sk#666], functions=[sum(coalesce(sr_return_quantity#720, 0)), sum(coalesce(ss_quantity#674, 0)), sum(coalesce(cast(sr_return_amt#721 as decimal(12,2)), 0.00)), sum(coalesce(cast(ss_net_paid#684 as decimal(12,2)), 0.00))], output=[item#11236, return_ratio#11237, currency_ratio#11238])
                                       +- Exchange hashpartitioning(ss_item_sk#666, 200), ENSURE_REQUIREMENTS, [id=#102533]
                                          +- HashAggregate(keys=[ss_item_sk#666], functions=[partial_sum(coalesce(sr_return_quantity#720, 0)), partial_sum(coalesce(ss_quantity#674, 0)), partial_sum(coalesce(cast(sr_return_amt#721 as decimal(12,2)), 0.00)), partial_sum(coalesce(cast(ss_net_paid#684 as decimal(12,2)), 0.00))], output=[ss_item_sk#666, sum#11429L, sum#11430L, sum#11431, isEmpty#11432, sum#11433, isEmpty#11434])
                                             +- Project [ss_item_sk#666, ss_quantity#674, ss_net_paid#684, sr_return_quantity#720, sr_return_amt#721]
                                                +- BroadcastHashJoin [ss_sold_date_sk#664], [d_date_sk#11270], Inner, BuildRight, false
                                                   :- Project [ss_sold_date_sk#664, ss_item_sk#666, ss_quantity#674, ss_net_paid#684, sr_return_quantity#720, sr_return_amt#721]
                                                   :  +- SortMergeJoin [ss_ticket_number#673L, ss_item_sk#666], [sr_ticket_number#719L, sr_item_sk#712], Inner
                                                   :     :- Sort [ss_ticket_number#673L ASC NULLS FIRST, ss_item_sk#666 ASC NULLS FIRST], false, 0
                                                   :     :  +- Exchange hashpartitioning(ss_ticket_number#673L, ss_item_sk#666, 200), ENSURE_REQUIREMENTS, [id=#102521]
                                                   :     :     +- Project [ss_sold_date_sk#664, ss_item_sk#666, ss_ticket_number#673L, ss_quantity#674, ss_net_paid#684]
                                                   :     :        +- Filter ((((((((isnotnull(ss_net_profit#686) AND isnotnull(ss_net_paid#684)) AND isnotnull(ss_quantity#674)) AND (ss_net_profit#686 > 1.00)) AND (ss_net_paid#684 > 0.00)) AND (ss_quantity#674 > 0)) AND isnotnull(ss_ticket_number#673L)) AND isnotnull(ss_item_sk#666)) AND isnotnull(ss_sold_date_sk#664))
                                                   :     :           +- FileScan parquet [ss_sold_date_sk#664,ss_item_sk#666,ss_ticket_number#673L,ss_quantity#674,ss_net_paid#684,ss_net_profit#686] Batched: true, DataFilters: [isnotnull(ss_net_profit#686), isnotnull(ss_net_paid#684), isnotnull(ss_quantity#674), (ss_net_pr..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_net_profit), IsNotNull(ss_net_paid), IsNotNull(ss_quantity), GreaterThan(ss_net_pro..., ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int,ss_ticket_number:bigint,ss_quantity:int,ss_net_paid:dec...
                                                   :     +- Sort [sr_ticket_number#719L ASC NULLS FIRST, sr_item_sk#712 ASC NULLS FIRST], false, 0
                                                   :        +- Exchange hashpartitioning(sr_ticket_number#719L, sr_item_sk#712, 200), ENSURE_REQUIREMENTS, [id=#102522]
                                                   :           +- Filter (((isnotnull(sr_return_amt#721) AND (sr_return_amt#721 > 10000.00)) AND isnotnull(sr_ticket_number#719L)) AND isnotnull(sr_item_sk#712))
                                                   :              +- FileScan parquet [sr_item_sk#712,sr_ticket_number#719L,sr_return_quantity#720,sr_return_amt#721] Batched: true, DataFilters: [isnotnull(sr_return_amt#721), (sr_return_amt#721 > 10000.00), isnotnull(sr_ticket_number#719L), ..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_returns.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sr_return_amt), GreaterThan(sr_return_amt,10000.00), IsNotNull(sr_ticket_number), IsNo..., ReadSchema: struct<sr_item_sk:int,sr_ticket_number:bigint,sr_return_quantity:int,sr_return_amt:decimal(7,2)>
                                                   +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#102528]
                                                      +- Project [d_date_sk#11270]
                                                         +- Filter ((((isnotnull(d_year#11276) AND isnotnull(d_moy#11278)) AND (d_year#11276 = 2000)) AND (d_moy#11278 = 11)) AND isnotnull(d_date_sk#11270))
                                                            +- FileScan parquet [d_date_sk#11270,d_year#11276,d_moy#11278] Batched: true, DataFilters: [isnotnull(d_year#11276), isnotnull(d_moy#11278), (d_year#11276 = 2000), (d_moy#11278 = 11), isno..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,11), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
