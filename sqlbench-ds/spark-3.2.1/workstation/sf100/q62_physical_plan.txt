AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   GpuColumnarToRow false
   +- GpuTopN(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#20707 ASC NULLS FIRST,sm_type#446 ASC NULLS FIRST,web_name#802 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#20707,sm_type#446,web_name#802,30 days#20697L,31-60 days#20698L,61-90 days#20699L,91-120 days#20700L,>120 days#20701L])
      +- GpuHashAggregate(keys=[_groupingexpression#20716, sm_type#446, web_name#802], functions=[gpubasicsum(CASE WHEN ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 30) THEN 1 ELSE 0 END, LongType, false), gpubasicsum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 30) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 60)) THEN 1 ELSE 0 END, LongType, false), gpubasicsum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 60) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 90)) THEN 1 ELSE 0 END, LongType, false), gpubasicsum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 90) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 120)) THEN 1 ELSE 0 END, LongType, false), gpubasicsum(CASE WHEN ((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 120) THEN 1 ELSE 0 END, LongType, false)], output=[substr(w_warehouse_name, 1, 20)#20707, sm_type#446, web_name#802, 30 days#20697L, 31-60 days#20698L, 61-90 days#20699L, 91-120 days#20700L, >120 days#20701L])
         +- GpuShuffleCoalesce 2147483647
            +- GpuCustomShuffleReader coalesced
               +- ShuffleQueryStage 8
                  +- GpuColumnarExchange gpuhashpartitioning(_groupingexpression#20716, sm_type#446, web_name#802, 200), ENSURE_REQUIREMENTS, [id=#359390]
                     +- GpuHashAggregate(keys=[_groupingexpression#20716, sm_type#446, web_name#802], functions=[partial_gpubasicsum(CASE WHEN ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 30) THEN 1 ELSE 0 END, LongType, false), partial_gpubasicsum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 30) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 60)) THEN 1 ELSE 0 END, LongType, false), partial_gpubasicsum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 60) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 90)) THEN 1 ELSE 0 END, LongType, false), partial_gpubasicsum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 90) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 120)) THEN 1 ELSE 0 END, LongType, false), partial_gpubasicsum(CASE WHEN ((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 120) THEN 1 ELSE 0 END, LongType, false)], output=[_groupingexpression#20716, sm_type#446, web_name#802, sum#20722L, sum#20723L, sum#20724L, sum#20725L, sum#20726L])
                        +- GpuProject [ws_sold_date_sk#476, ws_ship_date_sk#478, sm_type#446, web_name#802, gpusubstring(w_warehouse_name#772, 1, 20) AS _groupingexpression#20716], true
                           +- GpuShuffledHashJoin [ws_ship_date_sk#478], [d_date_sk#612], Inner, GpuBuildRight, false
                              :- GpuShuffleCoalesce 2147483647
                              :  +- GpuCustomShuffleReader coalesced
                              :     +- ShuffleQueryStage 7
                              :        +- GpuColumnarExchange gpuhashpartitioning(ws_ship_date_sk#478, 200), ENSURE_REQUIREMENTS, [id=#359250]
                              :           +- GpuProject [ws_sold_date_sk#476, ws_ship_date_sk#478, w_warehouse_name#772, sm_type#446, web_name#802], true
                              :              +- GpuShuffledHashJoin [ws_web_site_sk#489], [web_site_sk#798], Inner, GpuBuildRight, false
                              :                 :- GpuShuffleCoalesce 2147483647
                              :                 :  +- GpuCustomShuffleReader coalesced
                              :                 :     +- ShuffleQueryStage 6
                              :                 :        +- GpuColumnarExchange gpuhashpartitioning(ws_web_site_sk#489, 200), ENSURE_REQUIREMENTS, [id=#359075]
                              :                 :           +- GpuProject [ws_sold_date_sk#476, ws_ship_date_sk#478, ws_web_site_sk#489, w_warehouse_name#772, sm_type#446], true
                              :                 :              +- GpuShuffledHashJoin [ws_ship_mode_sk#490], [sm_ship_mode_sk#444], Inner, GpuBuildRight, false
                              :                 :                 :- GpuShuffleCoalesce 2147483647
                              :                 :                 :  +- GpuCustomShuffleReader coalesced
                              :                 :                 :     +- ShuffleQueryStage 5
                              :                 :                 :        +- GpuColumnarExchange gpuhashpartitioning(ws_ship_mode_sk#490, 200), ENSURE_REQUIREMENTS, [id=#358858]
                              :                 :                 :           +- GpuProject [ws_sold_date_sk#476, ws_ship_date_sk#478, ws_web_site_sk#489, ws_ship_mode_sk#490, w_warehouse_name#772], true
                              :                 :                 :              +- GpuShuffledHashJoin [ws_warehouse_sk#491], [w_warehouse_sk#770], Inner, GpuBuildRight, false
                              :                 :                 :                 :- GpuShuffleCoalesce 2147483647
                              :                 :                 :                 :  +- GpuCustomShuffleReader coalesced
                              :                 :                 :                 :     +- ShuffleQueryStage 0
                              :                 :                 :                 :        +- GpuColumnarExchange gpuhashpartitioning(ws_warehouse_sk#491, 200), ENSURE_REQUIREMENTS, [id=#358034]
                              :                 :                 :                 :           +- GpuCoalesceBatches targetsize(2147483647)
                              :                 :                 :                 :              +- GpuFilter (((gpuisnotnull(ws_warehouse_sk#491) AND gpuisnotnull(ws_ship_mode_sk#490)) AND gpuisnotnull(ws_web_site_sk#489)) AND gpuisnotnull(ws_ship_date_sk#478)), true
                              :                 :                 :                 :                 +- GpuFileGpuScan parquet [ws_sold_date_sk#476,ws_ship_date_sk#478,ws_web_site_sk#489,ws_ship_mode_sk#490,ws_warehouse_sk#491] Batched: true, DataFilters: [isnotnull(ws_warehouse_sk#491), isnotnull(ws_ship_mode_sk#490), isnotnull(ws_web_site_sk#489), i..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_warehouse_sk), IsNotNull(ws_ship_mode_sk), IsNotNull(ws_web_site_sk), IsNotNull(ws_..., ReadSchema: struct<ws_sold_date_sk:int,ws_ship_date_sk:int,ws_web_site_sk:int,ws_ship_mode_sk:int,ws_warehous...
                              :                 :                 :                 +- GpuCustomShuffleReader coalesced
                              :                 :                 :                    +- ShuffleQueryStage 1
                              :                 :                 :                       +- GpuColumnarExchange gpuhashpartitioning(w_warehouse_sk#770, 200), ENSURE_REQUIREMENTS, [id=#358062]
                              :                 :                 :                          +- GpuCoalesceBatches targetsize(2147483647)
                              :                 :                 :                             +- GpuFilter gpuisnotnull(w_warehouse_sk#770), true
                              :                 :                 :                                +- GpuFileGpuScan parquet [w_warehouse_sk#770,w_warehouse_name#772] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#770)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/warehouse.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>
                              :                 :                 +- GpuCustomShuffleReader coalesced
                              :                 :                    +- ShuffleQueryStage 2
                              :                 :                       +- GpuColumnarExchange gpuhashpartitioning(sm_ship_mode_sk#444, 200), ENSURE_REQUIREMENTS, [id=#358094]
                              :                 :                          +- GpuCoalesceBatches targetsize(2147483647)
                              :                 :                             +- GpuFilter gpuisnotnull(sm_ship_mode_sk#444), true
                              :                 :                                +- GpuFileGpuScan parquet [sm_ship_mode_sk#444,sm_type#446] Batched: true, DataFilters: [isnotnull(sm_ship_mode_sk#444)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/ship_mode.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_type:string>
                              :                 +- GpuCustomShuffleReader coalesced
                              :                    +- ShuffleQueryStage 3
                              :                       +- GpuColumnarExchange gpuhashpartitioning(web_site_sk#798, 200), ENSURE_REQUIREMENTS, [id=#358126]
                              :                          +- GpuCoalesceBatches targetsize(2147483647)
                              :                             +- GpuFilter gpuisnotnull(web_site_sk#798), true
                              :                                +- GpuFileGpuScan parquet [web_site_sk#798,web_name#802] Batched: true, DataFilters: [isnotnull(web_site_sk#798)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/web_site.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:int,web_name:string>
                              +- GpuCustomShuffleReader coalesced
                                 +- ShuffleQueryStage 4
                                    +- GpuColumnarExchange gpuhashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#358167]
                                       +- GpuProject [d_date_sk#612], true
                                          +- GpuCoalesceBatches targetsize(2147483647)
                                             +- GpuFilter (((gpuisnotnull(d_month_seq#615) AND (d_month_seq#615 >= 1217)) AND (d_month_seq#615 <= 1228)) AND gpuisnotnull(d_date_sk#612)), true
                                                +- GpuFileGpuScan parquet [d_date_sk#612,d_month_seq#615] Batched: true, DataFilters: [isnotnull(d_month_seq#615), (d_month_seq#615 >= 1217), (d_month_seq#615 <= 1228), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1217), LessThanOrEqual(d_month_seq,1228),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#20707 ASC NULLS FIRST,sm_type#446 ASC NULLS FIRST,web_name#802 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#20707,sm_type#446,web_name#802,30 days#20697L,31-60 days#20698L,61-90 days#20699L,91-120 days#20700L,>120 days#20701L])
   +- HashAggregate(keys=[_groupingexpression#20716, sm_type#446, web_name#802], functions=[sum(CASE WHEN ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 30) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 30) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 60)) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 60) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 90)) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 90) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 120)) THEN 1 ELSE 0 END), sum(CASE WHEN ((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 120) THEN 1 ELSE 0 END)], output=[substr(w_warehouse_name, 1, 20)#20707, sm_type#446, web_name#802, 30 days#20697L, 31-60 days#20698L, 61-90 days#20699L, 91-120 days#20700L, >120 days#20701L])
      +- Exchange hashpartitioning(_groupingexpression#20716, sm_type#446, web_name#802, 200), ENSURE_REQUIREMENTS, [id=#357519]
         +- HashAggregate(keys=[_groupingexpression#20716, sm_type#446, web_name#802], functions=[partial_sum(CASE WHEN ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 30) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 30) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 60)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 60) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 90)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 90) AND ((ws_ship_date_sk#478 - ws_sold_date_sk#476) <= 120)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN ((ws_ship_date_sk#478 - ws_sold_date_sk#476) > 120) THEN 1 ELSE 0 END)], output=[_groupingexpression#20716, sm_type#446, web_name#802, sum#20722L, sum#20723L, sum#20724L, sum#20725L, sum#20726L])
            +- Project [ws_sold_date_sk#476, ws_ship_date_sk#478, sm_type#446, web_name#802, substr(w_warehouse_name#772, 1, 20) AS _groupingexpression#20716]
               +- SortMergeJoin [ws_ship_date_sk#478], [d_date_sk#612], Inner
                  :- Sort [ws_ship_date_sk#478 ASC NULLS FIRST], false, 0
                  :  +- Exchange hashpartitioning(ws_ship_date_sk#478, 200), ENSURE_REQUIREMENTS, [id=#357511]
                  :     +- Project [ws_sold_date_sk#476, ws_ship_date_sk#478, w_warehouse_name#772, sm_type#446, web_name#802]
                  :        +- SortMergeJoin [ws_web_site_sk#489], [web_site_sk#798], Inner
                  :           :- Sort [ws_web_site_sk#489 ASC NULLS FIRST], false, 0
                  :           :  +- Exchange hashpartitioning(ws_web_site_sk#489, 200), ENSURE_REQUIREMENTS, [id=#357503]
                  :           :     +- Project [ws_sold_date_sk#476, ws_ship_date_sk#478, ws_web_site_sk#489, w_warehouse_name#772, sm_type#446]
                  :           :        +- SortMergeJoin [ws_ship_mode_sk#490], [sm_ship_mode_sk#444], Inner
                  :           :           :- Sort [ws_ship_mode_sk#490 ASC NULLS FIRST], false, 0
                  :           :           :  +- Exchange hashpartitioning(ws_ship_mode_sk#490, 200), ENSURE_REQUIREMENTS, [id=#357495]
                  :           :           :     +- Project [ws_sold_date_sk#476, ws_ship_date_sk#478, ws_web_site_sk#489, ws_ship_mode_sk#490, w_warehouse_name#772]
                  :           :           :        +- SortMergeJoin [ws_warehouse_sk#491], [w_warehouse_sk#770], Inner
                  :           :           :           :- Sort [ws_warehouse_sk#491 ASC NULLS FIRST], false, 0
                  :           :           :           :  +- Exchange hashpartitioning(ws_warehouse_sk#491, 200), ENSURE_REQUIREMENTS, [id=#357487]
                  :           :           :           :     +- Filter (((isnotnull(ws_warehouse_sk#491) AND isnotnull(ws_ship_mode_sk#490)) AND isnotnull(ws_web_site_sk#489)) AND isnotnull(ws_ship_date_sk#478))
                  :           :           :           :        +- FileScan parquet [ws_sold_date_sk#476,ws_ship_date_sk#478,ws_web_site_sk#489,ws_ship_mode_sk#490,ws_warehouse_sk#491] Batched: true, DataFilters: [isnotnull(ws_warehouse_sk#491), isnotnull(ws_ship_mode_sk#490), isnotnull(ws_web_site_sk#489), i..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_warehouse_sk), IsNotNull(ws_ship_mode_sk), IsNotNull(ws_web_site_sk), IsNotNull(ws_..., ReadSchema: struct<ws_sold_date_sk:int,ws_ship_date_sk:int,ws_web_site_sk:int,ws_ship_mode_sk:int,ws_warehous...
                  :           :           :           +- Sort [w_warehouse_sk#770 ASC NULLS FIRST], false, 0
                  :           :           :              +- Exchange hashpartitioning(w_warehouse_sk#770, 200), ENSURE_REQUIREMENTS, [id=#357488]
                  :           :           :                 +- Filter isnotnull(w_warehouse_sk#770)
                  :           :           :                    +- FileScan parquet [w_warehouse_sk#770,w_warehouse_name#772] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#770)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/warehouse.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>
                  :           :           +- Sort [sm_ship_mode_sk#444 ASC NULLS FIRST], false, 0
                  :           :              +- Exchange hashpartitioning(sm_ship_mode_sk#444, 200), ENSURE_REQUIREMENTS, [id=#357496]
                  :           :                 +- Filter isnotnull(sm_ship_mode_sk#444)
                  :           :                    +- FileScan parquet [sm_ship_mode_sk#444,sm_type#446] Batched: true, DataFilters: [isnotnull(sm_ship_mode_sk#444)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/ship_mode.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_type:string>
                  :           +- Sort [web_site_sk#798 ASC NULLS FIRST], false, 0
                  :              +- Exchange hashpartitioning(web_site_sk#798, 200), ENSURE_REQUIREMENTS, [id=#357504]
                  :                 +- Filter isnotnull(web_site_sk#798)
                  :                    +- FileScan parquet [web_site_sk#798,web_name#802] Batched: true, DataFilters: [isnotnull(web_site_sk#798)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_site.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:int,web_name:string>
                  +- Sort [d_date_sk#612 ASC NULLS FIRST], false, 0
                     +- Exchange hashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#357512]
                        +- Project [d_date_sk#612]
                           +- Filter (((isnotnull(d_month_seq#615) AND (d_month_seq#615 >= 1217)) AND (d_month_seq#615 <= 1228)) AND isnotnull(d_date_sk#612))
                              +- FileScan parquet [d_date_sk#612,d_month_seq#615] Batched: true, DataFilters: [isnotnull(d_month_seq#615), (d_month_seq#615 >= 1217), (d_month_seq#615 <= 1228), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1217), LessThanOrEqual(d_month_seq,1228),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
