AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#12603 ASC NULLS FIRST,sm_type#552 ASC NULLS FIRST,web_name#70 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#12603,sm_type#552,web_name#70,30 days#12593L,31-60 days#12594L,61-90 days#12595L,91-120 days#12596L,>120 days#12597L])
   +- *(6) HashAggregate(keys=[_groupingexpression#12612, sm_type#552, web_name#70], functions=[sum(CASE WHEN ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 30) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 30) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 60)) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 60) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 90)) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 90) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 120)) THEN 1 ELSE 0 END), sum(CASE WHEN ((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 120) THEN 1 ELSE 0 END)], output=[substr(w_warehouse_name, 1, 20)#12603, sm_type#552, web_name#70, 30 days#12593L, 31-60 days#12594L, 61-90 days#12595L, 91-120 days#12596L, >120 days#12597L])
      +- AQEShuffleRead coalesced
         +- ShuffleQueryStage 4
            +- Exchange hashpartitioning(_groupingexpression#12612, sm_type#552, web_name#70, 200), ENSURE_REQUIREMENTS, [id=#99187]
               +- *(5) HashAggregate(keys=[_groupingexpression#12612, sm_type#552, web_name#70], functions=[partial_sum(CASE WHEN ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 30) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 30) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 60)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 60) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 90)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 90) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 120)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN ((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 120) THEN 1 ELSE 0 END)], output=[_groupingexpression#12612, sm_type#552, web_name#70, sum#12618L, sum#12619L, sum#12620L, sum#12621L, sum#12622L])
                  +- *(5) Project [ws_sold_date_sk#384, ws_ship_date_sk#386, sm_type#552, web_name#70, substr(w_warehouse_name#188, 1, 20) AS _groupingexpression#12612]
                     +- *(5) BroadcastHashJoin [ws_ship_date_sk#386], [d_date_sk#598], Inner, BuildRight, false
                        :- *(5) Project [ws_sold_date_sk#384, ws_ship_date_sk#386, w_warehouse_name#188, sm_type#552, web_name#70]
                        :  +- *(5) BroadcastHashJoin [ws_web_site_sk#397], [web_site_sk#66], Inner, BuildRight, false
                        :     :- *(5) Project [ws_sold_date_sk#384, ws_ship_date_sk#386, ws_web_site_sk#397, w_warehouse_name#188, sm_type#552]
                        :     :  +- *(5) BroadcastHashJoin [ws_ship_mode_sk#398], [sm_ship_mode_sk#550], Inner, BuildRight, false
                        :     :     :- *(5) Project [ws_sold_date_sk#384, ws_ship_date_sk#386, ws_web_site_sk#397, ws_ship_mode_sk#398, w_warehouse_name#188]
                        :     :     :  +- *(5) BroadcastHashJoin [ws_warehouse_sk#399], [w_warehouse_sk#186], Inner, BuildRight, false
                        :     :     :     :- *(5) Filter (((isnotnull(ws_warehouse_sk#399) AND isnotnull(ws_ship_mode_sk#398)) AND isnotnull(ws_web_site_sk#397)) AND isnotnull(ws_ship_date_sk#386))
                        :     :     :     :  +- *(5) ColumnarToRow
                        :     :     :     :     +- FileScan parquet [ws_sold_date_sk#384,ws_ship_date_sk#386,ws_web_site_sk#397,ws_ship_mode_sk#398,ws_warehouse_sk#399] Batched: true, DataFilters: [isnotnull(ws_warehouse_sk#399), isnotnull(ws_ship_mode_sk#398), isnotnull(ws_web_site_sk#397), i..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_warehouse_sk), IsNotNull(ws_ship_mode_sk), IsNotNull(ws_web_site_sk), IsNotNull(ws_..., ReadSchema: struct<ws_sold_date_sk:int,ws_ship_date_sk:int,ws_web_site_sk:int,ws_ship_mode_sk:int,ws_warehous...
                        :     :     :     +- BroadcastQueryStage 0
                        :     :     :        +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#98841]
                        :     :     :           +- *(1) Filter isnotnull(w_warehouse_sk#186)
                        :     :     :              +- *(1) ColumnarToRow
                        :     :     :                 +- FileScan parquet [w_warehouse_sk#186,w_warehouse_name#188] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#186)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/warehouse.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>
                        :     :     +- BroadcastQueryStage 1
                        :     :        +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#98858]
                        :     :           +- *(2) Filter isnotnull(sm_ship_mode_sk#550)
                        :     :              +- *(2) ColumnarToRow
                        :     :                 +- FileScan parquet [sm_ship_mode_sk#550,sm_type#552] Batched: true, DataFilters: [isnotnull(sm_ship_mode_sk#550)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/ship_mode.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_type:string>
                        :     +- BroadcastQueryStage 2
                        :        +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#98875]
                        :           +- *(3) Filter isnotnull(web_site_sk#66)
                        :              +- *(3) ColumnarToRow
                        :                 +- FileScan parquet [web_site_sk#66,web_name#70] Batched: true, DataFilters: [isnotnull(web_site_sk#66)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_site.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:int,web_name:string>
                        +- BroadcastQueryStage 3
                           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#98894]
                              +- *(4) Project [d_date_sk#598]
                                 +- *(4) Filter (((isnotnull(d_month_seq#601) AND (d_month_seq#601 >= 1217)) AND (d_month_seq#601 <= 1228)) AND isnotnull(d_date_sk#598))
                                    +- *(4) ColumnarToRow
                                       +- FileScan parquet [d_date_sk#598,d_month_seq#601] Batched: true, DataFilters: [isnotnull(d_month_seq#601), (d_month_seq#601 >= 1217), (d_month_seq#601 <= 1228), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1217), LessThanOrEqual(d_month_seq,1228),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[substr(w_warehouse_name, 1, 20)#12603 ASC NULLS FIRST,sm_type#552 ASC NULLS FIRST,web_name#70 ASC NULLS FIRST], output=[substr(w_warehouse_name, 1, 20)#12603,sm_type#552,web_name#70,30 days#12593L,31-60 days#12594L,61-90 days#12595L,91-120 days#12596L,>120 days#12597L])
   +- HashAggregate(keys=[_groupingexpression#12612, sm_type#552, web_name#70], functions=[sum(CASE WHEN ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 30) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 30) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 60)) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 60) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 90)) THEN 1 ELSE 0 END), sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 90) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 120)) THEN 1 ELSE 0 END), sum(CASE WHEN ((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 120) THEN 1 ELSE 0 END)], output=[substr(w_warehouse_name, 1, 20)#12603, sm_type#552, web_name#70, 30 days#12593L, 31-60 days#12594L, 61-90 days#12595L, 91-120 days#12596L, >120 days#12597L])
      +- Exchange hashpartitioning(_groupingexpression#12612, sm_type#552, web_name#70, 200), ENSURE_REQUIREMENTS, [id=#98790]
         +- HashAggregate(keys=[_groupingexpression#12612, sm_type#552, web_name#70], functions=[partial_sum(CASE WHEN ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 30) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 30) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 60)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 60) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 90)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN (((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 90) AND ((ws_ship_date_sk#386 - ws_sold_date_sk#384) <= 120)) THEN 1 ELSE 0 END), partial_sum(CASE WHEN ((ws_ship_date_sk#386 - ws_sold_date_sk#384) > 120) THEN 1 ELSE 0 END)], output=[_groupingexpression#12612, sm_type#552, web_name#70, sum#12618L, sum#12619L, sum#12620L, sum#12621L, sum#12622L])
            +- Project [ws_sold_date_sk#384, ws_ship_date_sk#386, sm_type#552, web_name#70, substr(w_warehouse_name#188, 1, 20) AS _groupingexpression#12612]
               +- BroadcastHashJoin [ws_ship_date_sk#386], [d_date_sk#598], Inner, BuildRight, false
                  :- Project [ws_sold_date_sk#384, ws_ship_date_sk#386, w_warehouse_name#188, sm_type#552, web_name#70]
                  :  +- BroadcastHashJoin [ws_web_site_sk#397], [web_site_sk#66], Inner, BuildRight, false
                  :     :- Project [ws_sold_date_sk#384, ws_ship_date_sk#386, ws_web_site_sk#397, w_warehouse_name#188, sm_type#552]
                  :     :  +- BroadcastHashJoin [ws_ship_mode_sk#398], [sm_ship_mode_sk#550], Inner, BuildRight, false
                  :     :     :- Project [ws_sold_date_sk#384, ws_ship_date_sk#386, ws_web_site_sk#397, ws_ship_mode_sk#398, w_warehouse_name#188]
                  :     :     :  +- BroadcastHashJoin [ws_warehouse_sk#399], [w_warehouse_sk#186], Inner, BuildRight, false
                  :     :     :     :- Filter (((isnotnull(ws_warehouse_sk#399) AND isnotnull(ws_ship_mode_sk#398)) AND isnotnull(ws_web_site_sk#397)) AND isnotnull(ws_ship_date_sk#386))
                  :     :     :     :  +- FileScan parquet [ws_sold_date_sk#384,ws_ship_date_sk#386,ws_web_site_sk#397,ws_ship_mode_sk#398,ws_warehouse_sk#399] Batched: true, DataFilters: [isnotnull(ws_warehouse_sk#399), isnotnull(ws_ship_mode_sk#398), isnotnull(ws_web_site_sk#397), i..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ws_warehouse_sk), IsNotNull(ws_ship_mode_sk), IsNotNull(ws_web_site_sk), IsNotNull(ws_..., ReadSchema: struct<ws_sold_date_sk:int,ws_ship_date_sk:int,ws_web_site_sk:int,ws_ship_mode_sk:int,ws_warehous...
                  :     :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#98773]
                  :     :     :        +- Filter isnotnull(w_warehouse_sk#186)
                  :     :     :           +- FileScan parquet [w_warehouse_sk#186,w_warehouse_name#188] Batched: true, DataFilters: [isnotnull(w_warehouse_sk#186)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/warehouse.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(w_warehouse_sk)], ReadSchema: struct<w_warehouse_sk:int,w_warehouse_name:string>
                  :     :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#98777]
                  :     :        +- Filter isnotnull(sm_ship_mode_sk#550)
                  :     :           +- FileScan parquet [sm_ship_mode_sk#550,sm_type#552] Batched: true, DataFilters: [isnotnull(sm_ship_mode_sk#550)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/ship_mode.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(sm_ship_mode_sk)], ReadSchema: struct<sm_ship_mode_sk:int,sm_type:string>
                  :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, false] as bigint)),false), [id=#98781]
                  :        +- Filter isnotnull(web_site_sk#66)
                  :           +- FileScan parquet [web_site_sk#66,web_name#70] Batched: true, DataFilters: [isnotnull(web_site_sk#66)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/web_site.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(web_site_sk)], ReadSchema: struct<web_site_sk:int,web_name:string>
                  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#98785]
                     +- Project [d_date_sk#598]
                        +- Filter (((isnotnull(d_month_seq#601) AND (d_month_seq#601 >= 1217)) AND (d_month_seq#601 <= 1228)) AND isnotnull(d_date_sk#598))
                           +- FileScan parquet [d_date_sk#598,d_month_seq#601] Batched: true, DataFilters: [isnotnull(d_month_seq#601), (d_month_seq#601 >= 1217), (d_month_seq#601 <= 1228), isnotnull(d_da..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_month_seq), GreaterThanOrEqual(d_month_seq,1217), LessThanOrEqual(d_month_seq,1228),..., ReadSchema: struct<d_date_sk:int,d_month_seq:int>
