AdaptiveSparkPlan isFinalPlan=true
+- == Final Plan ==
   GpuColumnarToRow false
   +- GpuTopN(limit=100, orderBy=[c_last_name#409 ASC NULLS FIRST,c_first_name#408 ASC NULLS FIRST,gpusubstring(s_city#734, 1, 30) ASC NULLS FIRST,profit#29423 ASC NULLS FIRST], output=[c_last_name#409,c_first_name#408,substr(s_city, 1, 30)#29426,ss_ticket_number#261L,amt#29422,profit#29423])
      +- GpuShuffleCoalesce 2147483647
         +- GpuColumnarExchange gpusinglepartitioning$(), ENSURE_REQUIREMENTS, [id=#487001]
            +- GpuTopN(limit=100, orderBy=[c_last_name#409 ASC NULLS FIRST,c_first_name#408 ASC NULLS FIRST,gpusubstring(s_city#734, 1, 30) ASC NULLS FIRST,profit#29423 ASC NULLS FIRST], output=[c_last_name#409,c_first_name#408,substr(s_city, 1, 30)#29426,ss_ticket_number#261L,amt#29422,profit#29423,s_city#734])
               +- GpuProject [c_last_name#409, c_first_name#408, gpusubstring(s_city#734, 1, 30) AS substr(s_city, 1, 30)#29426, ss_ticket_number#261L, amt#29422, profit#29423, s_city#734], true
                  +- GpuShuffledHashJoin [ss_customer_sk#255], [c_customer_sk#400], Inner, GpuBuildRight, false
                     :- GpuShuffleCoalesce 2147483647
                     :  +- GpuCustomShuffleReader coalesced
                     :     +- ShuffleQueryStage 8
                     :        +- GpuColumnarExchange gpuhashpartitioning(ss_customer_sk#255, 200), ENSURE_REQUIREMENTS, [id=#486890]
                     :           +- GpuHashAggregate(keys=[ss_ticket_number#261L, ss_customer_sk#255, ss_addr_sk#258, s_city#734], functions=[gpubasicsum(UnscaledValue(ss_coupon_amt#271), LongType, false), gpubasicsum(UnscaledValue(ss_net_profit#274), LongType, false)], output=[ss_ticket_number#261L, ss_customer_sk#255, s_city#734, amt#29422, profit#29423])
                     :              +- GpuShuffleCoalesce 2147483647
                     :                 +- GpuCustomShuffleReader coalesced
                     :                    +- ShuffleQueryStage 7
                     :                       +- GpuColumnarExchange gpuhashpartitioning(ss_ticket_number#261L, ss_customer_sk#255, ss_addr_sk#258, s_city#734, 200), ENSURE_REQUIREMENTS, [id=#486800]
                     :                          +- GpuHashAggregate(keys=[ss_ticket_number#261L, ss_customer_sk#255, ss_addr_sk#258, s_city#734], functions=[partial_gpubasicsum(UnscaledValue(ss_coupon_amt#271), LongType, false), partial_gpubasicsum(UnscaledValue(ss_net_profit#274), LongType, false)], output=[ss_ticket_number#261L, ss_customer_sk#255, ss_addr_sk#258, s_city#734, sum#29435L, sum#29436L])
                     :                             +- GpuProject [ss_customer_sk#255, ss_addr_sk#258, ss_ticket_number#261L, ss_coupon_amt#271, ss_net_profit#274, s_city#734], true
                     :                                +- GpuShuffledHashJoin [ss_sold_date_sk#252], [d_date_sk#612], Inner, GpuBuildRight, false
                     :                                   :- GpuShuffleCoalesce 2147483647
                     :                                   :  +- GpuCustomShuffleReader coalesced
                     :                                   :     +- ShuffleQueryStage 6
                     :                                   :        +- GpuColumnarExchange gpuhashpartitioning(ss_sold_date_sk#252, 200), ENSURE_REQUIREMENTS, [id=#486622]
                     :                                   :           +- GpuProject [ss_sold_date_sk#252, ss_customer_sk#255, ss_addr_sk#258, ss_ticket_number#261L, ss_coupon_amt#271, ss_net_profit#274, s_city#734], true
                     :                                   :              +- GpuShuffledHashJoin [ss_hdemo_sk#257], [hd_demo_sk#88], Inner, GpuBuildRight, false
                     :                                   :                 :- GpuShuffleCoalesce 2147483647
                     :                                   :                 :  +- GpuCustomShuffleReader coalesced
                     :                                   :                 :     +- ShuffleQueryStage 5
                     :                                   :                 :        +- GpuColumnarExchange gpuhashpartitioning(ss_hdemo_sk#257, 200), ENSURE_REQUIREMENTS, [id=#486409]
                     :                                   :                 :           +- GpuProject [ss_sold_date_sk#252, ss_customer_sk#255, ss_hdemo_sk#257, ss_addr_sk#258, ss_ticket_number#261L, ss_coupon_amt#271, ss_net_profit#274, s_city#734], true
                     :                                   :                 :              +- GpuShuffledHashJoin [ss_store_sk#259], [s_store_sk#712], Inner, GpuBuildRight, false
                     :                                   :                 :                 :- GpuShuffleCoalesce 2147483647
                     :                                   :                 :                 :  +- GpuCustomShuffleReader coalesced
                     :                                   :                 :                 :     +- ShuffleQueryStage 0
                     :                                   :                 :                 :        +- GpuColumnarExchange gpuhashpartitioning(ss_store_sk#259, 200), ENSURE_REQUIREMENTS, [id=#485420]
                     :                                   :                 :                 :           +- GpuCoalesceBatches targetsize(2147483647)
                     :                                   :                 :                 :              +- GpuFilter (((gpuisnotnull(ss_store_sk#259) AND gpuisnotnull(ss_customer_sk#255)) AND gpuisnotnull(ss_hdemo_sk#257)) AND gpuisnotnull(ss_sold_date_sk#252)), true
                     :                                   :                 :                 :                 +- GpuFileGpuScan parquet [ss_sold_date_sk#252,ss_customer_sk#255,ss_hdemo_sk#257,ss_addr_sk#258,ss_store_sk#259,ss_ticket_number#261L,ss_coupon_amt#271,ss_net_profit#274] Batched: true, DataFilters: [isnotnull(ss_store_sk#259), isnotnull(ss_customer_sk#255), isnotnull(ss_hdemo_sk#257), isnotnull..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_dat..., ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_hdemo_sk:int,ss_addr_sk:int,ss_store_sk:int,ss_t...
                     :                                   :                 :                 +- GpuCustomShuffleReader coalesced
                     :                                   :                 :                    +- ShuffleQueryStage 1
                     :                                   :                 :                       +- GpuColumnarExchange gpuhashpartitioning(s_store_sk#712, 200), ENSURE_REQUIREMENTS, [id=#485457]
                     :                                   :                 :                          +- GpuProject [s_store_sk#712, s_city#734], true
                     :                                   :                 :                             +- GpuCoalesceBatches targetsize(2147483647)
                     :                                   :                 :                                +- GpuFilter (((gpuisnotnull(s_number_employees#718) AND (s_number_employees#718 >= 200)) AND (s_number_employees#718 <= 295)) AND gpuisnotnull(s_store_sk#712)), true
                     :                                   :                 :                                   +- GpuFileGpuScan parquet [s_store_sk#712,s_number_employees#718,s_city#734] Batched: true, DataFilters: [isnotnull(s_number_employees#718), (s_number_employees#718 >= 200), (s_number_employees#718 <= 2..., Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_number_employees), GreaterThanOrEqual(s_number_employees,200), LessThanOrEqual(s_num..., ReadSchema: struct<s_store_sk:int,s_number_employees:int,s_city:string>
                     :                                   :                 +- GpuCustomShuffleReader coalesced
                     :                                   :                    +- ShuffleQueryStage 2
                     :                                   :                       +- GpuColumnarExchange gpuhashpartitioning(hd_demo_sk#88, 200), ENSURE_REQUIREMENTS, [id=#485500]
                     :                                   :                          +- GpuProject [hd_demo_sk#88], true
                     :                                   :                             +- GpuCoalesceBatches targetsize(2147483647)
                     :                                   :                                +- GpuFilter (((hd_dep_count#91 = 5) OR (hd_vehicle_count#92 > 1)) AND gpuisnotnull(hd_demo_sk#88)), true
                     :                                   :                                   +- GpuFileGpuScan parquet [hd_demo_sk#88,hd_dep_count#91,hd_vehicle_count#92] Batched: true, DataFilters: [((hd_dep_count#91 = 5) OR (hd_vehicle_count#92 > 1)), isnotnull(hd_demo_sk#88)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/household_demographics.parquet], PartitionFilters: [], PushedFilters: [Or(EqualTo(hd_dep_count,5),GreaterThan(hd_vehicle_count,1)), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int,hd_vehicle_count:int>
                     :                                   +- GpuCustomShuffleReader coalesced
                     :                                      +- ShuffleQueryStage 3
                     :                                         +- GpuColumnarExchange gpuhashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#485543]
                     :                                            +- GpuProject [d_date_sk#612], true
                     :                                               +- GpuCoalesceBatches targetsize(2147483647)
                     :                                                  +- GpuFilter (((gpuisnotnull(d_dow#619) AND (d_dow#619 = 1)) AND d_year#618 INSET 2000, 2001, 2002) AND gpuisnotnull(d_date_sk#612)), true
                     :                                                     +- GpuFileGpuScan parquet [d_date_sk#612,d_year#618,d_dow#619] Batched: true, DataFilters: [isnotnull(d_dow#619), (d_dow#619 = 1), d_year#618 IN (2000,2001,2002), isnotnull(d_date_sk#612)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_dow), EqualTo(d_dow,1), In(d_year, [2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_dow:int>
                     +- GpuCustomShuffleReader coalesced
                        +- ShuffleQueryStage 4
                           +- GpuColumnarExchange gpuhashpartitioning(c_customer_sk#400, 200), ENSURE_REQUIREMENTS, [id=#485585]
                              +- GpuCoalesceBatches targetsize(2147483647)
                                 +- GpuFilter gpuisnotnull(c_customer_sk#400), true
                                    +- GpuFileGpuScan parquet [c_customer_sk#400,c_first_name#408,c_last_name#409] Batched: true, DataFilters: [isnotnull(c_customer_sk#400)], Format: Parquet, Location: InMemoryFileIndex[file:/mnt/bigdata/tpcds/sf100-parquet/customer.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string>
+- == Initial Plan ==
   TakeOrderedAndProject(limit=100, orderBy=[c_last_name#409 ASC NULLS FIRST,c_first_name#408 ASC NULLS FIRST,substr(s_city#734, 1, 30) ASC NULLS FIRST,profit#29423 ASC NULLS FIRST], output=[c_last_name#409,c_first_name#408,substr(s_city, 1, 30)#29426,ss_ticket_number#261L,amt#29422,profit#29423])
   +- Project [c_last_name#409, c_first_name#408, substr(s_city#734, 1, 30) AS substr(s_city, 1, 30)#29426, ss_ticket_number#261L, amt#29422, profit#29423, s_city#734]
      +- SortMergeJoin [ss_customer_sk#255], [c_customer_sk#400], Inner
         :- Sort [ss_customer_sk#255 ASC NULLS FIRST], false, 0
         :  +- Exchange hashpartitioning(ss_customer_sk#255, 200), ENSURE_REQUIREMENTS, [id=#484890]
         :     +- HashAggregate(keys=[ss_ticket_number#261L, ss_customer_sk#255, ss_addr_sk#258, s_city#734], functions=[sum(UnscaledValue(ss_coupon_amt#271)), sum(UnscaledValue(ss_net_profit#274))], output=[ss_ticket_number#261L, ss_customer_sk#255, s_city#734, amt#29422, profit#29423])
         :        +- Exchange hashpartitioning(ss_ticket_number#261L, ss_customer_sk#255, ss_addr_sk#258, s_city#734, 200), ENSURE_REQUIREMENTS, [id=#484886]
         :           +- HashAggregate(keys=[ss_ticket_number#261L, ss_customer_sk#255, ss_addr_sk#258, s_city#734], functions=[partial_sum(UnscaledValue(ss_coupon_amt#271)), partial_sum(UnscaledValue(ss_net_profit#274))], output=[ss_ticket_number#261L, ss_customer_sk#255, ss_addr_sk#258, s_city#734, sum#29435L, sum#29436L])
         :              +- Project [ss_customer_sk#255, ss_addr_sk#258, ss_ticket_number#261L, ss_coupon_amt#271, ss_net_profit#274, s_city#734]
         :                 +- SortMergeJoin [ss_sold_date_sk#252], [d_date_sk#612], Inner
         :                    :- Sort [ss_sold_date_sk#252 ASC NULLS FIRST], false, 0
         :                    :  +- Exchange hashpartitioning(ss_sold_date_sk#252, 200), ENSURE_REQUIREMENTS, [id=#484878]
         :                    :     +- Project [ss_sold_date_sk#252, ss_customer_sk#255, ss_addr_sk#258, ss_ticket_number#261L, ss_coupon_amt#271, ss_net_profit#274, s_city#734]
         :                    :        +- SortMergeJoin [ss_hdemo_sk#257], [hd_demo_sk#88], Inner
         :                    :           :- Sort [ss_hdemo_sk#257 ASC NULLS FIRST], false, 0
         :                    :           :  +- Exchange hashpartitioning(ss_hdemo_sk#257, 200), ENSURE_REQUIREMENTS, [id=#484870]
         :                    :           :     +- Project [ss_sold_date_sk#252, ss_customer_sk#255, ss_hdemo_sk#257, ss_addr_sk#258, ss_ticket_number#261L, ss_coupon_amt#271, ss_net_profit#274, s_city#734]
         :                    :           :        +- SortMergeJoin [ss_store_sk#259], [s_store_sk#712], Inner
         :                    :           :           :- Sort [ss_store_sk#259 ASC NULLS FIRST], false, 0
         :                    :           :           :  +- Exchange hashpartitioning(ss_store_sk#259, 200), ENSURE_REQUIREMENTS, [id=#484862]
         :                    :           :           :     +- Filter (((isnotnull(ss_store_sk#259) AND isnotnull(ss_customer_sk#255)) AND isnotnull(ss_hdemo_sk#257)) AND isnotnull(ss_sold_date_sk#252))
         :                    :           :           :        +- FileScan parquet [ss_sold_date_sk#252,ss_customer_sk#255,ss_hdemo_sk#257,ss_addr_sk#258,ss_store_sk#259,ss_ticket_number#261L,ss_coupon_amt#271,ss_net_profit#274] Batched: true, DataFilters: [isnotnull(ss_store_sk#259), isnotnull(ss_customer_sk#255), isnotnull(ss_hdemo_sk#257), isnotnull..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store_sales.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(ss_store_sk), IsNotNull(ss_customer_sk), IsNotNull(ss_hdemo_sk), IsNotNull(ss_sold_dat..., ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_hdemo_sk:int,ss_addr_sk:int,ss_store_sk:int,ss_t...
         :                    :           :           +- Sort [s_store_sk#712 ASC NULLS FIRST], false, 0
         :                    :           :              +- Exchange hashpartitioning(s_store_sk#712, 200), ENSURE_REQUIREMENTS, [id=#484863]
         :                    :           :                 +- Project [s_store_sk#712, s_city#734]
         :                    :           :                    +- Filter (((isnotnull(s_number_employees#718) AND (s_number_employees#718 >= 200)) AND (s_number_employees#718 <= 295)) AND isnotnull(s_store_sk#712))
         :                    :           :                       +- FileScan parquet [s_store_sk#712,s_number_employees#718,s_city#734] Batched: true, DataFilters: [isnotnull(s_number_employees#718), (s_number_employees#718 >= 200), (s_number_employees#718 <= 2..., Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/store.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(s_number_employees), GreaterThanOrEqual(s_number_employees,200), LessThanOrEqual(s_num..., ReadSchema: struct<s_store_sk:int,s_number_employees:int,s_city:string>
         :                    :           +- Sort [hd_demo_sk#88 ASC NULLS FIRST], false, 0
         :                    :              +- Exchange hashpartitioning(hd_demo_sk#88, 200), ENSURE_REQUIREMENTS, [id=#484871]
         :                    :                 +- Project [hd_demo_sk#88]
         :                    :                    +- Filter (((hd_dep_count#91 = 5) OR (hd_vehicle_count#92 > 1)) AND isnotnull(hd_demo_sk#88))
         :                    :                       +- FileScan parquet [hd_demo_sk#88,hd_dep_count#91,hd_vehicle_count#92] Batched: true, DataFilters: [((hd_dep_count#91 = 5) OR (hd_vehicle_count#92 > 1)), isnotnull(hd_demo_sk#88)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/household_demographics.parquet], PartitionFilters: [], PushedFilters: [Or(EqualTo(hd_dep_count,5),GreaterThan(hd_vehicle_count,1)), IsNotNull(hd_demo_sk)], ReadSchema: struct<hd_demo_sk:int,hd_dep_count:int,hd_vehicle_count:int>
         :                    +- Sort [d_date_sk#612 ASC NULLS FIRST], false, 0
         :                       +- Exchange hashpartitioning(d_date_sk#612, 200), ENSURE_REQUIREMENTS, [id=#484879]
         :                          +- Project [d_date_sk#612]
         :                             +- Filter (((isnotnull(d_dow#619) AND (d_dow#619 = 1)) AND d_year#618 IN (2000,2001,2002)) AND isnotnull(d_date_sk#612))
         :                                +- FileScan parquet [d_date_sk#612,d_year#618,d_dow#619] Batched: true, DataFilters: [isnotnull(d_dow#619), (d_dow#619 = 1), d_year#618 IN (2000,2001,2002), isnotnull(d_date_sk#612)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/date_dim.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(d_dow), EqualTo(d_dow,1), In(d_year, [2000,2001,2002]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_dow:int>
         +- Sort [c_customer_sk#400 ASC NULLS FIRST], false, 0
            +- Exchange hashpartitioning(c_customer_sk#400, 200), ENSURE_REQUIREMENTS, [id=#484891]
               +- Filter isnotnull(c_customer_sk#400)
                  +- FileScan parquet [c_customer_sk#400,c_first_name#408,c_last_name#409] Batched: true, DataFilters: [isnotnull(c_customer_sk#400)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/mnt/bigdata/tpcds/sf100-parquet/customer.parquet], PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int,c_first_name:string,c_last_name:string>
