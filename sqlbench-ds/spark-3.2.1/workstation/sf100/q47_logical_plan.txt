GlobalLimit 100
+- LocalLimit 100
   +- Sort [CheckOverflow((promote_precision(cast(sum_sales#10805 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#10806 as decimal(22,6)))), DecimalType(22,6), true) ASC NULLS FIRST, psum#10808 ASC NULLS FIRST], true
      +- Project [i_category#512, i_brand#508, d_year#604, d_moy#606, avg_monthly_sales#10806, sum_sales#10805, sum_sales#10826 AS psum#10808, sum_sales#10835 AS nsum#10809]
         +- Join Inner, (((((i_category#512 = i_category#10969) AND (i_brand#508 = i_brand#10965)) AND (s_store_name#331 = s_store_name#11035)) AND (s_company_name#343 = s_company_name#11047)) AND (rn#10807 = (rn#11063 - 1)))
            :- Project [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#10805, avg_monthly_sales#10806, rn#10807, sum_sales#10826]
            :  +- Join Inner, (((((i_category#512 = i_category#10862) AND (i_brand#508 = i_brand#10858)) AND (s_store_name#331 = s_store_name#10928)) AND (s_company_name#343 = s_company_name#10940)) AND (rn#10807 = (rn#10956 + 1)))
            :     :- Project [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, sum_sales#10805, avg_monthly_sales#10806, rn#10807]
            :     :  +- Filter ((isnotnull(avg_monthly_sales#10806) AND (avg_monthly_sales#10806 > 0.000000)) AND (CheckOverflow((promote_precision(abs(CheckOverflow((promote_precision(cast(sum_sales#10805 as decimal(22,6))) - promote_precision(cast(avg_monthly_sales#10806 as decimal(22,6)))), DecimalType(22,6), true), false)) / promote_precision(cast(avg_monthly_sales#10806 as decimal(22,6)))), DecimalType(38,16), true) > 0.1000000000000000))
            :     :     +- Window [avg(_w0#10819) windowspecdefinition(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, specifiedwindowframe(RowFrame, unboundedpreceding$(), unboundedfollowing$())) AS avg_monthly_sales#10806], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604]
            :     :        +- Filter (isnotnull(d_year#604) AND (d_year#604 = 2000))
            :     :           +- Window [rank(d_year#604, d_moy#606) windowspecdefinition(i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#10807], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343], [d_year#604 ASC NULLS FIRST, d_moy#606 ASC NULLS FIRST]
            :     :              +- Aggregate [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606], [i_category#512, i_brand#508, s_store_name#331, s_company_name#343, d_year#604, d_moy#606, MakeDecimal(sum(UnscaledValue(ss_sales_price#677)),17,2) AS sum_sales#10805, MakeDecimal(sum(UnscaledValue(ss_sales_price#677)),17,2) AS _w0#10819]
            :     :                 +- Project [i_brand#508, i_category#512, ss_sales_price#677, d_year#604, d_moy#606, s_store_name#331, s_company_name#343]
            :     :                    +- Join Inner, (ss_store_sk#671 = s_store_sk#326)
            :     :                       :- Project [i_brand#508, i_category#512, ss_store_sk#671, ss_sales_price#677, d_year#604, d_moy#606]
            :     :                       :  +- Join Inner, (ss_sold_date_sk#664 = d_date_sk#598)
            :     :                       :     :- Project [i_brand#508, i_category#512, ss_sold_date_sk#664, ss_store_sk#671, ss_sales_price#677]
            :     :                       :     :  +- Join Inner, (ss_item_sk#666 = i_item_sk#500)
            :     :                       :     :     :- Project [i_item_sk#500, i_brand#508, i_category#512]
            :     :                       :     :     :  +- Filter (isnotnull(i_item_sk#500) AND (isnotnull(i_category#512) AND isnotnull(i_brand#508)))
            :     :                       :     :     :     +- Relation [i_item_sk#500,i_item_id#501,i_rec_start_date#502,i_rec_end_date#503,i_item_desc#504,i_current_price#505,i_wholesale_cost#506,i_brand_id#507,i_brand#508,i_class_id#509,i_class#510,i_category_id#511,i_category#512,i_manufact_id#513,i_manufact#514,i_size#515,i_formulation#516,i_color#517,i_units#518,i_container#519,i_manager_id#520,i_product_name#521] parquet
            :     :                       :     :     +- Project [ss_sold_date_sk#664, ss_item_sk#666, ss_store_sk#671, ss_sales_price#677]
            :     :                       :     :        +- Filter (isnotnull(ss_item_sk#666) AND (isnotnull(ss_sold_date_sk#664) AND isnotnull(ss_store_sk#671)))
            :     :                       :     :           +- Relation [ss_sold_date_sk#664,ss_sold_time_sk#665,ss_item_sk#666,ss_customer_sk#667,ss_cdemo_sk#668,ss_hdemo_sk#669,ss_addr_sk#670,ss_store_sk#671,ss_promo_sk#672,ss_ticket_number#673L,ss_quantity#674,ss_wholesale_cost#675,ss_list_price#676,ss_sales_price#677,ss_ext_discount_amt#678,ss_ext_sales_price#679,ss_ext_wholesale_cost#680,ss_ext_list_price#681,ss_ext_tax#682,ss_coupon_amt#683,ss_net_paid#684,ss_net_paid_inc_tax#685,ss_net_profit#686] parquet
            :     :                       :     +- Project [d_date_sk#598, d_year#604, d_moy#606]
            :     :                       :        +- Filter ((((d_year#604 = 2000) OR ((d_year#604 = 1999) AND (d_moy#606 = 12))) OR ((d_year#604 = 2001) AND (d_moy#606 = 1))) AND isnotnull(d_date_sk#598))
            :     :                       :           +- Relation [d_date_sk#598,d_date_id#599,d_date#600,d_month_seq#601,d_week_seq#602,d_quarter_seq#603,d_year#604,d_dow#605,d_moy#606,d_dom#607,d_qoy#608,d_fy_year#609,d_fy_quarter_seq#610,d_fy_week_seq#611,d_day_name#612,d_quarter_name#613,d_holiday#614,d_weekend#615,d_following_holiday#616,d_first_dom#617,d_last_dom#618,d_same_day_ly#619,d_same_day_lq#620,d_current_day#621,... 4 more fields] parquet
            :     :                       +- Project [s_store_sk#326, s_store_name#331, s_company_name#343]
            :     :                          +- Filter (isnotnull(s_store_sk#326) AND (isnotnull(s_store_name#331) AND isnotnull(s_company_name#343)))
            :     :                             +- Relation [s_store_sk#326,s_store_id#327,s_rec_start_date#328,s_rec_end_date#329,s_closed_date_sk#330,s_store_name#331,s_number_employees#332,s_floor_space#333,s_hours#334,s_manager#335,s_market_id#336,s_geography_class#337,s_market_desc#338,s_market_manager#339,s_division_id#340,s_division_name#341,s_company_id#342,s_company_name#343,s_street_number#344,s_street_name#345,s_street_type#346,s_suite_number#347,s_city#348,s_county#349,... 5 more fields] parquet
            :     +- Project [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, sum_sales#10805 AS sum_sales#10826, rn#10956]
            :        +- Window [rank(d_year#10901, d_moy#10903) windowspecdefinition(i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901 ASC NULLS FIRST, d_moy#10903 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#10956], [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940], [d_year#10901 ASC NULLS FIRST, d_moy#10903 ASC NULLS FIRST]
            :           +- Aggregate [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901, d_moy#10903], [i_category#10862, i_brand#10858, s_store_name#10928, s_company_name#10940, d_year#10901, d_moy#10903, MakeDecimal(sum(UnscaledValue(ss_sales_price#10885)),17,2) AS sum_sales#10805]
            :              +- Project [i_brand#10858, i_category#10862, ss_sales_price#10885, d_year#10901, d_moy#10903, s_store_name#10928, s_company_name#10940]
            :                 +- Join Inner, (ss_store_sk#10879 = s_store_sk#10923)
            :                    :- Project [i_brand#10858, i_category#10862, ss_store_sk#10879, ss_sales_price#10885, d_year#10901, d_moy#10903]
            :                    :  +- Join Inner, (ss_sold_date_sk#10872 = d_date_sk#10895)
            :                    :     :- Project [i_brand#10858, i_category#10862, ss_sold_date_sk#10872, ss_store_sk#10879, ss_sales_price#10885]
            :                    :     :  +- Join Inner, (ss_item_sk#10874 = i_item_sk#10850)
            :                    :     :     :- Project [i_item_sk#10850, i_brand#10858, i_category#10862]
            :                    :     :     :  +- Filter (isnotnull(i_item_sk#10850) AND (isnotnull(i_category#10862) AND isnotnull(i_brand#10858)))
            :                    :     :     :     +- Relation [i_item_sk#10850,i_item_id#10851,i_rec_start_date#10852,i_rec_end_date#10853,i_item_desc#10854,i_current_price#10855,i_wholesale_cost#10856,i_brand_id#10857,i_brand#10858,i_class_id#10859,i_class#10860,i_category_id#10861,i_category#10862,i_manufact_id#10863,i_manufact#10864,i_size#10865,i_formulation#10866,i_color#10867,i_units#10868,i_container#10869,i_manager_id#10870,i_product_name#10871] parquet
            :                    :     :     +- Project [ss_sold_date_sk#10872, ss_item_sk#10874, ss_store_sk#10879, ss_sales_price#10885]
            :                    :     :        +- Filter ((isnotnull(ss_item_sk#10874) AND isnotnull(ss_sold_date_sk#10872)) AND isnotnull(ss_store_sk#10879))
            :                    :     :           +- Relation [ss_sold_date_sk#10872,ss_sold_time_sk#10873,ss_item_sk#10874,ss_customer_sk#10875,ss_cdemo_sk#10876,ss_hdemo_sk#10877,ss_addr_sk#10878,ss_store_sk#10879,ss_promo_sk#10880,ss_ticket_number#10881L,ss_quantity#10882,ss_wholesale_cost#10883,ss_list_price#10884,ss_sales_price#10885,ss_ext_discount_amt#10886,ss_ext_sales_price#10887,ss_ext_wholesale_cost#10888,ss_ext_list_price#10889,ss_ext_tax#10890,ss_coupon_amt#10891,ss_net_paid#10892,ss_net_paid_inc_tax#10893,ss_net_profit#10894] parquet
            :                    :     +- Project [d_date_sk#10895, d_year#10901, d_moy#10903]
            :                    :        +- Filter ((((d_year#10901 = 2000) OR ((d_year#10901 = 1999) AND (d_moy#10903 = 12))) OR ((d_year#10901 = 2001) AND (d_moy#10903 = 1))) AND isnotnull(d_date_sk#10895))
            :                    :           +- Relation [d_date_sk#10895,d_date_id#10896,d_date#10897,d_month_seq#10898,d_week_seq#10899,d_quarter_seq#10900,d_year#10901,d_dow#10902,d_moy#10903,d_dom#10904,d_qoy#10905,d_fy_year#10906,d_fy_quarter_seq#10907,d_fy_week_seq#10908,d_day_name#10909,d_quarter_name#10910,d_holiday#10911,d_weekend#10912,d_following_holiday#10913,d_first_dom#10914,d_last_dom#10915,d_same_day_ly#10916,d_same_day_lq#10917,d_current_day#10918,... 4 more fields] parquet
            :                    +- Project [s_store_sk#10923, s_store_name#10928, s_company_name#10940]
            :                       +- Filter (isnotnull(s_store_sk#10923) AND (isnotnull(s_store_name#10928) AND isnotnull(s_company_name#10940)))
            :                          +- Relation [s_store_sk#10923,s_store_id#10924,s_rec_start_date#10925,s_rec_end_date#10926,s_closed_date_sk#10927,s_store_name#10928,s_number_employees#10929,s_floor_space#10930,s_hours#10931,s_manager#10932,s_market_id#10933,s_geography_class#10934,s_market_desc#10935,s_market_manager#10936,s_division_id#10937,s_division_name#10938,s_company_id#10939,s_company_name#10940,s_street_number#10941,s_street_name#10942,s_street_type#10943,s_suite_number#10944,s_city#10945,s_county#10946,... 5 more fields] parquet
            +- Project [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, sum_sales#10805 AS sum_sales#10835, rn#11063]
               +- Window [rank(d_year#11008, d_moy#11010) windowspecdefinition(i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008 ASC NULLS FIRST, d_moy#11010 ASC NULLS FIRST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS rn#11063], [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047], [d_year#11008 ASC NULLS FIRST, d_moy#11010 ASC NULLS FIRST]
                  +- Aggregate [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008, d_moy#11010], [i_category#10969, i_brand#10965, s_store_name#11035, s_company_name#11047, d_year#11008, d_moy#11010, MakeDecimal(sum(UnscaledValue(ss_sales_price#10992)),17,2) AS sum_sales#10805]
                     +- Project [i_brand#10965, i_category#10969, ss_sales_price#10992, d_year#11008, d_moy#11010, s_store_name#11035, s_company_name#11047]
                        +- Join Inner, (ss_store_sk#10986 = s_store_sk#11030)
                           :- Project [i_brand#10965, i_category#10969, ss_store_sk#10986, ss_sales_price#10992, d_year#11008, d_moy#11010]
                           :  +- Join Inner, (ss_sold_date_sk#10979 = d_date_sk#11002)
                           :     :- Project [i_brand#10965, i_category#10969, ss_sold_date_sk#10979, ss_store_sk#10986, ss_sales_price#10992]
                           :     :  +- Join Inner, (ss_item_sk#10981 = i_item_sk#10957)
                           :     :     :- Project [i_item_sk#10957, i_brand#10965, i_category#10969]
                           :     :     :  +- Filter (isnotnull(i_item_sk#10957) AND (isnotnull(i_category#10969) AND isnotnull(i_brand#10965)))
                           :     :     :     +- Relation [i_item_sk#10957,i_item_id#10958,i_rec_start_date#10959,i_rec_end_date#10960,i_item_desc#10961,i_current_price#10962,i_wholesale_cost#10963,i_brand_id#10964,i_brand#10965,i_class_id#10966,i_class#10967,i_category_id#10968,i_category#10969,i_manufact_id#10970,i_manufact#10971,i_size#10972,i_formulation#10973,i_color#10974,i_units#10975,i_container#10976,i_manager_id#10977,i_product_name#10978] parquet
                           :     :     +- Project [ss_sold_date_sk#10979, ss_item_sk#10981, ss_store_sk#10986, ss_sales_price#10992]
                           :     :        +- Filter ((isnotnull(ss_item_sk#10981) AND isnotnull(ss_sold_date_sk#10979)) AND isnotnull(ss_store_sk#10986))
                           :     :           +- Relation [ss_sold_date_sk#10979,ss_sold_time_sk#10980,ss_item_sk#10981,ss_customer_sk#10982,ss_cdemo_sk#10983,ss_hdemo_sk#10984,ss_addr_sk#10985,ss_store_sk#10986,ss_promo_sk#10987,ss_ticket_number#10988L,ss_quantity#10989,ss_wholesale_cost#10990,ss_list_price#10991,ss_sales_price#10992,ss_ext_discount_amt#10993,ss_ext_sales_price#10994,ss_ext_wholesale_cost#10995,ss_ext_list_price#10996,ss_ext_tax#10997,ss_coupon_amt#10998,ss_net_paid#10999,ss_net_paid_inc_tax#11000,ss_net_profit#11001] parquet
                           :     +- Project [d_date_sk#11002, d_year#11008, d_moy#11010]
                           :        +- Filter ((((d_year#11008 = 2000) OR ((d_year#11008 = 1999) AND (d_moy#11010 = 12))) OR ((d_year#11008 = 2001) AND (d_moy#11010 = 1))) AND isnotnull(d_date_sk#11002))
                           :           +- Relation [d_date_sk#11002,d_date_id#11003,d_date#11004,d_month_seq#11005,d_week_seq#11006,d_quarter_seq#11007,d_year#11008,d_dow#11009,d_moy#11010,d_dom#11011,d_qoy#11012,d_fy_year#11013,d_fy_quarter_seq#11014,d_fy_week_seq#11015,d_day_name#11016,d_quarter_name#11017,d_holiday#11018,d_weekend#11019,d_following_holiday#11020,d_first_dom#11021,d_last_dom#11022,d_same_day_ly#11023,d_same_day_lq#11024,d_current_day#11025,... 4 more fields] parquet
                           +- Project [s_store_sk#11030, s_store_name#11035, s_company_name#11047]
                              +- Filter (isnotnull(s_store_sk#11030) AND (isnotnull(s_store_name#11035) AND isnotnull(s_company_name#11047)))
                                 +- Relation [s_store_sk#11030,s_store_id#11031,s_rec_start_date#11032,s_rec_end_date#11033,s_closed_date_sk#11034,s_store_name#11035,s_number_employees#11036,s_floor_space#11037,s_hours#11038,s_manager#11039,s_market_id#11040,s_geography_class#11041,s_market_desc#11042,s_market_manager#11043,s_division_id#11044,s_division_name#11045,s_company_id#11046,s_company_name#11047,s_street_number#11048,s_street_name#11049,s_street_type#11050,s_suite_number#11051,s_city#11052,s_county#11053,... 5 more fields] parquet
