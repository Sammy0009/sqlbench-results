GlobalLimit 100
+- LocalLimit 100
   +- Project [ss_customer_sk#667, ratio#17413, store_qty#17414L, store_wholesale_cost#17415, store_sales_price#17416, other_chan_qty#17417L, other_chan_wholesale_cost#17418, other_chan_sales_price#17419]
      +- Sort [ss_customer_sk#667 ASC NULLS FIRST, ss_qty#17431L DESC NULLS LAST, ss_wc#17432 DESC NULLS LAST, ss_sp#17433 DESC NULLS LAST, other_chan_qty#17417L ASC NULLS FIRST, other_chan_wholesale_cost#17418 ASC NULLS FIRST, other_chan_sales_price#17419 ASC NULLS FIRST, ratio#17413 ASC NULLS FIRST], true
         +- Project [ss_customer_sk#667, round((cast(ss_qty#17431L as double) / cast((coalesce(ws_qty#17422L, 0) + coalesce(cs_qty#17427L, 0)) as double)), 2) AS ratio#17413, ss_qty#17431L AS store_qty#17414L, ss_wc#17432 AS store_wholesale_cost#17415, ss_sp#17433 AS store_sales_price#17416, (coalesce(ws_qty#17422L, 0) + coalesce(cs_qty#17427L, 0)) AS other_chan_qty#17417L, CheckOverflow((promote_precision(cast(coalesce(ws_wc#17423, 0.00) as decimal(18,2))) + promote_precision(cast(coalesce(cs_wc#17428, 0.00) as decimal(18,2)))), DecimalType(18,2), true) AS other_chan_wholesale_cost#17418, CheckOverflow((promote_precision(cast(coalesce(ws_sp#17424, 0.00) as decimal(18,2))) + promote_precision(cast(coalesce(cs_sp#17429, 0.00) as decimal(18,2)))), DecimalType(18,2), true) AS other_chan_sales_price#17419, ss_qty#17431L, ss_wc#17432, ss_sp#17433]
            +- Filter ((coalesce(ws_qty#17422L, 0) > 0) OR (coalesce(cs_qty#17427L, 0) > 0))
               +- Join LeftOuter, (((cs_sold_year#17425 = ss_sold_year#17430) AND (cs_item_sk#133 = ss_item_sk#666)) AND (cs_customer_sk#17426 = ss_customer_sk#667))
                  :- Project [ss_sold_year#17430, ss_item_sk#666, ss_customer_sk#667, ss_qty#17431L, ss_wc#17432, ss_sp#17433, ws_qty#17422L, ws_wc#17423, ws_sp#17424]
                  :  +- Join LeftOuter, (((ws_sold_year#17420 = ss_sold_year#17430) AND (ws_item_sk#387 = ss_item_sk#666)) AND (ws_customer_sk#17421 = ss_customer_sk#667))
                  :     :- Aggregate [d_year#17468, ss_item_sk#666, ss_customer_sk#667], [d_year#17468 AS ss_sold_year#17430, ss_item_sk#666, ss_customer_sk#667, sum(ss_quantity#674) AS ss_qty#17431L, MakeDecimal(sum(UnscaledValue(ss_wholesale_cost#675)),17,2) AS ss_wc#17432, MakeDecimal(sum(UnscaledValue(ss_sales_price#677)),17,2) AS ss_sp#17433]
                  :     :  +- Project [ss_item_sk#666, ss_customer_sk#667, ss_quantity#674, ss_wholesale_cost#675, ss_sales_price#677, d_year#17468]
                  :     :     +- Join Inner, (ss_sold_date_sk#664 = d_date_sk#17462)
                  :     :        :- Project [ss_sold_date_sk#664, ss_item_sk#666, ss_customer_sk#667, ss_quantity#674, ss_wholesale_cost#675, ss_sales_price#677]
                  :     :        :  +- Filter isnull(sr_ticket_number#719L)
                  :     :        :     +- Join LeftOuter, ((sr_ticket_number#719L = ss_ticket_number#673L) AND (ss_item_sk#666 = sr_item_sk#712))
                  :     :        :        :- Project [ss_sold_date_sk#664, ss_item_sk#666, ss_customer_sk#667, ss_ticket_number#673L, ss_quantity#674, ss_wholesale_cost#675, ss_sales_price#677]
                  :     :        :        :  +- Filter isnotnull(ss_sold_date_sk#664)
                  :     :        :        :     +- Relation [ss_sold_date_sk#664,ss_sold_time_sk#665,ss_item_sk#666,ss_customer_sk#667,ss_cdemo_sk#668,ss_hdemo_sk#669,ss_addr_sk#670,ss_store_sk#671,ss_promo_sk#672,ss_ticket_number#673L,ss_quantity#674,ss_wholesale_cost#675,ss_list_price#676,ss_sales_price#677,ss_ext_discount_amt#678,ss_ext_sales_price#679,ss_ext_wholesale_cost#680,ss_ext_list_price#681,ss_ext_tax#682,ss_coupon_amt#683,ss_net_paid#684,ss_net_paid_inc_tax#685,ss_net_profit#686] parquet
                  :     :        :        +- Project [sr_item_sk#712, sr_ticket_number#719L]
                  :     :        :           +- Filter (isnotnull(sr_ticket_number#719L) AND isnotnull(sr_item_sk#712))
                  :     :        :              +- Relation [sr_returned_date_sk#710,sr_return_time_sk#711,sr_item_sk#712,sr_customer_sk#713,sr_cdemo_sk#714,sr_hdemo_sk#715,sr_addr_sk#716,sr_store_sk#717,sr_reason_sk#718,sr_ticket_number#719L,sr_return_quantity#720,sr_return_amt#721,sr_return_tax#722,sr_return_amt_inc_tax#723,sr_fee#724,sr_return_ship_cost#725,sr_refunded_cash#726,sr_reversed_charge#727,sr_store_credit#728,sr_net_loss#729] parquet
                  :     :        +- Project [d_date_sk#17462, d_year#17468]
                  :     :           +- Filter ((isnotnull(d_year#17468) AND (d_year#17468 = 2001)) AND isnotnull(d_date_sk#17462))
                  :     :              +- Relation [d_date_sk#17462,d_date_id#17463,d_date#17464,d_month_seq#17465,d_week_seq#17466,d_quarter_seq#17467,d_year#17468,d_dow#17469,d_moy#17470,d_dom#17471,d_qoy#17472,d_fy_year#17473,d_fy_quarter_seq#17474,d_fy_week_seq#17475,d_day_name#17476,d_quarter_name#17477,d_holiday#17478,d_weekend#17479,d_following_holiday#17480,d_first_dom#17481,d_last_dom#17482,d_same_day_ly#17483,d_same_day_lq#17484,d_current_day#17485,... 4 more fields] parquet
                  :     +- Aggregate [d_year#604, ws_item_sk#387, ws_bill_customer_sk#388], [d_year#604 AS ws_sold_year#17420, ws_item_sk#387, ws_bill_customer_sk#388 AS ws_customer_sk#17421, sum(ws_quantity#402) AS ws_qty#17422L, MakeDecimal(sum(UnscaledValue(ws_wholesale_cost#403)),17,2) AS ws_wc#17423, MakeDecimal(sum(UnscaledValue(ws_sales_price#405)),17,2) AS ws_sp#17424]
                  :        +- Project [ws_item_sk#387, ws_bill_customer_sk#388, ws_quantity#402, ws_wholesale_cost#403, ws_sales_price#405, d_year#604]
                  :           +- Join Inner, (ws_sold_date_sk#384 = d_date_sk#598)
                  :              :- Project [ws_sold_date_sk#384, ws_item_sk#387, ws_bill_customer_sk#388, ws_quantity#402, ws_wholesale_cost#403, ws_sales_price#405]
                  :              :  +- Filter isnull(wr_order_number#465L)
                  :              :     +- Join LeftOuter, ((wr_order_number#465L = ws_order_number#401L) AND (ws_item_sk#387 = wr_item_sk#454))
                  :              :        :- Project [ws_sold_date_sk#384, ws_item_sk#387, ws_bill_customer_sk#388, ws_order_number#401L, ws_quantity#402, ws_wholesale_cost#403, ws_sales_price#405]
                  :              :        :  +- Filter ((isnotnull(ws_sold_date_sk#384) AND isnotnull(ws_item_sk#387)) AND isnotnull(ws_bill_customer_sk#388))
                  :              :        :     +- Relation [ws_sold_date_sk#384,ws_sold_time_sk#385,ws_ship_date_sk#386,ws_item_sk#387,ws_bill_customer_sk#388,ws_bill_cdemo_sk#389,ws_bill_hdemo_sk#390,ws_bill_addr_sk#391,ws_ship_customer_sk#392,ws_ship_cdemo_sk#393,ws_ship_hdemo_sk#394,ws_ship_addr_sk#395,ws_web_page_sk#396,ws_web_site_sk#397,ws_ship_mode_sk#398,ws_warehouse_sk#399,ws_promo_sk#400,ws_order_number#401L,ws_quantity#402,ws_wholesale_cost#403,ws_list_price#404,ws_sales_price#405,ws_ext_discount_amt#406,ws_ext_sales_price#407,... 10 more fields] parquet
                  :              :        +- Project [wr_item_sk#454, wr_order_number#465L]
                  :              :           +- Filter (isnotnull(wr_order_number#465L) AND isnotnull(wr_item_sk#454))
                  :              :              +- Relation [wr_returned_date_sk#452,wr_returned_time_sk#453,wr_item_sk#454,wr_refunded_customer_sk#455,wr_refunded_cdemo_sk#456,wr_refunded_hdemo_sk#457,wr_refunded_addr_sk#458,wr_returning_customer_sk#459,wr_returning_cdemo_sk#460,wr_returning_hdemo_sk#461,wr_returning_addr_sk#462,wr_web_page_sk#463,wr_reason_sk#464,wr_order_number#465L,wr_return_quantity#466,wr_return_amt#467,wr_return_tax#468,wr_return_amt_inc_tax#469,wr_fee#470,wr_return_ship_cost#471,wr_refunded_cash#472,wr_reversed_charge#473,wr_account_credit#474,wr_net_loss#475] parquet
                  :              +- Project [d_date_sk#598, d_year#604]
                  :                 +- Filter (isnotnull(d_date_sk#598) AND ((d_year#604 = 2001) AND isnotnull(d_year#604)))
                  :                    +- Relation [d_date_sk#598,d_date_id#599,d_date#600,d_month_seq#601,d_week_seq#602,d_quarter_seq#603,d_year#604,d_dow#605,d_moy#606,d_dom#607,d_qoy#608,d_fy_year#609,d_fy_quarter_seq#610,d_fy_week_seq#611,d_day_name#612,d_quarter_name#613,d_holiday#614,d_weekend#615,d_following_holiday#616,d_first_dom#617,d_last_dom#618,d_same_day_ly#619,d_same_day_lq#620,d_current_day#621,... 4 more fields] parquet
                  +- Aggregate [d_year#17440, cs_item_sk#133, cs_bill_customer_sk#121], [d_year#17440 AS cs_sold_year#17425, cs_item_sk#133, cs_bill_customer_sk#121 AS cs_customer_sk#17426, sum(cs_quantity#136) AS cs_qty#17427L, MakeDecimal(sum(UnscaledValue(cs_wholesale_cost#137)),17,2) AS cs_wc#17428, MakeDecimal(sum(UnscaledValue(cs_sales_price#139)),17,2) AS cs_sp#17429]
                     +- Project [cs_bill_customer_sk#121, cs_item_sk#133, cs_quantity#136, cs_wholesale_cost#137, cs_sales_price#139, d_year#17440]
                        +- Join Inner, (cs_sold_date_sk#118 = d_date_sk#17434)
                           :- Project [cs_sold_date_sk#118, cs_bill_customer_sk#121, cs_item_sk#133, cs_quantity#136, cs_wholesale_cost#137, cs_sales_price#139]
                           :  +- Filter isnull(cr_order_number#264L)
                           :     +- Join LeftOuter, ((cr_order_number#264L = cs_order_number#135L) AND (cs_item_sk#133 = cr_item_sk#250))
                           :        :- Project [cs_sold_date_sk#118, cs_bill_customer_sk#121, cs_item_sk#133, cs_order_number#135L, cs_quantity#136, cs_wholesale_cost#137, cs_sales_price#139]
                           :        :  +- Filter ((isnotnull(cs_sold_date_sk#118) AND isnotnull(cs_item_sk#133)) AND isnotnull(cs_bill_customer_sk#121))
                           :        :     +- Relation [cs_sold_date_sk#118,cs_sold_time_sk#119,cs_ship_date_sk#120,cs_bill_customer_sk#121,cs_bill_cdemo_sk#122,cs_bill_hdemo_sk#123,cs_bill_addr_sk#124,cs_ship_customer_sk#125,cs_ship_cdemo_sk#126,cs_ship_hdemo_sk#127,cs_ship_addr_sk#128,cs_call_center_sk#129,cs_catalog_page_sk#130,cs_ship_mode_sk#131,cs_warehouse_sk#132,cs_item_sk#133,cs_promo_sk#134,cs_order_number#135L,cs_quantity#136,cs_wholesale_cost#137,cs_list_price#138,cs_sales_price#139,cs_ext_discount_amt#140,cs_ext_sales_price#141,... 10 more fields] parquet
                           :        +- Project [cr_item_sk#250, cr_order_number#264L]
                           :           +- Filter (isnotnull(cr_order_number#264L) AND isnotnull(cr_item_sk#250))
                           :              +- Relation [cr_returned_date_sk#248,cr_returned_time_sk#249,cr_item_sk#250,cr_refunded_customer_sk#251,cr_refunded_cdemo_sk#252,cr_refunded_hdemo_sk#253,cr_refunded_addr_sk#254,cr_returning_customer_sk#255,cr_returning_cdemo_sk#256,cr_returning_hdemo_sk#257,cr_returning_addr_sk#258,cr_call_center_sk#259,cr_catalog_page_sk#260,cr_ship_mode_sk#261,cr_warehouse_sk#262,cr_reason_sk#263,cr_order_number#264L,cr_return_quantity#265,cr_return_amount#266,cr_return_tax#267,cr_return_amt_inc_tax#268,cr_fee#269,cr_return_ship_cost#270,cr_refunded_cash#271,... 3 more fields] parquet
                           +- Project [d_date_sk#17434, d_year#17440]
                              +- Filter (isnotnull(d_date_sk#17434) AND ((d_year#17440 = 2001) AND isnotnull(d_year#17440)))
                                 +- Relation [d_date_sk#17434,d_date_id#17435,d_date#17436,d_month_seq#17437,d_week_seq#17438,d_quarter_seq#17439,d_year#17440,d_dow#17441,d_moy#17442,d_dom#17443,d_qoy#17444,d_fy_year#17445,d_fy_quarter_seq#17446,d_fy_week_seq#17447,d_day_name#17448,d_quarter_name#17449,d_holiday#17450,d_weekend#17451,d_following_holiday#17452,d_first_dom#17453,d_last_dom#17454,d_same_day_ly#17455,d_same_day_lq#17456,d_current_day#17457,... 4 more fields] parquet
