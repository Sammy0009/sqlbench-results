GlobalLimit 100
+- LocalLimit 100
   +- Project [ss_customer_sk#667, ratio#18790, store_qty#18791L, store_wholesale_cost#18792, store_sales_price#18793, other_chan_qty#18794L, other_chan_wholesale_cost#18795, other_chan_sales_price#18796]
      +- Sort [ss_customer_sk#667 ASC NULLS FIRST, ss_qty#18808L DESC NULLS LAST, ss_wc#18809 DESC NULLS LAST, ss_sp#18810 DESC NULLS LAST, other_chan_qty#18794L ASC NULLS FIRST, other_chan_wholesale_cost#18795 ASC NULLS FIRST, other_chan_sales_price#18796 ASC NULLS FIRST, ratio#18790 ASC NULLS FIRST], true
         +- Project [ss_customer_sk#667, round((cast(ss_qty#18808L as double) / cast((coalesce(ws_qty#18799L, 0) + coalesce(cs_qty#18804L, 0)) as double)), 2) AS ratio#18790, ss_qty#18808L AS store_qty#18791L, ss_wc#18809 AS store_wholesale_cost#18792, ss_sp#18810 AS store_sales_price#18793, (coalesce(ws_qty#18799L, 0) + coalesce(cs_qty#18804L, 0)) AS other_chan_qty#18794L, CheckOverflow((promote_precision(cast(coalesce(ws_wc#18800, 0.00) as decimal(18,2))) + promote_precision(cast(coalesce(cs_wc#18805, 0.00) as decimal(18,2)))), DecimalType(18,2), true) AS other_chan_wholesale_cost#18795, CheckOverflow((promote_precision(cast(coalesce(ws_sp#18801, 0.00) as decimal(18,2))) + promote_precision(cast(coalesce(cs_sp#18806, 0.00) as decimal(18,2)))), DecimalType(18,2), true) AS other_chan_sales_price#18796, ss_qty#18808L, ss_wc#18809, ss_sp#18810]
            +- Filter ((coalesce(ws_qty#18799L, 0) > 0) OR (coalesce(cs_qty#18804L, 0) > 0))
               +- Join LeftOuter, (((cs_sold_year#18802 = ss_sold_year#18807) AND (cs_item_sk#133 = ss_item_sk#666)) AND (cs_customer_sk#18803 = ss_customer_sk#667))
                  :- Project [ss_sold_year#18807, ss_item_sk#666, ss_customer_sk#667, ss_qty#18808L, ss_wc#18809, ss_sp#18810, ws_qty#18799L, ws_wc#18800, ws_sp#18801]
                  :  +- Join LeftOuter, (((ws_sold_year#18797 = ss_sold_year#18807) AND (ws_item_sk#387 = ss_item_sk#666)) AND (ws_customer_sk#18798 = ss_customer_sk#667))
                  :     :- Aggregate [d_year#18845, ss_item_sk#666, ss_customer_sk#667], [d_year#18845 AS ss_sold_year#18807, ss_item_sk#666, ss_customer_sk#667, sum(ss_quantity#674) AS ss_qty#18808L, MakeDecimal(sum(UnscaledValue(ss_wholesale_cost#675)),17,2) AS ss_wc#18809, MakeDecimal(sum(UnscaledValue(ss_sales_price#677)),17,2) AS ss_sp#18810]
                  :     :  +- Project [ss_item_sk#666, ss_customer_sk#667, ss_quantity#674, ss_wholesale_cost#675, ss_sales_price#677, d_year#18845]
                  :     :     +- Join Inner, (ss_sold_date_sk#664 = d_date_sk#18839)
                  :     :        :- Project [ss_sold_date_sk#664, ss_item_sk#666, ss_customer_sk#667, ss_quantity#674, ss_wholesale_cost#675, ss_sales_price#677]
                  :     :        :  +- Filter isnull(sr_ticket_number#719L)
                  :     :        :     +- Join LeftOuter, ((sr_ticket_number#719L = ss_ticket_number#673L) AND (ss_item_sk#666 = sr_item_sk#712))
                  :     :        :        :- Project [ss_sold_date_sk#664, ss_item_sk#666, ss_customer_sk#667, ss_ticket_number#673L, ss_quantity#674, ss_wholesale_cost#675, ss_sales_price#677]
                  :     :        :        :  +- Filter isnotnull(ss_sold_date_sk#664)
                  :     :        :        :     +- Relation [ss_sold_date_sk#664,ss_sold_time_sk#665,ss_item_sk#666,ss_customer_sk#667,ss_cdemo_sk#668,ss_hdemo_sk#669,ss_addr_sk#670,ss_store_sk#671,ss_promo_sk#672,ss_ticket_number#673L,ss_quantity#674,ss_wholesale_cost#675,ss_list_price#676,ss_sales_price#677,ss_ext_discount_amt#678,ss_ext_sales_price#679,ss_ext_wholesale_cost#680,ss_ext_list_price#681,ss_ext_tax#682,ss_coupon_amt#683,ss_net_paid#684,ss_net_paid_inc_tax#685,ss_net_profit#686] parquet
                  :     :        :        +- Project [sr_item_sk#712, sr_ticket_number#719L]
                  :     :        :           +- Filter (isnotnull(sr_ticket_number#719L) AND isnotnull(sr_item_sk#712))
                  :     :        :              +- Relation [sr_returned_date_sk#710,sr_return_time_sk#711,sr_item_sk#712,sr_customer_sk#713,sr_cdemo_sk#714,sr_hdemo_sk#715,sr_addr_sk#716,sr_store_sk#717,sr_reason_sk#718,sr_ticket_number#719L,sr_return_quantity#720,sr_return_amt#721,sr_return_tax#722,sr_return_amt_inc_tax#723,sr_fee#724,sr_return_ship_cost#725,sr_refunded_cash#726,sr_reversed_charge#727,sr_store_credit#728,sr_net_loss#729] parquet
                  :     :        +- Project [d_date_sk#18839, d_year#18845]
                  :     :           +- Filter ((isnotnull(d_year#18845) AND (d_year#18845 = 2001)) AND isnotnull(d_date_sk#18839))
                  :     :              +- Relation [d_date_sk#18839,d_date_id#18840,d_date#18841,d_month_seq#18842,d_week_seq#18843,d_quarter_seq#18844,d_year#18845,d_dow#18846,d_moy#18847,d_dom#18848,d_qoy#18849,d_fy_year#18850,d_fy_quarter_seq#18851,d_fy_week_seq#18852,d_day_name#18853,d_quarter_name#18854,d_holiday#18855,d_weekend#18856,d_following_holiday#18857,d_first_dom#18858,d_last_dom#18859,d_same_day_ly#18860,d_same_day_lq#18861,d_current_day#18862,... 4 more fields] parquet
                  :     +- Aggregate [d_year#604, ws_item_sk#387, ws_bill_customer_sk#388], [d_year#604 AS ws_sold_year#18797, ws_item_sk#387, ws_bill_customer_sk#388 AS ws_customer_sk#18798, sum(ws_quantity#402) AS ws_qty#18799L, MakeDecimal(sum(UnscaledValue(ws_wholesale_cost#403)),17,2) AS ws_wc#18800, MakeDecimal(sum(UnscaledValue(ws_sales_price#405)),17,2) AS ws_sp#18801]
                  :        +- Project [ws_item_sk#387, ws_bill_customer_sk#388, ws_quantity#402, ws_wholesale_cost#403, ws_sales_price#405, d_year#604]
                  :           +- Join Inner, (ws_sold_date_sk#384 = d_date_sk#598)
                  :              :- Project [ws_sold_date_sk#384, ws_item_sk#387, ws_bill_customer_sk#388, ws_quantity#402, ws_wholesale_cost#403, ws_sales_price#405]
                  :              :  +- Filter isnull(wr_order_number#465L)
                  :              :     +- Join LeftOuter, ((wr_order_number#465L = ws_order_number#401L) AND (ws_item_sk#387 = wr_item_sk#454))
                  :              :        :- Project [ws_sold_date_sk#384, ws_item_sk#387, ws_bill_customer_sk#388, ws_order_number#401L, ws_quantity#402, ws_wholesale_cost#403, ws_sales_price#405]
                  :              :        :  +- Filter ((isnotnull(ws_sold_date_sk#384) AND isnotnull(ws_item_sk#387)) AND isnotnull(ws_bill_customer_sk#388))
                  :              :        :     +- Relation [ws_sold_date_sk#384,ws_sold_time_sk#385,ws_ship_date_sk#386,ws_item_sk#387,ws_bill_customer_sk#388,ws_bill_cdemo_sk#389,ws_bill_hdemo_sk#390,ws_bill_addr_sk#391,ws_ship_customer_sk#392,ws_ship_cdemo_sk#393,ws_ship_hdemo_sk#394,ws_ship_addr_sk#395,ws_web_page_sk#396,ws_web_site_sk#397,ws_ship_mode_sk#398,ws_warehouse_sk#399,ws_promo_sk#400,ws_order_number#401L,ws_quantity#402,ws_wholesale_cost#403,ws_list_price#404,ws_sales_price#405,ws_ext_discount_amt#406,ws_ext_sales_price#407,... 10 more fields] parquet
                  :              :        +- Project [wr_item_sk#454, wr_order_number#465L]
                  :              :           +- Filter (isnotnull(wr_order_number#465L) AND isnotnull(wr_item_sk#454))
                  :              :              +- Relation [wr_returned_date_sk#452,wr_returned_time_sk#453,wr_item_sk#454,wr_refunded_customer_sk#455,wr_refunded_cdemo_sk#456,wr_refunded_hdemo_sk#457,wr_refunded_addr_sk#458,wr_returning_customer_sk#459,wr_returning_cdemo_sk#460,wr_returning_hdemo_sk#461,wr_returning_addr_sk#462,wr_web_page_sk#463,wr_reason_sk#464,wr_order_number#465L,wr_return_quantity#466,wr_return_amt#467,wr_return_tax#468,wr_return_amt_inc_tax#469,wr_fee#470,wr_return_ship_cost#471,wr_refunded_cash#472,wr_reversed_charge#473,wr_account_credit#474,wr_net_loss#475] parquet
                  :              +- Project [d_date_sk#598, d_year#604]
                  :                 +- Filter (isnotnull(d_date_sk#598) AND ((d_year#604 = 2001) AND isnotnull(d_year#604)))
                  :                    +- Relation [d_date_sk#598,d_date_id#599,d_date#600,d_month_seq#601,d_week_seq#602,d_quarter_seq#603,d_year#604,d_dow#605,d_moy#606,d_dom#607,d_qoy#608,d_fy_year#609,d_fy_quarter_seq#610,d_fy_week_seq#611,d_day_name#612,d_quarter_name#613,d_holiday#614,d_weekend#615,d_following_holiday#616,d_first_dom#617,d_last_dom#618,d_same_day_ly#619,d_same_day_lq#620,d_current_day#621,... 4 more fields] parquet
                  +- Aggregate [d_year#18817, cs_item_sk#133, cs_bill_customer_sk#121], [d_year#18817 AS cs_sold_year#18802, cs_item_sk#133, cs_bill_customer_sk#121 AS cs_customer_sk#18803, sum(cs_quantity#136) AS cs_qty#18804L, MakeDecimal(sum(UnscaledValue(cs_wholesale_cost#137)),17,2) AS cs_wc#18805, MakeDecimal(sum(UnscaledValue(cs_sales_price#139)),17,2) AS cs_sp#18806]
                     +- Project [cs_bill_customer_sk#121, cs_item_sk#133, cs_quantity#136, cs_wholesale_cost#137, cs_sales_price#139, d_year#18817]
                        +- Join Inner, (cs_sold_date_sk#118 = d_date_sk#18811)
                           :- Project [cs_sold_date_sk#118, cs_bill_customer_sk#121, cs_item_sk#133, cs_quantity#136, cs_wholesale_cost#137, cs_sales_price#139]
                           :  +- Filter isnull(cr_order_number#264L)
                           :     +- Join LeftOuter, ((cr_order_number#264L = cs_order_number#135L) AND (cs_item_sk#133 = cr_item_sk#250))
                           :        :- Project [cs_sold_date_sk#118, cs_bill_customer_sk#121, cs_item_sk#133, cs_order_number#135L, cs_quantity#136, cs_wholesale_cost#137, cs_sales_price#139]
                           :        :  +- Filter ((isnotnull(cs_sold_date_sk#118) AND isnotnull(cs_item_sk#133)) AND isnotnull(cs_bill_customer_sk#121))
                           :        :     +- Relation [cs_sold_date_sk#118,cs_sold_time_sk#119,cs_ship_date_sk#120,cs_bill_customer_sk#121,cs_bill_cdemo_sk#122,cs_bill_hdemo_sk#123,cs_bill_addr_sk#124,cs_ship_customer_sk#125,cs_ship_cdemo_sk#126,cs_ship_hdemo_sk#127,cs_ship_addr_sk#128,cs_call_center_sk#129,cs_catalog_page_sk#130,cs_ship_mode_sk#131,cs_warehouse_sk#132,cs_item_sk#133,cs_promo_sk#134,cs_order_number#135L,cs_quantity#136,cs_wholesale_cost#137,cs_list_price#138,cs_sales_price#139,cs_ext_discount_amt#140,cs_ext_sales_price#141,... 10 more fields] parquet
                           :        +- Project [cr_item_sk#250, cr_order_number#264L]
                           :           +- Filter (isnotnull(cr_order_number#264L) AND isnotnull(cr_item_sk#250))
                           :              +- Relation [cr_returned_date_sk#248,cr_returned_time_sk#249,cr_item_sk#250,cr_refunded_customer_sk#251,cr_refunded_cdemo_sk#252,cr_refunded_hdemo_sk#253,cr_refunded_addr_sk#254,cr_returning_customer_sk#255,cr_returning_cdemo_sk#256,cr_returning_hdemo_sk#257,cr_returning_addr_sk#258,cr_call_center_sk#259,cr_catalog_page_sk#260,cr_ship_mode_sk#261,cr_warehouse_sk#262,cr_reason_sk#263,cr_order_number#264L,cr_return_quantity#265,cr_return_amount#266,cr_return_tax#267,cr_return_amt_inc_tax#268,cr_fee#269,cr_return_ship_cost#270,cr_refunded_cash#271,... 3 more fields] parquet
                           +- Project [d_date_sk#18811, d_year#18817]
                              +- Filter (isnotnull(d_date_sk#18811) AND ((d_year#18817 = 2001) AND isnotnull(d_year#18817)))
                                 +- Relation [d_date_sk#18811,d_date_id#18812,d_date#18813,d_month_seq#18814,d_week_seq#18815,d_quarter_seq#18816,d_year#18817,d_dow#18818,d_moy#18819,d_dom#18820,d_qoy#18821,d_fy_year#18822,d_fy_quarter_seq#18823,d_fy_week_seq#18824,d_day_name#18825,d_quarter_name#18826,d_holiday#18827,d_weekend#18828,d_following_holiday#18829,d_first_dom#18830,d_last_dom#18831,d_same_day_ly#18832,d_same_day_lq#18833,d_current_day#18834,... 4 more fields] parquet
